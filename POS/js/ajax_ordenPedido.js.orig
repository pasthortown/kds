/* global alertify, parseFloat */

<<<<<<< HEAD
var preguntas_sug = new Array();
=======
        var preguntas_sug = new Array();
>>>>>>> origin/MXP_Version_1.9.10.6
var fechaservidor = "";
var h = "";
var m = "";
var Accion = 0;
var lc_cantidad = 1;
var x = "0";
var xi = 1;
var coma = 0;
var ni = 0;
var op = "no";
var lc_control = -1;
var plu_lector = 0;
var plu_mag_id = 0;
var plu_gramo = 0;
var rst_categoria = 0;
var rst_tiempopedido = 0;
var VALIDADOR = 0;
var TOTALCUENTA = 0;
var palabraDefault = "";
var odp_id_agregar = "";
var FECHASERVIDOR = "";
var estado_divide = false;
var arrayValor = [];
var VISUALIZACANTIDAD = "";
var JSON_plus_puntos;
var statusPromocion = 1;
var objetoOrden = {};
var minimo = 2;
var maximo = 5;
var plus_puntos = -1;
var descontarPuntos = false;
var puntosDelPlu = 0;
var econtroDatos = -1;
var fb_status = -1;
var prediccionValor = 0;

//VARIABLES PARA SOLICITUD DE HORNEADOS
var APLICA_SOLICITUD_HORNEADO = 0;
var RUTA_SOLICITUD_HORNEADO = "";
var CAJERO = "";
var IMPRESORA = "";
var SERVIDOR = "";
var IPESTACION = "";
var TIENDA = "";
var IDCAJERO = "";
var reimpresionkiosko;

<<<<<<< HEAD
$(document).ready(function() {
=======
$(document).ready(function () {
    $("#mdlPrincipal").hide();
    $("#mdlVenta").hide();
>>>>>>> origin/MXP_Version_1.9.10.6
    var solicitarInformacion = 0;
    fn_cargando(1);
    activarFocusLectorBarra(true);
    $("#modalCuponSistemaGerenteVoucher").hide();
    $("#cantidadOK").val(1);
    $("#hid_bandera_gramo").val("");
    $("#listaPedidoTomaPedido").shortscroll();
    $("#cnt_rdn_pdd_pls").shortscroll();
    $("#cnt_rdn_pdd_ctgrs").shortscroll();
    $("#formCobrar").hide();
    $("#contenedorComentario").hide();
    $("#modalCuponSistemaGerente").hide();
    $("#anulacionesContenedor").hide();
    $("#tecladoCodigos").hide();
    $("#buscarPlu").show();
    $("#cantidad").val("");
    $("#etiqueta_cantidad").val("x1");
    $("#txt_busca").val("");
    $(".hide_impuesto").hide();
    $("#aumentarContador").hide();
    $("#modalQRPromociones").hide();
    $("#valorQRPromociones").val("");

    var rst_id = $("#hide_rst_id").val();

<<<<<<< HEAD
    var send = { configuracionOrdenPedido: 1 };
=======
    fn_PayPhoneFormularioEnOrdenPedido();
    fn_PayPhoneCargarTipoInmueble();
    send = {"configuracionOrdenPedido": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.mesa_id = $("#hide_mesa_id").val();
    send.num_Pers = $("#hide_num_Pers").val();
    $.ajaxSetup({async: false});
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            palabraDefault = datos[0]["palabraDefault"];
            solicitarInformacion = datos[0]["solicitarInicio"];
            fechaservidor = new Date(datos[0]["fecha"]);
            $("#nfrmcn_srs_sstm_hora").html(datos[0]["observacion"]);
            $("#nfrmcn_srs_sstm_periodo").html(datos[0]["fecha_periodo"]);
            var existe = datos[0]["existe"];
            var tipo_impuesto = datos[0]["tipo_impuesto"];
            var tipo_cantidad = datos[0]["tipo_cantidad"];
            var odp_id = datos[0]["odp_id"];
            rst_categoria = datos[0]["cat_id"];
            rst_tiempopedido = datos[0]["rst_tiempopedido"];
            $("#hide_cdn_tipoimpuesto").val(tipo_impuesto);

            $("#hide_odp_id").val(odp_id);

            if ($("#hide_PerteneceGrupoAmigos").val() === "1") {
                fn_insertaOrdenPedidoFidelizacion($("#hide_odp_id").val());
            }
            if (tipo_impuesto == "Diferencia\ndo") {
                $(".hide_impuesto").show();
            }

            if (tipo_cantidad == 0 || tipo_cantidad == null) {
                $("#btn_punto").prop("disabled", true);
                $("#btn_punto").hide();
            } else {
                $("#btn_punto").prop("disabled", false);
                $("#btn_punto").show();
            }

            if (existe === 1) {
                if ($("#txt_bloqueado").val() !== 0) {
                    $("#btn_eliminarElemnto").attr("Disabled", false);
                    $("#btn_eliminarElemnto").removeClass("boton_Accion_Bloqueado");
                    $("#btn_eliminarElemnto").removeClass("boton_accion_disabled");
                    $("#btn_eliminarElemnto").removeClass("eliminar_bloqueado");
                    $("#btn_eliminarElemnto").addClass("boton_Accion");
                    $("#btn_eliminarElemnto").addClass("eliminar_activo");
                    $("#btn_cuponesSG").removeClass("boton_Opcion");
                    $("#btn_cuponesSG").addClass("boton_Opcion_Bloqueado");
                    $("#btn_cuponesSG").attr("disabled", true);
                    if ($("#hide_fidelizacionActiva").val() === "1") {
                        if ($("#hidVitality").val() == "1") {
                            $("#agregarCantidad").removeClass("cantidad_bloqueado");
                            $("#agregarCantidad").addClass("cantidad_activo");
                            $("#agregarCantidad").addClass("boton_accion_disabled");
                        }
                        $("#btnCancelarOrdenFidelizacion").removeClass("boton_Opcion_Bloqueado");
                        $("#btnCancelarOrdenFidelizacion").addClass("boton_Opcion");
                        $("#btnCancelarOrdenFidelizacion").removeAttr("disabled");
                    }
                } else {

                    fn_cargarAccesosSistema();
                }

                $("#btn_salonLlevar").show();
                $("#btnDesmesa").text(datos[0]["nombreMesa"]);
                fn_listaPendiente();
            } else {
                $("#btn_salonLlevar").hide();
                alertify.alert(
                    "No existen productos configurados para esta estaci&oacute;n"
                );
            }
            if (FORMULARIO_CLIENTES === 1) {


//                if (localStorage.getItem("ls_hayCliente") == null || localStorage.getItem("ls_hayCliente") == "0") {
//                    $("#ModalRegistroDatosDomicilio").show();
//                    $("#pay_txtCedulaCliente").focus();
//                    activarFocusLectorBarra(false);
//
//                } else {
//                    activarFocusLectorBarra(true);
//                }



            } else
            if (solicitarInformacion > 0) {
                activarFocusLectorBarra(true);
                if ($("li.focus").length < 1) {
                    $("#plu_comentar").html("Comentar Orden");
                    $("#contenedorComentario").dialog({
                        modal: true,
                        autoOpen: false,
                        position: {
                            my: "top",
                            at: "top+120"
                        },
                        show: {
                            effect: "none",
                            duration: 500
                        },
                        hide: {
                            effect: "none",
                            duration: 500
                        },
                        width: 500,
                        height: 340,
                        open: function (event, ui) {
                            $(".ui-dialog-titlebar").hide();
                            if ((palabraDefault != null || palabraDefault != "") && $("#hide_fidelizacionActiva").val() == 1) {
                                $("#comentario").val(palabraDefault + " " + $("#fdzn_nombre_cliente").val());
                            } else {
                                $("#comentario").val(palabraDefault);
                            }
                            fn_alfaNumerico("#comentario");
                            $("#btn_cancelar_teclado").attr(
                                "onclick",
                                "fn_cerrarModalComentar()"
                            );
                            $("#btn_ok_teclado").attr(
                                "onclick",
                                "fn_agregarComentarioOrden()"
                            );
                        }
                    });
                    $("#contenedorComentario").dialog("open");
                }
            }
        }
    });
    $.ajaxSetup({async: true});

    cargarMenuEstacionDinamico();
    fn_popupCantidad();
    $("#txt_lectorBarras").val("");
    fn_focusLector();
<<<<<<< HEAD
    $("#txt_lectorBarras").change(function() {
=======
    $('#txt_lectorBarras').change(function () {
>>>>>>> origin/MXP_Version_1.9.10.6
        fn_lectorBarras();
    });
    $("#cuadro_buscador").css("display", "none");
    //Modal Preguntas Sugeridas
    $("#mdl_prgnts_sgrds").css("display", "none");
    $("#mdl_pcns_prgnts_sgrds").css("display", "none");
    $("#body_prgnts_sgrds").shortscroll();
    //Modal Menu Desplegable
<<<<<<< HEAD
    $("#rdn_pdd_brr_ccns").css("display", "none");
    $("#cnt_mn_dsplgbl_pcns_drch").css("display", "none");
    $("#boton_sidr").click(function() {
        $("#rdn_pdd_brr_ccns").css("display", "block");
        $("#cnt_mn_dsplgbl_pcns_drch").css("display", "block");
    });
    $("#rdn_pdd_brr_ccns").click(function() {
        $("#rdn_pdd_brr_ccns").css("display", "none");
        $("#cnt_mn_dsplgbl_pcns_drch").css("display", "none");
=======
    $('#rdn_pdd_brr_ccns').css('display', 'none');
    $('#cnt_mn_dsplgbl_pcns_drch').css('display', 'none');

    $('#boton_sidr').click(function () {
        $('#rdn_pdd_brr_ccns').css('display', 'block');
        $('#cnt_mn_dsplgbl_pcns_drch').css('display', 'block');
    });

    $('#rdn_pdd_brr_ccns').click(function () {
        $('#rdn_pdd_brr_ccns').css('display', 'none');
        $('#cnt_mn_dsplgbl_pcns_drch').css('display', 'none');
>>>>>>> origin/MXP_Version_1.9.10.6
    });
    $("#btn_cantidad_cero").prop("disabled", false);
    fn_visualizarCantidadProducto();

    if ($("#hide_PerteneceGrupoAmigos").val() === "0") {
        $("#queAlcanza").hide();
    }

    fn_cargando(0);
    fn_verificarTipoVenta($("#hide_odp_id").val());
    mostrarListadoKiosko();
    fn_focusLector();

    //vitality
    $("#txtCodigoVitality").on("change", function() {
        var codigoV = $("#txtCodigoVitality").val();
        $("#txtCodigoVitality").val(codigoV);
        cargarTokenSeguridadVitality(codigoV);
    });
});

 



var FORMULARIO_CLIENTES = 0;
function fn_PayPhoneFormularioEnOrdenPedido() {

    var send = {"PayPhoneFormularioEnOrdenPedido": 1};
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                localStorage.setItem("ls_PayPhoneFormularioEnOrdenPedido", datos[0].estado);
                FORMULARIO_CLIENTES = datos[0].estado;
                $("#tienda").html("TIENDA " + datos[0].tienda);
            } else {
                FORMULARIO_CLIENTES = 0;
                localStorage.setItem("ls_PayPhoneFormularioEnOrdenPedido", 0);
            }
        }
        , error: function (e) {
            FORMULARIO_CLIENTES = 0;
            localStorage.setItem("ls_PayPhoneFormularioEnOrdenPedido", 0);
        }
    });
}

function fn_PayPhoneCargarTipoInmueble() {
    $("#selectTiposInmuebles").html('');
    var send = {"PayPhoneCargarTipoInmueble": 1};
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {

            var htmlSelect = "";
            if (datos.str > 0) {
                for (i = 0; i < datos.str; i++) {
                    if (i === 0)
                        htmlSelect = "<option value=\"" + datos[i].value + "\"selected> " + datos[i].descripcion + "</option>"
                    else
                        htmlSelect += "<option value=\"" + datos[i].value + "\"> " + datos[i].descripcion + "</option>"
                }
            } else {
                htmlSelect = "<option value=\"-1\" selected> -- Seleccione--</option>"
            }
            $("#selectTiposInmuebles").html(htmlSelect);
        }
        , error: function (e) {

        }
    });
}

function odp_buscarCliente(e) {
    var keyCode = e.which;
    if (keyCode == '13' || keyCode == '9') {
        fn_buscarCliente("#pay_txtCedulaCliente");
    }
}


function fn_verificarTipoVenta(cabeceraordenpedido) {
<<<<<<< HEAD
    var send = { verificarPoliticaTipoVenta: 1 };
=======
    var send = {"verificarPoliticaTipoVenta": 1};
>>>>>>> origin/MXP_Version_1.9.10.6

    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
<<<<<<< HEAD
        success: function(datos) {
            if (datos["Activo"] == 1) {
=======
        success: function (datos) {
            if (datos['Activo'] == 1) {
>>>>>>> origin/MXP_Version_1.9.10.6
                AgregarBotonesTipoVenta(cabeceraordenpedido);
            } else {
                $("#mdlVenta").hide();
            }

        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
        }
    });
}

function AgregarBotonesTipoVenta(cabeceraordenpedido) {
<<<<<<< HEAD
    var send = { ConsultarCanalVenta: 1 };
=======
    var send = {"ConsultarCanalVenta": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos["str"] > 1) {
                $("#mdlTipoVenta").show();
                for (var i = 0; i < datos.str; i++) {
                    $("#mdlTipoVentaCuerpo").append(
                        '<button class="boton_Opcion" id=' +
                        datos[i]["idIntegracion"] +
                        " onclick=\"insertarTipoCanalVenta('" +
                        datos[i]["idIntegracion"] +
                        "','" +
                        cabeceraordenpedido +
                        "')\"><p>" +
                        datos[i]["Descripcion"] +
                        "<p></button>"
                    );
                }


            } else {
                $("#mdlVenta").hide();
                insertarTipoCanalVenta(datos[0]["idIntegracion"], cabeceraordenpedido);
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
        }
    });
}


function insertarTipoCanalVenta(idTipoVentaCanal, cabeceraordenpedido) {
<<<<<<< HEAD
    var send = { insertarTipoCanalVenta: 1 };
=======
    var send = {"insertarTipoCanalVenta": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.idTipoVentaCanal = idTipoVentaCanal;
    send.cabeceraordenpedido = cabeceraordenpedido;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos["Respuesta"] == 1) {
                $("#mdlVenta").hide();
            } else {
                $("#mdlVenta").hide();
                alertify.error("Error Tipo de Pedido");
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
        }
    });
}

function fn_insertaOrdenPedidoFidelizacion(odp_id) {
<<<<<<< HEAD
    var send = { insertaOrdenPedidoFidelizacion: 1 };
=======
    var send = {"insertaOrdenPedidoFidelizacion": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.odp_id = odp_id;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos["str"] > 0) {

            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
        }
    });
}


function pantalla1() {
    $("#infoMdalf").html("Seleccione tipo voucher");
    //$("#voucherAEs").hide(100);
    $("#select_cliente").hide();
    $("#select_tipocupo").hide(100);
    $("#voucherAE").show(100);
    $("#keyboard").hide();
    $("#keyboard").empty();


    $("#botonVolver").hide(100);

    $("#botonVolver1").hide();
    $("#botonVolver2").hide();
    $("#voucherAEs").show(100);
}

//borrar
function abrirModalVoucher(dop_cuenta) {
    if (!$("#listadoPedido li").length) {
        alertify.alert("No ha seleccionado un producto para cobrar");
    } else {
        $("#mdl_rdn_pdd_crgnd").show();
        pantalla1();

        var mostrarModal = true;

        var html = "";

        html =
            '<br/><center><div style="height:60px; font-size: 18px;"> <h3><label> Ingrese informaciÃ³n relevante del voucher </h3></strong></div></center>';
        $("#voucherAE").html(html);

        fn_procesoManualVocuher();

        $("#mdl_rdn_pdd_crgnd").hide();
        if (mostrarModal) {
            $("#input_cuponSistemaGerenteAutVoucher").focus();
            $("#modalCuponSistemaGerenteVoucher").show();
            $("#modalCuponSistemaGerenteVoucher").dialog({
                modal: true,
                position: {
                    my: "top",
                    at: "top+50"
                },
                width: 700,
                heigth: 500,
                resize: false,
                opacity: 0,
                show: "none",
                hide: "none",
                duration: 500,
<<<<<<< HEAD
                open: function(event, ui) {
                    $(".ui-dialog-titlebar").hide();
                    $("#input_cuponSistemaGerenteAutVoucher").focus();
                    $("#input_cuponSistemaGerenteAutVoucher").val("");
=======
                open: function (event, ui) {
                    $('.ui-dialog-titlebar').hide();
                    $('#input_cuponSistemaGerenteAutVoucher').focus();
                    $('#input_cuponSistemaGerenteAutVoucher').val('');
>>>>>>> origin/MXP_Version_1.9.10.6
                }
            });
        }

    }


}

function fn_imprimirCuponCanjeado(cupon, mensaje, estado) {
    var odp_id = $("#hide_odp_id").val();
    var est_ipd = $("#hide_est_ip").val();
    var usr_id = $("#hide_usr_id").val();
    var rst_id = $("#hide_rst_id").val();
<<<<<<< HEAD
    var send = { impresionDetalleCuponOrdenPedido: 1 };
=======
    send = {"impresionDetalleCuponOrdenPedido": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.cupon = cupon;
    send.mensaje = mensaje;
    send.estado = estado;
    $.ajax({
        type: "GET",
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {}
    });
}

function fn_procesoCanjearAutomatico() {
    $("#pcn_tp_cnj_cpn_1").attr("checked", false);
    $("#pcn_tp_cnj_cpn_0").attr("checked", true);
    $("#keyboard").hide();
    $("#keyboard").empty();
    $("#aut_frm_cnj_cpn").css("display", "block");
    $("#man_frm_cnj_cpn").css("display", "none");
    $("#input_cuponSistemaGerenteAut").focus();
}

function fn_procesoCanjearAutomaticoVoucher(tipov_id) {
    $("#hide_tipov_id").val(tipov_id);
    $("#voucherAEs").show(100);
    $("#input_cuponSistemaGerenteAutEXT").focus();
    $("#voucherAEs").html("");
    $("#voucherAEs").html(
        ' <center>  <input  type="password" name="input_cuponSistemaGerenteAutEXT" onchange="fn_canjearCuponAutomaticoVoucher()" id="input_cuponSistemaGerenteAutEXT" style="height: 35px; width: 454px;"/> </center>'
    );
    $("#keyboard").hide();
    $("#keyboard").empty();
}

function fn_validarCuponManual() {
    //Validar campo 1
    var valor = $("#input_cuponSistemaGerenteMan1").val();
    if (valor.length > 0 && valor.length < 8) {
        $("#input_cuponSistemaGerenteMan1").removeClass("alertaInput");
        //Validar campo 2
        valor = $("#input_cuponSistemaGerenteMan2").val();
        if (valor.length > 0 && valor.length < 8) {
            $("#input_cuponSistemaGerenteMan2").removeClass("alertaInput");
            //Validar campo 3
            valor = $("#input_cuponSistemaGerenteMan3").val();
            if (valor.length > 0 && valor.length < 8) {
                $("#input_cuponSistemaGerenteMan3").removeClass("alertaInput");
                //Validar campo 4
                valor = $("#input_cuponSistemaGerenteMan4").val();
                if (valor.length > 0 && valor.length < 8) {
                    $("#input_cuponSistemaGerenteMan4").removeClass("alertaInput");
                    fn_canjearCuponManual();
                } else {
                    fn_agregarAlertaInput("#input_cuponSistemaGerenteMan4");
                    fn_activarCasilla("#input_cuponSistemaGerenteMan4");
                    if (valor.length == 0) {
                        alertify.alert("Todos los campos son obligatorios.");
                    } else {
                        alertify.alert("Excede en n&uacute;mero de caracteres permitidos.");
                    }
                }

            } else {
                fn_agregarAlertaInput("#input_cuponSistemaGerenteMan3");
                fn_activarCasilla("#input_cuponSistemaGerenteMan3");
                if (valor.length == 0) {
                    alertify.alert("Todos los campos son obligatorios.");
                } else {
                    alertify.alert("Excede en n&uacute;mero de caracteres permitidos.");
                }
            }

        } else {
            fn_agregarAlertaInput("#input_cuponSistemaGerenteMan2");
            fn_activarCasilla("#input_cuponSistemaGerenteMan2");
            if (valor.length == 0) {
                alertify.alert("Todos los campos son obligatorios.");
            } else {
                alertify.alert("Excede en n&uacute;mero de caracteres permitidos.");
            }
        }

    } else {
        fn_agregarAlertaInput("#input_cuponSistemaGerenteMan1");
        fn_activarCasilla("#input_cuponSistemaGerenteMan1");
        if (valor.length == 0) {
            alertify.alert("Todos los campos son obligatorios.");
        } else {
            alertify.alert("Excede en n&uacute;mero de caracteres permitidos.");
        }
    }
}

function fn_agregarAlertaInput(id) {
    $(id).addClass("alertaInput");
    $(id).val("");
    $(id).focus();
}

function fn_activarCasilla(id) {
    $("#keyboard").hide();
    $("#keyboard").empty();
    fn_alfaNumerico(id);
    $("#btn_ok_teclado").attr("onclick", "fn_validarCuponManual()");
    $("#btn_cancelar_teclado").attr(
        "onclick",
        "fn_cerrarModalCuponesSistemaGerente()"
    );
}

function fn_canjearCuponAutomatico() {
    fn_cargando(1);
    $("#input_cuponSistemaGerenteAut").prop("disabled", true);
    var cdgcpn = $("#input_cuponSistemaGerenteAut").val();
    send = {};
    send.metodo = "canjearCuponesAutomatico";
    send.cupon = cdgcpn;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        Accept: "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "cliente_canjearcupones.php",
        data: send,
        success: function(datos) {
            if (datos.retorno > 0) {
                fn_cargando(0);
                alertify.alert("" + datos.respuesta);
                fn_cerrarModalCuponesSistemaGerente();
                $("#input_cuponSistemaGerenteAut").prop("disabled", false);

                // aqui accion
                if ($("#hide_turneroActivo").val() == "1"  &&  $("#hide_turneroHabilitadoPorEstacion").val() == "1") {
                    // 1-> politica activado
                    var txtNumFactura = $("#txtNumFactura").val();
                    var lc_send = new Object();
                    lc_send["turneroAccion"] = "agregarTurno";
                    lc_send["turneroURl"] = $("#hide_turneroURl").val();
                    lc_send["transaccion"] = datos.cupon;
                    lc_send["estado"] = "Preparando";
                    lc_send["orden"] = datos.cupon.slice(-2);
                    lc_send["cliente"] = "";
                    lc_send["clienteDocumento"] = "";
                    lc_send["tipo"] = "preimpreso";
                    lc_send["especial"] = true;
                    $.ajax({
                        async: true,
                        type: "POST",
                        dataType: "text",
                        contentType: "application/x-www-form-urlencoded",
                        url: "../facturacion/wsTurnero.php",
                        data: lc_send,
                        success: function (datos) {
                            console.log(datos);
                        }
                    });
                }
            } else {
                if (datos.retorno > -1) {
                    fn_cargando(0);
                    alertify.confirm(datos.mensaje + " &iquest;Desea probar otra vez?", function(e) {
                        if (e) {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                                $("#input_cuponSistemaGerenteAut").val("");
                                $("#input_cuponSistemaGerenteAut").focus();
                        } else {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            fn_cerrarModalCuponesSistemaGerente();
                        }
                    });
                } else {
                    fn_cargando(0);
                    alertify.confirm("Error! &iquest;Desea probar otra vez?", function(e) {
                        if (e) {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            $("#input_cuponSistemaGerenteAut").val("");
                            $("#input_cuponSistemaGerenteAut").focus();
                        } else {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            fn_cerrarModalCuponesSistemaGerente();
                        }
                    });
                }
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
            $("#input_cuponSistemaGerenteAut").val("");
            $("#input_cuponSistemaGerenteAut").focus();
            fn_cargando(0);
            alertify.alert("Servicio no Disponible");
        }
    });
}

function fn_canjearCuponManual() {

    fn_cargando(1);
    var cdn_id = $("#hide_cdn_id").val();
    var tipo = 0;
    var incremental = $("#input_cuponSistemaGerenteMan1").val();
    var solicitud = $("#input_cuponSistemaGerenteMan2").val();
    var cupon = $("#input_cuponSistemaGerenteMan3").val();
    var rst_id = $("#hide_rst_id").val();
    var usr_id = 1;
    var text_for = $("#input_cuponSistemaGerenteMan4").val();
    send = {};
    send.metodo = "canjearCuponesManual";
    send.cdn_id = cdn_id;
    send.tipo = tipo;
    send.incremental = incremental;
    send.solicitud = solicitud;
    send.cupon = cupon;
    send.rst_id = rst_id;
    send.usr_id = usr_id;
    send.text_for = text_for;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        Accept: "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "cliente_canjearcupones.php",
        data: send,
        success: function (datos) {
            if (datos.retorno > 0) {
                fn_cargando(0);
                alertify.alert("" + datos.respuesta);
                fn_cerrarModalCuponesSistemaGerente();
                $("#input_cuponSistemaGerenteAut").prop("disabled", false);

                // aqui accion
                if ($("#hide_turneroActivo").val() == "1") {
                    // 1-> politica activado
                    var txtNumFactura = $("#txtNumFactura").val();
                    var lc_send = new Object();
                    lc_send["turneroAccion"] = "agregarTurno";
                    lc_send["turneroURl"] = $("#hide_turneroURl").val();
                    lc_send["transaccion"] = datos.cupon;
                    lc_send["estado"] = "Preparando";
                    lc_send["orden"] = datos.cupon.slice(-2);
                    lc_send["cliente"] = "";
                    lc_send["clienteDocumento"] = "";
                    lc_send["tipo"] = "preimpreso";
                    lc_send["especial"] = true;
                    $.ajax({
                        async: true,
                        type: "POST",
                        dataType: "text",
                        contentType: "application/x-www-form-urlencoded",
                        url: "../facturacion/wsTurnero.php",
                        data: lc_send,
                        success: function (datos) {
                            console.log(datos);
                        }
                    });
                }




            } else {
                if (datos.retorno > -1) {
                    fn_cargando(0);
                    alertify.confirm(datos.respuesta + " &iquest;Desea probar otra vez?", function (e) {
                        if (e) {
                            fn_procesoManual();
                        } else {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            fn_cerrarModalCuponesSistemaGerente();
                        }
                    });
                } else {
                    fn_cargando(0);
                    alertify.confirm("Error! &iquest;Desea probar otra vez?", function (e) {
                        if (e) {
                            fn_procesoManual();
                        } else {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            fn_cerrarModalCuponesSistemaGerente();
                        }
                    });
                }
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
            $("#input_cuponSistemaGerenteAut").focus();
            fn_cargando(0);
            alertify.alert("Servicio no Disponible");
        }
    });
}

function fn_procesoManual() {
    $("#input_cuponSistemaGerenteMan1").val("");
    $("#input_cuponSistemaGerenteMan1").removeClass("alertaInput");
    $("#input_cuponSistemaGerenteMan2").val("");
    $("#input_cuponSistemaGerenteMan2").removeClass("alertaInput");
    $("#input_cuponSistemaGerenteMan3").val("");
    $("#input_cuponSistemaGerenteMan3").removeClass("alertaInput");
    $("#input_cuponSistemaGerenteMan4").val("");
    $("#input_cuponSistemaGerenteMan4").removeClass("alertaInput");
    fn_activarCasilla("#input_cuponSistemaGerenteMan1");
    $("#input_cuponSistemaGerenteMan1").focus();
}

//borrar
function fn_procesoManualVocuher() {
    $("#voucherAEs").show(100);
    $("#voucherAEs").html("");
    $("#voucherAEs").html(
        ' <center>  <textarea rows="4" cols="50" type="text" name="input_cuponSistemaGerenteAutEXT"   id="input_cuponSistemaGerenteAutEXT" style="height: 60px; width: 454px;"/> </textarea></center>'
    );
    $("#input_cuponSistemaGerenteAutEXT").val("");
    $("#input_cuponSistemaGerenteAutEXT").removeClass("alertaInput");

    fn_activarCasilla("#input_cuponSistemaGerenteAutEXT");
    $("#input_cuponSistemaGerenteAutEXT").focus();
    $("#btn_ok_teclado").attr("onclick", "fn_validarCuponManualVoucher()");
}

//borrar
function pantalla2() {
    $("#infoMdalf").html("Seleccione el cliente.");
    $("#voucherAE").hide(100);
    $("#voucherAEs").hide(100);
    $("#select_tipocupo").hide(100);
    $("#select_cliente").show(100);
    $("#botonVolver").show(100);
    $("#keyboard").hide();
    $("#keyboard").empty();

    $("#botonVolver1").show();
    $("#botonVolver2").hide();
    // $("#botonVolver").hmtl("<img onclick=\"pantalla1()\" style=\"margin-top: 3%; width: 10%;\" src=\"../imagenes/volverCupon.png\"></img>");
}

//borrar
function fn_cargarClienteExterno() {
    var html = "";

    $("#select_cliente").html("");
    var send;
<<<<<<< HEAD
    send = { traerListaVoucherAerolineas: 1 };
=======
    send = {"traerListaVoucherAerolineas": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.opcion = 2;
    send.descripcion = "";
    send.documento = "";
    send.informacionVoucher = "";
    send.valor = 0;

    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        Accept: "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "../mantenimiento/adminCadena/configAdminCadena.php",
        data: send,
        success: function (data) {
            if (data) {
                pantalla2();
                for (i = 0; i < data.str; i++) {
                    if (data[i].isActive) {
                        var datosVoucher = JSON.parse(data[i].Datos);
                        //$('#listadoVoucher tbody').append(fn_listarVoucher(data[i].ID_ColeccionCadena + '|' + data[i].ID_ColeccionDeDatosCadena, JSON.parse(data[i].Datos), data[i].isActive));
                        html +=
                            '  <div class="tipoCupon text-center" onclick="seleccionarClienteVoucher( \'' +
                            data[i].ID_ColeccionCadena +
                            "|" +
                            data[i].ID_ColeccionDeDatosCadena +
                            "','" +
                            datosVoucher.telefonoDomiclio +
                            "'  , '" +
                            datosVoucher.descripcion +
                            "' , '" +
                            datosVoucher.correo +
                            "' ,'" +
                            datosVoucher.identificacion +
                            "'   ,'" +
                            datosVoucher.direccionDomicilio +
                            '\'    ) "><div class="letra">  ' +
                            datosVoucher.descripcion +
                            "</div> </div>";
                    }
                }

            } else {
                alertify.error("Error al consultar los datos.");
            }
            $("#select_cliente").html(html);

        }
    });

}


//borrar
function seleccionarClienteVoucher(IDCliente, cli_telefono, cli_nombres, cli_email, cli_documento, cli_direccion) {
    // Asignar los datos que luego se enviaran por prm segun frm.
    asignarDatosClienteVoucher(IDCliente, cli_direccion, cli_documento, cli_email, cli_nombres, cli_telefono);
    var ID_ColeccionCadena = IDCliente.split("|");
    fn_obtenerTiposdeCupo(ID_ColeccionCadena[0], ID_ColeccionCadena[1]);

}

//borrar
function fn_validarCuponManualVoucher() {
    if ($("#input_cuponSistemaGerenteAutEXT").val() !== "") {
        var mensaje = fn_guadarDescripcionVoucher();
        if (mensaje) {
            $("#mdl_rdn_pdd_crgnd").show();
            fn_cargarClienteExterno();

            $("#mdl_rdn_pdd_crgnd").hide();
        } else {
            alertify.error("Existen problemas al guardar la informaciÃ³n.");
        }
    } else {
        alertify.error("ERROR!!  Debe completar la informaciÃ³n solicitada");
    }
}

//borrar
function fn_guadarDescripcionVoucher() {
    var mensaje = false;
<<<<<<< HEAD
    var send = { guadarDescripcionVoucher: 1 };
=======
    var send = {"guadarDescripcionVoucher": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.opcion = 1;
    send.IDCabeceraOrdenPedido = $("#hide_odp_id").val();
    send.observacion = $("#input_cuponSistemaGerenteAutEXT").val();

    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                alertify.success(datos[0].mensaje);
                mensaje = true;
            }
        }
    });
    return mensaje;
}

function fn_procesoCanjearManual() {
    if (!$("#pcn_tp_cnj_cpn_1").is(":checked")) {
        $("#pcn_tp_cnj_cpn_0").attr("checked", false);
        $("#pcn_tp_cnj_cpn_1").attr("checked", true);
        $("#man_frm_cnj_cpn").css("display", "block");
        $("#aut_frm_cnj_cpn").css("display", "none");
        fn_procesoManual();
    }
}

function fn_procesoCanjearManualVoucher(tipov_id) {
    $("#hide_tipov_id").val(tipov_id);

    fn_procesoManualVocuher();

    $("#imgPantalla2").removeAttr("onclick");

    $("#imgPantalla2").click(function () {
        pantalla1();
    });


}


function validarPatron(cadena, caracter, incidencias) {
    var respuesta = false;
    var conteo = 0;

    for (i = 0; i < cadena.length; i++) {
        if (cadena.charAt(i) === caracter) {
            conteo++;
        }
    }
    if (conteo === incidencias) {
        respuesta = true;
    } else {
        respuesta = false;
    }
    return respuesta;
}


function fn_canjearCuponAutomaticoVoucher() {
    fn_cargando(1);
    $("#imgPantalla2").removeAttr("onclick");

    $("#imgPantalla2").click(function () {
        pantalla1();
    });

    var reconocioTarjeta = false;
    var textoCupon = $("#input_cuponSistemaGerenteAutEXT").val();
<<<<<<< HEAD
    send = { obtienePatronesVocuher: 1 };
=======
    send = {"obtienePatronesVocuher": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.cdn_id = $("#hide_cdn_id").val();
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                var caracter = "";
                var incidencias = "";

                for (var i = 0; i < datos.str; i++) {
                    caracter = datos[i]["caracter"];
                    incidencias = datos[i]["incidencias"];

                    var estado = validarPatron(textoCupon, caracter, incidencias);

                    if (estado) {
                        reconocioTarjeta = true;
                        fn_obtieneClienteSegunPatronesVocuher(datos[i]["IDColeccionDeDatosPais"]);
                        break;
                    }
                }
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
        }
    });

    if (!reconocioTarjeta) {
        fn_validarCuponManualVoucher();
    }

    fn_cargando(0);
}


function pantalla3() {
    $("#infoMdalf").html("Seleccione el cupo");
    $("#voucherAEs").hide(100);
    $("#select_cliente").hide();
    $("#voucherAE").hide(100);
    $("#keyboard").hide();
    $("#keyboard").empty();
    $("#select_tipocupo").show(100);
    $("#botonVolver1").hide();
    $("#botonVolver2").show();
}

function fn_obtenerTiposdeCupo(ID_ColeccionCadena, ID_ColeccionDeDatosCadena) {


    var aux = "";
    var send;
<<<<<<< HEAD
    send = { buscarMontoVoucher: 1 };
=======
    send = {"buscarMontoVoucher": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.opcion = 2;
    send.ID_ColeccionCadena = ID_ColeccionCadena;
    send.ID_ColeccionDeDatosCadena = ID_ColeccionDeDatosCadena;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        Accept: "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "../mantenimiento/adminCadena/configAdminCadena.php",
        data: send,
        success: function (data) {
            if (data.str > 0) {


                pantalla3();
<<<<<<< HEAD
                if (data[0].valor !== "" && data[0].valor !== "0") {
                    arrayValor = data[0].valor.split("|");
                    $.each(arrayValor, function(index, value) {
                        aux +=
                            '<div class="tipoCupon text-center"  >' +
                            '<input type="checkbox" class="checkbox" />' +
                            '<div  onclick="fn_cobrarCupon(' +
                            index +
                            ')"><div class="letra">' +
                            "Valor" +
                            "</div>" +
                            "<div id='" +
                            index +
                            "'>" +
                            value +
                            "</div></div><br>" +
                            "<button onclick=\"fn_agregar('+','" + index + "')\">+</button>" +
                            "<input id='txt_" + index + "' type='text' value='1' disabled/>" +
                            "<button onclick=\"fn_agregar('-','" + index + "')\">-</button>" +
                            "</div>";
=======
                if (data[0].valor !== '' && data[0].valor !== '0') {
                    arrayValor = data[0].valor.split('|');

                    $.each(arrayValor, function (index, value) {
                        aux += "<div class=\"tipoCupon text-center\"  >" +
                                "<input type=\"checkbox\" class=\"checkbox\" />" +
                                "<div  onclick=\"fn_cobrarCupon(" + index + ")\"><div class=\"letra\">" + "Valor" + "</div>" +
                                "<div id='" + index + "'>" + value + "</div></div><br\>" +
                                "<button onclick=\"fn_agregar('+','" + index + "')\">+</button>" +
                                "<input id='txt_" + index + "' type='text' value='1' disabled/>" +
                                "<button onclick=\"fn_agregar('-','" + index + "')\">-</button>" +
                                "</div>";
>>>>>>> origin/MXP_Version_1.9.10.6
                    });
                }
                $("#select_tipocupo").html(aux);
                $("#select_tipocupo").show(100);


            } else {
                alertify.error("No hay cupones configurados.");
            }

        }
    });
}

//borrar
function fn_agregar(val, index) {
    var cont = $("#txt_" + index).val();
    var valor = arrayValor[index];
    var total;
    if (val === "+") {
        cont++;
        total = cont * valor;
        $("#" + index).text(total.toFixed(2));
        $("#txt_" + index).val(cont);
    }

    if (val === "-") {
        if (cont > 1) {
            cont--;
            total = cont * valor;
            $("#" + index).text(total.toFixed(2));
            $("#txt_" + index).val(cont);
        }
    }
}

//borrar
function asignarDatosClienteVoucher(IDCliente, cli_direccion, cli_documento, cli_email, cli_nombres, cli_telefono) {
    $("#hide_vae_IDCliente").val(IDCliente);
    $("#hide_cli_direccion").val(cli_direccion);
    $("#hide_cli_documento").val(cli_documento);
    $("#hide_cli_email").val(cli_email);
    $("#hide_cli_nombres").val(cli_nombres);
    $("#hide_cli_telefono").val(cli_telefono);
}

function fn_obtieneClienteSegunPatronesVocuher(IDColDeDatosPais) {
<<<<<<< HEAD
    send = { obtieneClienteSegunPatronesVocuher: 1 };
=======

    send = {"obtieneClienteSegunPatronesVocuher": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.IDColeccionDeDatosPais = IDColDeDatosPais;
    send.cdn_id = $("#hide_cdn_id").val();
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                asignarDatosClienteVoucher(datos[0]["IDCliente"], datos[0]["cli_direccion"], datos[0]["cli_documento"], datos[0]["cli_email"], datos[0]["cli_nombres"], datos[0]["cli_telefono"]);
                fn_obtenerTiposdeCupo(datos[0]["cli_documento"]);
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
        }
    });
}


<<<<<<< HEAD

=======
function fn_canjearCuponAutomatico() {
    fn_cargando(1);
    $("#input_cuponSistemaGerenteAut").prop("disabled", true);
    var cdgcpn = $('#input_cuponSistemaGerenteAut').val();
    send = {};
    send.metodo = "canjearCuponesAutomatico";
    send.cupon = cdgcpn;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        "Accept": "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "cliente_canjearcupones.php",
        data: send,
        success: function (datos) {
            if (datos.retorno > 0) {
                fn_cargando(0);
                alertify.alert("" + datos.respuesta);
                fn_cerrarModalCuponesSistemaGerente();
                $("#input_cuponSistemaGerenteAut").prop("disabled", false);
            } else {
                if (datos.retorno > -1) {
                    fn_cargando(0);
                    alertify.confirm(datos.mensaje + " &iquest;Desea probar otra vez?", function (e) {
                        if (e) {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            $('#input_cuponSistemaGerenteAut').val("");
                            $('#input_cuponSistemaGerenteAut').focus();
                        } else {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            fn_cerrarModalCuponesSistemaGerente();
                        }
                    });
                } else {
                    fn_cargando(0);
                    alertify.confirm("Error! &iquest;Desea probar otra vez?", function (e) {
                        if (e) {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            $('#input_cuponSistemaGerenteAut').val("");
                            $('#input_cuponSistemaGerenteAut').focus();
                        } else {
                            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
                            fn_cerrarModalCuponesSistemaGerente();
                        }
                    });
                }
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            $("#input_cuponSistemaGerenteAut").prop("disabled", false);
            $('#input_cuponSistemaGerenteAut').val("");
            $('#input_cuponSistemaGerenteAut').focus();
            fn_cargando(0);
            alertify.alert("Servicio no Disponible");
        }
    });
}
>>>>>>> origin/MXP_Version_1.9.10.6

function fn_modalCupones() {
    fn_procesoCanjearAutomatico();
    $("#modalCuponSistemaGerente").show();
    $("#modalCuponSistemaGerente").dialog({
        modal: true,
        position: {
            my: "top",
            at: "top+220"
        },
        width: 500,
        heigth: 500,
        resize: false,
        opacity: 0,
        show: "none",
        hide: "none",
        duration: 500,
<<<<<<< HEAD
        open: function(event, ui) {
            $(".ui-dialog-titlebar").hide();
            $("#input_cuponSistemaGerenteAut").val("");
=======
        open: function (event, ui) {
            $('.ui-dialog-titlebar').hide();
            $('#input_cuponSistemaGerenteAut').val('');
>>>>>>> origin/MXP_Version_1.9.10.6
        }
    });
}

function fn_validarCuponSistemaGerente() {
    var cdgcpn = $("#input_cuponSistemaGerente").val();
}

function fn_cerrarModalCuponesSistemaGerente() {
    $("#keyboard").hide();
    $("#keyboard").empty();
    $("#modalCuponSistemaGerente").hide();
    $("#modalCuponSistemaGerente").dialog("close");
}

function fn_cerrarModalCuponesSistemaGerenteVoucher() {
    $("#keyboard").hide();
    $("#keyboard").empty();
    $("#modalCuponSistemaGerenteVoucher").hide();
    $("#modalCuponSistemaGerenteVoucher").dialog("close");
    $("#input_cuponSistemaGerenteAutEXT").val("");
}

function cargarMenuEstacionDinamico() {
<<<<<<< HEAD
    var classCss =
        $("#hide_PerteneceGrupoAmigos").val() === "1" ?
        "btn_mn_dnmc_stcn_puntos" :
        "btn_mn_dnmc_stcn";
    var vitalityActivo = $("#hidVitality").val() == "1" ? 1 : 0;
    var fidelizacionActivo =
        $("#hide_PerteneceGrupoAmigos").val() === "1" ? 1 : 0;
    var send = { cargarMenuEstacionDinamico: 1 };
    send.fidelizacionActivo = fidelizacionActivo;
    send.vitalityActivo = vitalityActivo;
  $.getJSON("config_ordenPedido.php", send, function(datos) {
=======
    var classCss = ($("#hide_PerteneceGrupoAmigos").val() === "1") ? "btn_mn_dnmc_stcn_puntos" : "btn_mn_dnmc_stcn";

    send = {"cargarMenuEstacionDinamico": 1};
    $.getJSON("config_ordenPedido.php", send, function (datos) {
>>>>>>> origin/MXP_Version_1.9.10.6
        if (datos.str > 0) {
            for (i = 0; i < datos.str; i++) {
                if (i < datos.str - 1) {
                    $("#cntdr_mn_dnmc_stcn").append(
                        '<input type="button" id="btn_mn_' +
                        datos[i]["menu_id"] +
                        "_" +
                        datos[i]["cla_id"] +
                        '" class="' +
                        classCss +
                        '" value="' +
                        datos[i]["Descripcion"] +
                        '" onclick="fn_cargarCategoriaMenu(this, \'' +
                        datos[i + 1]["menu_id"] +
                        "', '" +
                        datos[i + 1]["cla_id"] +
                        '\');" style="display: none;"/>'
                    );
                } else {
                    $("#cntdr_mn_dnmc_stcn").append(
                        '<input type="button" id="btn_mn_' +
                        datos[i]["menu_id"] +
                        "_" +
                        datos[i]["cla_id"] +
                        '" class="' +
                        classCss +
                        '" value="' +
                        datos[i]["Descripcion"] +
                        '" onclick="fn_cargarCategoriaMenu(this, \'' +
                        datos[0]["menu_id"] +
                        "', '" +
                        datos[0]["cla_id"] +
                        '\');" style="display: none;"/>'
                    );
                }
                if (i == 0) {
                    $("#hid_cla_id").val(datos[i]["cla_id"]);
                    $("#hide_menu_id").val(datos[i]["menu_id"]);
                    $("#btn_mn_" + datos[i]["menu_id"] + "_" + datos[i]["cla_id"]).css(
                        "display",
                        "block"
                    );
                    fn_cargarMenuCategoriaEstacion(
                        datos[i]["menu_id"],
                        datos[i]["cla_id"]
                    );
                }
            }
        }
    });
}

function fn_cargarCategoriaMenu(anterior, siguiente, cla_id) {
    $(anterior).css("display", "none");
    $("#btn_mn_" + siguiente + "_" + cla_id).css("display", "block");
    $("#hide_menu_id").val(siguiente);
    $("#hid_cla_id").val(cla_id);
    fn_cargarMenuCategoriaEstacion(siguiente, cla_id);
}

function fn_validarCredencialesAdministrador() {
    var usr_clave = $("#usr_clave").val();
    var cfac_id = $("#listadoPedido").find("li.focus").attr("id");
    var rst_id = document.getElementById("hide_rst_id").value;
    if (usr_clave.indexOf("%") >= 0) {
        var old_usr_clave = usr_clave.split("?;")[0];
        var new_usr_clave = old_usr_clave.replace(new RegExp("%", "g"), "");
        var usr_tarjeta = new_usr_clave;
        usr_clave = "noclave";
    } else {
        var usr_tarjeta = 0;
    }
    if (usr_clave != "") {
<<<<<<< HEAD
        send = { validarUsuario: 1 };
=======
        send = {"validarUsuario": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
        send.usr_clave = usr_clave;
        send.usr_tarjeta = usr_tarjeta;
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
                $("#anulacionesContenedor").dialog("close");
                $("#usr_clave").val("");
                window.location.href = "../index.php";
            } else {
                fn_numerico("#usr_clave");
                alertify.confirm("La clave ingresada no tiene permisos de Administrador.", function (e) {
                    if (e) {
<<<<<<< HEAD
                        alertify.set({ buttonFocus: "none" });
                          $("#usr_clave").focus();
=======
                        alertify.set({buttonFocus: "none"});
                        $("#usr_clave").focus();
>>>>>>> origin/MXP_Version_1.9.10.6
                    }
                });
                $("#usr_clave").val("");
            }
        });
    } else {
        fn_numerico("#usr_clave");
        alertify.confirm("Ingrese clave de Administrador", function (e) {
            if (e) {
                alertify.set({buttonFocus: "none"});
                $("#usr_clave").focus();
            }
        });
        $("#usr_clave").val("");
    }
}

function fn_validarUsuarioAdministrador() {
<<<<<<< HEAD
    var send = { obtenerDatosRegresarG: 1 };
    send.mesa_id = $("#hide_mesa_id").val();
    send.rst_id = $("#hide_rst_id").val();
    send.IDUserPos = $("#hide_usr_id").val();
=======

    var send = {"obtenerDatosRegresarG": 1};
    send.mesa_id = $('#hide_mesa_id').val();
    send.rst_id = $('#hide_rst_id').val();
    send.IDUserPos = $('#hide_usr_id').val();
>>>>>>> origin/MXP_Version_1.9.10.6
    $.ajax({
        async: false,
        type: "GET",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
            }
        }
    });

    $("#anulacionesContenedor").show();
    $("#anulacionesContenedor").dialog({
        modal: true,
        width: 500,
        heigth: 500,
        resize: false,
        opacity: 0,
        show: "none",
        hide: "none",
        duration: 500,
<<<<<<< HEAD
        open: function(event, ui) {
            $(".ui-dialog-titlebar").hide();
            fn_numerico("#usr_clave");
            $("#usr_clave").val("");
            $("#usr_clave").attr("onchange", "fn_validarCredencialesAdministrador()");
=======
        open: function (event, ui) {
            $('.ui-dialog-titlebar').hide();
            fn_numerico('#usr_clave');
            $('#usr_clave').val('');
            $('#usr_clave').attr('onchange', 'fn_validarCredencialesAdministrador()');
>>>>>>> origin/MXP_Version_1.9.10.6
        }
    });
}

function fn_salirSistema() {
<<<<<<< HEAD
    send = { cargarConfiguracionRestaurante: 1 };
    $.getJSON("config_ordenPedido.php", send, function(datos) {
=======
    send = {"cargarConfiguracionRestaurante": 1};
    $.getJSON("config_ordenPedido.php", send, function (datos) {
>>>>>>> origin/MXP_Version_1.9.10.6
        if (datos.str > 0) {
            if (datos[0]["tpsrv_descripcion"] == "FAST FOOD") {
                if ($("#listadoPedido li").length > 0) {
                    alertify.error("Estimado usuario, usted no puede salir del sistema.");
                } else {
                    window.location.replace("../index.php");
                }
            } else {
                if ($("#listadoPedido li").length < 1) {
                    fn_validarUsuarioAdministrador();
                } else {
                    alertify.error("Tiene detalle en la orden, no puede salir del sistema.");
                }
            }
        }
    });
}

function fn_resumenVentas() {
    window.location.replace("../resumen/resumenVentas.php");
}

function fn_obtenerMesa() {
<<<<<<< HEAD
    send = { obtenerMesa: 1 };
    $.getJSON("config_ordenPedido.php", send, function(datos) {
=======
    send = {"obtenerMesa": 1};
    $.getJSON("config_ordenPedido.php", send, function (datos) {
>>>>>>> origin/MXP_Version_1.9.10.6
        if (datos.str > 0) {
            var mesa = datos[0]["mesa_asignada"];
            $("body").html(
                "<form action='../ordenpedido/tomaPedido.php' name='asignarMesa' method='get' style='display:none;'><input type='text' name='numMesa' value='" +
                mesa +
                "' /></form>"
            );
            document.forms["asignarMesa"].submit();
        } else {
            alertify.alert("No existen mesas disponibles para asignar");
        }
    });
}

function fn_focusLector() {
    $("#txt_lectorBarras").focus();
}

function fn_lectorBarras() {
    $("#btn_cambio").val("gramos");
    $("#aplicaLectorBarras").val(1);
    var send;
    var codigo_barras = $("#txt_lectorBarras").val();
    var num_plu = codigo_barras;
    num_plu = num_plu;
<<<<<<< HEAD
    var send = { lectorBarras: 1 };
=======

    send = {"lectorBarras": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.cat_id = rst_categoria;
    send.num_plu = num_plu;
    send.idClasificacion = $("#hid_cla_id").val();
    send.menu_id = $("#hide_menu_id").val();
    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {
            if (datos.str > 0) {
                $("#txt_lectorBarras").val("");
                fn_focusLector();

                if (datos[0]["bandera"] == "SI") {
                    if (datos[0]["ProductoAlPeso"] == 1) {
                        $("#cantidadKG").val(datos[0]["cantidad"]);
                    } else {
                        $("#cantidadKG").val(0);
                    }
                    $("#cbcr_prgnts_sgrds").html(datos[0]["nombreProducto"]);
                    $("#alPeso").val(datos[0]["ProductoAlPeso"]);
                    $("#ventaAlPeso").val(datos[0]["ventaAlPeso"]);

                    var productoUpSelling = datos[0]["productoUpSelling"];
                    var jsonMejoraProducto = datos[0]["jsonMejoraProducto"];
                    var pvp = datos[0]["pvp"];
                    var producto = datos[0]["producto"];

                    fn_verificarGramosPlu(
                        datos[0]["magp_id"],
                        datos[0]["plu_id"],
                        datos[0]["validador"],
                        pvp,
                        producto,
                        productoUpSelling,
                        jsonMejoraProducto
                    );
                } else {
                    alertify.alert(datos[0]["mensaje"]);
                    $("#aplicaLectorBarras").val(0);
                    $("#txt_lectorBarras").val("");
                    fn_focusLector();
                }
            } else {
                alertify.alert("No existe el producto escaneado");
                $("#aplicaLectorBarras").val(0);
                $("#txt_lectorBarras").val("");
                fn_focusLector();
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            alertify.alert("ERROR AL LEER LA INFORMACION...!!");
            $("#aplicaLectorBarras").val(0);
            $("#txt_lectorBarras").val("");
            fn_focusLector();
            return false;
        }
    });
}

function fn_ipEstacion() {
<<<<<<< HEAD
    send = { ipEstacion: 1 };
=======
    send = {"ipEstacion": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.est_id = $("#hide_est_id").val();
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            $("#hide_est_ip").val(datos[0]["est_ip"]);
        } else {
            alertify.alert("No existe una IP asociada a la estaci&oacute;n");
        }
    });
    fn_focusLector();
}

/*------------------------------------------
 funcion de inicio para restaurante que si tienen opcion para llevar
 ---------------------------------------------*/
function fn_cargarMenuCategoriaEstacion(menu_id, cla_id) {
    var html = "";
    $("#barraCategoria").html(html);
    $("#barraProducto").html(html);
    $("agregarCantidad").hide();
<<<<<<< HEAD
    send = { cargarMenuCategoria: 1 };
=======
    send = {"cargarMenuCategoria": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.menu_id = menu_id;
    send.cla_id = cla_id;
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            $("#barraCategoria").empty();
            fn_activarProductos(datos[0]["mag_id"]);
            for (i = 0; i < datos.str; i++) {
                var posicionTotal = "" + datos[i]["mag_orden"] + "";
                var separar = posicionTotal.split(",");
                left = separar[0];
                arriba = separar[1];
                html +=
                    "<button id='btn_c" +
                    datos[i]["mag_id"] +
                    "' onclick='fn_activarProductos(\"" +
                    datos[i]["mag_id"] +
                    "\")' style='background-color:" +
                    datos[i]["mag_color"] +
                    "; position:absolute; color:" +
                    datos[i]["mag_colortexto"] +
                    "; left:" +
                    left +
                    "px; top:" +
                    arriba +
                    "px;'>" +
                    datos[i]["mag_descripcion"] +
                    "</button>";
                $("#codigoCategoria").val(datos[i]["mag_id"]);
            }
            $("#barraCategoria").html(html);
        } else {
            alertify.alert(
                "No existen productos configurados para esta estaci&oacute;n"
            );
        }
    });
    fn_focusLector();
}

function fn_listaPendiente() {
    fn_visualizarCantidadProducto();

    var send;
    var html = "";

    if ($("#hide_numSplit").val() === "undefined") {
        send = {
            cargar_ordenPedidoPendiente: 1,
            numSplit: 0
        };
    } else {
        send = {
            cargar_ordenPedidoPendiente: 1,
            numSplit: $("#hide_numSplit").val()
        };
    }
    send.odp_id = document.getElementById("hide_odp_id").value;
    send.cat_id = rst_categoria;
    TOTALCUENTA = 0;
    VALIDADOR = 0;

    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {
            if (datos.str > 0) {
                $("#listado ul").empty();
                var subTotalFinal = 0;
                var basedoceFinal = 0;
                var baseceroFinal = 0;
                var IvaFinal = 0;
                var TotalFinal = 0;

                for (var i = 0; i < datos.str; i++) {
                    var tipoBeneficioCupon = 0;
                    var colorBeneficioCupon = 0;
                    tipoBeneficioCupon = datos[i]["tipoBeneficioCupon"];
                    colorBeneficioCupon = datos[i]["colorBeneficioCupon"];
                    if (datos[i]["tipo"] > 0) {
                        if (parseFloat(datos[i]["dop_precio_unitario"]) > 0) {
                            if (tipoBeneficioCupon == 1) {
                                html +=
                                    "<li style='background: " +
                                    colorBeneficioCupon +
                                    "'; " +
                                    (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                    "  id='" +
                                    datos[i]["dop_id"] +
                                    "' onclick='fn_modificarLista(\"" +
                                    datos[i]["dop_id"] +
                                    '", "' +
                                    datos[i]["dop_cantidad"] +
                                    '", "' +
                                    datos[i]["plu_gramo"] +
                                    "\")' codigovalidador=" +
                                    datos[i]["codigoAnularValidacion"] +
                                    " gramos=" +
                                    datos[i]["plu_gramo"] +
                                    " anular=" +
                                    datos[i]["plu_anulacion"] +
                                    " ancestro='" +
                                    datos[i]["ancestro"] +
                                    "' tipo='" +
                                    datos[i]["tipo"] +
                                    "' cntKg='" +
                                    datos[i]["dop_cantidad"] +
                                    "' tipoBeneficioCupon='" +
                                    tipoBeneficioCupon +
                                    "'><div class='listaproductosDescTomaPedido'>" +
                                    datos[i]["magp_desc_impresion"] +
                                    "</div><div class='listaproductosValTomaPedido'>" +
                                    (datos[i]["plus_puntos"] === "1" ?
                                        datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                        "$" +
                                        (
                                            datos[i]["dop_precio_unitario"] *
                                            datos[i]["dop_cantidad"]
                                        ).toFixed(2)) +
                                    "</div><div class='listaproductosCantTomaPedido'>" +
                                    datos[i]["dop_cantidad"] +
                                    "</div></li>";
                            } else if (tipoBeneficioCupon == 2) {
                                html +=
                                    "<li style='background: " +
                                    colorBeneficioCupon +
                                    "';  " +
                                    (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                    "  id='" +
                                    datos[i]["dop_id"] +
                                    "' onclick='fn_modificarLista(\"" +
                                    datos[i]["dop_id"] +
                                    '", "' +
                                    datos[i]["dop_cantidad"] +
                                    '", "' +
                                    datos[i]["plu_gramo"] +
                                    "\")' codigovalidador=" +
                                    datos[i]["codigoAnularValidacion"] +
                                    " gramos=" +
                                    datos[i]["plu_gramo"] +
                                    " anular=" +
                                    datos[i]["plu_anulacion"] +
                                    " ancestro='" +
                                    datos[i]["ancestro"] +
                                    "' tipo='" +
                                    datos[i]["tipo"] +
                                    "' cntKg='" +
                                    datos[i]["dop_cantidad"] +
                                    "' tipoBeneficioCupon='" +
                                    tipoBeneficioCupon +
                                    "'><div class='listaproductosDescTomaPedido'>" +
                                    datos[i]["magp_desc_impresion"] +
                                    "</div><div class='listaproductosValTomaPedido'>" +
                                    (datos[i]["plus_puntos"] === "1" ?
                                        datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                        "$" +
                                        (
                                            datos[i]["dop_precio_unitario"] *
                                            datos[i]["dop_cantidad"]
                                        ).toFixed(2)) +
                                    "</div><div class='listaproductosCantTomaPedido'>" +
                                    datos[i]["dop_cantidad"] +
                                    "</div></li>";
                            } else if (tipoBeneficioCupon == 3) {
                                html +=
                                    "<li style='background: " +
                                    colorBeneficioCupon +
                                    "';  " +
                                    (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                    "  id='" +
                                    datos[i]["dop_id"] +
                                    "' onclick='fn_modificarLista(\"" +
                                    datos[i]["dop_id"] +
                                    '", "' +
                                    datos[i]["dop_cantidad"] +
                                    '", "' +
                                    datos[i]["plu_gramo"] +
                                    "\")' codigovalidador=" +
                                    datos[i]["codigoAnularValidacion"] +
                                    " gramos=" +
                                    datos[i]["plu_gramo"] +
                                    " anular=" +
                                    datos[i]["plu_anulacion"] +
                                    " ancestro='" +
                                    datos[i]["ancestro"] +
                                    "' tipo='" +
                                    datos[i]["tipo"] +
                                    "' cntKg='" +
                                    datos[i]["dop_cantidad"] +
                                    "' tipoBeneficioCupon='" +
                                    tipoBeneficioCupon +
                                    "'><div class='listaproductosDescTomaPedido'>" +
                                    datos[i]["magp_desc_impresion"] +
                                    "</div><div class='listaproductosValTomaPedido'>" +
                                    (datos[i]["plus_puntos"] === "1" ?
                                        datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                        "$" +
                                        (
                                            datos[i]["dop_precio_unitario"] *
                                            datos[i]["dop_cantidad"]
                                        ).toFixed(2)) +
                                    "</div><div class='listaproductosCantTomaPedido'>" +
                                    datos[i]["dop_cantidad"] +
                                    "</div></li>";
                            } else {
                                html +=
                                    "<li  " +
                                    (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                    "  id='" +
                                    datos[i]["dop_id"] +
                                    "' onclick='fn_modificarLista(\"" +
                                    datos[i]["dop_id"] +
                                    '", "' +
                                    datos[i]["dop_cantidad"] +
                                    '", "' +
                                    datos[i]["plu_gramo"] +
                                    "\")' codigovalidador=" +
                                    datos[i]["codigoAnularValidacion"] +
                                    " gramos=" +
                                    datos[i]["plu_gramo"] +
                                    " anular=" +
                                    datos[i]["plu_anulacion"] +
                                    " ancestro='" +
                                    datos[i]["ancestro"] +
                                    "' tipo='" +
                                    datos[i]["tipo"] +
                                    "' cntKg='" +
                                    datos[i]["dop_cantidad"] +
                                    "' tipoBeneficioCupon='" +
                                    tipoBeneficioCupon +
                                    "'><div class='listaproductosDescTomaPedido'>" +
                                    datos[i]["magp_desc_impresion"] +
                                    "</div><div class='listaproductosValTomaPedido'>" +
                                    (datos[i]["plus_puntos"] === "1" ?
                                        datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                        "$" +
                                        (
                                            datos[i]["dop_precio_unitario"] *
                                            datos[i]["dop_cantidad"]
                                        ).toFixed(2)) +
                                    "</div><div class='listaproductosCantTomaPedido'>" +
                                    datos[i]["dop_cantidad"] +
                                    "</div></li>";
                            }

                            TOTALCUENTA +=
                                datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"];

                            if (parseFloat(datos[i]["validador"]) > 0) {
                                VALIDADOR += parseFloat(datos[i]["validador"]); //).toFixed(2);
                            }

                        } else {
                            if (VISUALIZACANTIDAD === "SI") {
                                html +=
                                    "<li   " +
                                    (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                    "    id='" +
                                    datos[i]["dop_id"] +
                                    "' onclick='fn_modificarLista(\"" +
                                    datos[i]["dop_id"] +
                                    '", "' +
                                    datos[i]["dop_cantidad"] +
                                    '", "' +
                                    datos[i]["plu_gramo"] +
                                    "\")' gramos=" +
                                    datos[i]["plu_gramo"] +
                                    " anular=" +
                                    datos[i]["plu_anulacion"] +
                                    " ancestro='" +
                                    datos[i]["ancestro"] +
                                    "' tipo='" +
                                    datos[i]["tipo"] +
                                    "' cntKg='" +
                                    datos[i]["dop_cantidad"] +
                                    "' tipoBeneficioCupon='" +
                                    tipoBeneficioCupon +
                                    "'><div class='listaproductosDescTomaPedido'>" +
                                    datos[i]["magp_desc_impresion"] +
                                    "</div><div class='listaproductosValTomaPedido'></div><div class='listaproductosCantTomaPedido'>" +
                                    datos[i]["dop_cantidad"] +
                                    "</div></li>";
                            } else {
                                html +=
                                    "<li   " +
                                    (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                    "    id='" +
                                    datos[i]["dop_id"] +
                                    "' onclick='fn_modificarLista(\"" +
                                    datos[i]["dop_id"] +
                                    '", "' +
                                    datos[i]["dop_cantidad"] +
                                    '", "' +
                                    datos[i]["plu_gramo"] +
                                    "\")' gramos=" +
                                    datos[i]["plu_gramo"] +
                                    " anular=" +
                                    datos[i]["plu_anulacion"] +
                                    " ancestro='" +
                                    datos[i]["ancestro"] +
                                    "' tipo='" +
                                    datos[i]["tipo"] +
                                    "' cntKg='" +
                                    datos[i]["dop_cantidad"] +
                                    "' tipoBeneficioCupon='" +
                                    tipoBeneficioCupon +
                                    "'><div class='listaproductosDescTomaPedido'>" +
                                    datos[i]["magp_desc_impresion"] +
                                    "</div></li>";
                            }
                        }
                    } else {
                        html +=
                            "<li  " +
                            (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                            "    id='" +
                            datos[i]["plu_id"] +
                            "' onclick='fn_modificarLista(\"" +
                            datos[i]["plu_id"] +
                            '", "' +
                            datos[i]["dop_cantidad"] +
                            '", "' +
                            datos[i]["plu_gramo"] +
                            "\")' ancestro='" +
                            datos[i]["plu_id"] +
                            "' tipo='" +
                            datos[i]["tipo"] +
                            "' cntKg='" +
                            datos[i]["dop_cantidad"] +
                            "' tipoBeneficioCupon='" +
                            tipoBeneficioCupon +
                            "'><div class='listaproductosDescTomaPedido'>" +
                            datos[i]["magp_desc_impresion"] +
                            "</div></li>";
                    }

                    var subTotal =
                        datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"];
                    subTotalFinal = subTotalFinal + subTotal;

                    if (datos[i]["plu_impuesto"] == 0) {
                        var basecero =
                            datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"];
                        baseceroFinal = baseceroFinal + basecero;
                    } else if (datos[i]["plu_impuesto"] == 1) {
                        var basedoce =
                            datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"];
                        basedoceFinal = basedoceFinal + basedoce;
                    }

                    var Iva = datos[i]["dop_cantidad"] * datos[i]["dop_iva"];
                    IvaFinal = IvaFinal + Iva;
                    var Total = datos[i]["dop_cantidad"] * datos[i]["dop_total"];
                    TotalFinal = TotalFinal + Total;
                }

                $("#listadoPedido").html(html);
                var ancestro = $("li#" + datos[datos.str - 1]["dop_id"]).attr(
                    "ancestro"
                );
                if (ancestro.length > 0) {
                    $('[ancestro="' + ancestro + '"]').addClass("focus");
                } else {
                    $("li#" + datos[datos.str - 1]["dop_id"]).addClass("focus");
                }
                $(".subTotal").html(subTotalFinal.toFixed(2));
                $(".baseCero").html(baseceroFinal.toFixed(2));
                $(".baseDoce").html(basedoceFinal.toFixed(2));
                $(".Iva").html(IvaFinal.toFixed(2));
                $(".Total").html(TotalFinal.toFixed(2));
                document.getElementById("cantidad").value = "";
                lc_cantidad = 1;
            } else {
                var subTotalFinal = 0;
                var basedoceFinal = 0;
                var baseceroFinal = 0;
                var IvaFinal = 0;
                var TotalFinal = 0;
                $(".subTotal").html(subTotalFinal.toFixed(2));
                $(".baseCero").html(baseceroFinal.toFixed(2));
                $(".baseDoce").html(basedoceFinal.toFixed(2));
                $(".Iva").html(IvaFinal.toFixed(2));
                $(".Total").html(TotalFinal.toFixed(2));
                $("#listadoPedido").html("");
<<<<<<< HEAD
				validarCancelarOrdenKiosko();
=======
                validarCancelarOrdenKiosko();
>>>>>>> origin/MXP_Version_1.9.10.6
            }
        }
    });
    fn_focusLector();

    if (fidelizacionActiva()) {
        ActualizarPuntosCliente();
        fn_ActualizarQueAlcanza("ListadoProductos", 0);
    }
}

function fidelizacionActiva() {
<<<<<<< HEAD
	return $("#hide_PerteneceGrupoAmigos").val() === "1";
=======
    return $("#hide_PerteneceGrupoAmigos").val() === "1";
>>>>>>> origin/MXP_Version_1.9.10.6
}

function ActualizarPuntosCliente() {
    if (fidelizacionActiva) {
        var numeroPuntosIniciales = parseFloat($("#num_puntosIniciales").val());
<<<<<<< HEAD
        var saldo = parseFloat($("#saldo").val());
        $("#listadoPedido > li div.listaproductosValTomaPedido").each(function() {
            if ($(this).html().indexOf("P") - 1 > 0) {
                var valorRestante = $(this).html().substring(0, $(this).html().indexOf("P") - 1);
                numeroPuntosIniciales -= valorRestante;
            }
        });
	}
	
	$("#TotalPuntos").html("Total:  " + RedondearDecimales(numeroPuntosIniciales) + " pts. ");
	$("#TotalSaldo").html("Saldo: $" + RedondearDecimales(saldo));
=======
        $("#listadoPedido > li div.listaproductosValTomaPedido").each(function () {
            if (($(this).html().indexOf("P") - 1) > 0) {
                var valorRestante = ($(this).html().substring(0, $(this).html().indexOf("P") - 1));
                numeroPuntosIniciales -= valorRestante;
            }
        });
    }

    $("#TotalPuntos").html("Total:  " + RedondearDecimales(numeroPuntosIniciales) + " pts. ");
>>>>>>> origin/MXP_Version_1.9.10.6
    $("#num_puntos").val(numeroPuntosIniciales);
}

function fn_activarProductos(mag_id) {
    var context_points = '<p class="class_punto_info">500</p>';
    var html = "";
    $("#barraProducto").show();
    $("#agregarCantidad").show();
    $("#barraProducto").empty();
    $("#codigoCategoria").val(mag_id);
<<<<<<< HEAD
    send = { cargarProducto: 1 };
    send.menu_id = $("#hide_menu_id").val();
=======
    send = {"cargarProducto": 1};
    send.menu_id = $('#hide_menu_id').val();
>>>>>>> origin/MXP_Version_1.9.10.6
    send.mag_id = mag_id;
    send.cla_id = $("#hid_cla_id").val();
    send.cat_id = rst_categoria;
    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {
            if (datos.str > 0) {
                for (var i = 0; i < datos.str; i++) {
                    var posicionTotal = "" + datos[i]["magp_orden"] + "";
                    var separar = posicionTotal.split(",");
                    left = separar[0];
                    arriba = separar[1];

                    var productoUpSelling = datos[i]["productoUpSelling"];
                    var jsonMejoraProducto = datos[i]["jsonMejoraProducto"];
                    var pvp = datos[i]["pvp"];
                    var producto = datos[i]["magp_desc_impresion"];

                    var cuponSaldo = $("#spnBalanceVitality").html();
                    if ($("#hidVitality").val() == "1") {
                        data = "";
                        funcion =
                            "onclick='fn_verificarGramosPlu(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            ")'";

                        var data =
                            datos[i]["puntos"] !== -1 ?
                            '<p class="class_punto_info"> ' + datos[i]["puntos"] + "</p>" :
                            "";
                        var funcion =
                            datos[i]["puntos"] !== -1 ?
                            "onclick='fn_canjearPlus(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            " ,fn_verificarGramosPlu , " +
                            datos[i]["puntos"] +
                            "   )'" :
                            "onclick='fn_verificarGramosPlu(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            ', "' +
                            pvp +
                            '", "' +
                            producto +
                            '",  "' +
                            productoUpSelling +
                            '", ' +
                            jsonMejoraProducto +
                            ")'";                          
                        //if (datos[i]["precio"] < cuponSaldo) {   --revisar
                        if (datos[i]["pvp"] < cuponSaldo) {
                            html +=
                                "<button puntos = '" +
                                datos[i]["puntos"] +
                                "'   id='btn_p" +
                                datos[i]["magp_id"] +
                                "'  " +
                                funcion +
                                " style='position:absolute;background-color:" +
                                datos[i]["magp_color"] +
                                "; color:" +
                                datos[i]["magp_colortexto"] +
                                "; left:" +
                                left +
                                "px; top:" +
                                arriba +
                                "px;' class='producto_activo' pls_grms='" +
                                datos[i]["plu_gramo"] +
                                "'>" +
                                datos[i]["magp_desc_impresion"] +
                                " " +
                                data +
                                "</button>";
                        } else {
                            html += "<button  puntos = '" + datos[i]["puntos"] + "'   id='btn_p" + datos[i]["magp_id"] + "'  " + funcion + " style='display: none' class='producto_activo' pls_grms='" + datos[i]["plu_gramo"] + "'>" + datos[i]["magp_desc_impresion"] + " " + data + "</button>";
                        }
                    } else {
                        var data =
                            datos[i]["puntos"] !== -1 ?
                            '<p class="class_punto_info"> ' + datos[i]["puntos"] + "</p>" :
                            "";
                        var funcion =
                            datos[i]["puntos"] !== -1 ?
                            "onclick='fn_canjearPlus(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            " ,fn_verificarGramosPlu , " +
                            datos[i]["puntos"] +
                            "   )'" :
                            "onclick='fn_verificarGramosPlu(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            ', "' +
                            pvp +
                            '", "' +
                            producto +
                            '",  "' +
                            productoUpSelling +
                            '", ' +
                            jsonMejoraProducto +
                            ")'";

                        if (datos[i]["puntos"] !== -1) {
                            if ($("#num_puntos").val() >= datos[i]["puntos"]) {
                                data = '<p class="class_punto_ok">&nbsp; ✓ &nbsp;</p>';
                            } else {
                                data =
                                    '<p class="class_punto_falta"> ' +
                                    RedondearDecimales(
                                        Math.abs($("#num_puntos").val() - datos[i]["puntos"])
                                    ) +
                                    " </p>";
                            }

                            funcion =
                                "onclick='fn_canjearPlus(\"" +
                                datos[i]["magp_id"] +
                                '", ' +
                                datos[i]["plu_id"] +
                                "," +
                                datos[i]["validador"] +
                                " ,fn_verificarGramosPlu , " +
                                datos[i]["puntos"] +
                                "   )'";
                        } else {
                            data = "";
                            funcion =
                                "onclick='fn_verificarGramosPlu(\"" +
                                datos[i]["magp_id"] +
                                '", ' +
                                datos[i]["plu_id"] +
                                "," +
                                datos[i]["validador"] +
                                ', "' +
                                pvp +
                                '", "' +
                                producto +
                                '", "' +
                                productoUpSelling +
                                '", ' +
                                jsonMejoraProducto +
                                ")'";
                        }

                        if ($("#hide_PerteneceGrupoAmigos").val() === "0") {
                            data = "";
                            funcion =
                                "onclick='fn_verificarGramosPlu(\"" +
                                datos[i]["magp_id"] +
                                '", ' +
                                datos[i]["plu_id"] +
                                "," +
                                datos[i]["validador"] +
                                ', "' +
                                pvp +
                                '", "' +
                                producto +
                                '", "' +
                                productoUpSelling +
                                '", ' +
                                jsonMejoraProducto +
                                ")'";
                        }

                        if (datos[i]["std_fecha"] < 1) {
                            html +=
                                "<button puntos = '" +
                                datos[i]["puntos"] +
                                "'  id='btn_p" +
                                datos[i]["magp_id"] +
                                "'  " +
                                funcion +
                                " style=';position:absolute;background-color:" +
                                datos[i]["magp_color"] +
                                "; color:" +
                                datos[i]["magp_colortexto"] +
                                "; left:" +
                                left +
                                "px; top:" +
                                arriba +
                                "px;' class='producto_inactivo' pls_grms='" +
                                datos[i]["plu_gramo"] +
                                "' disabled>" +
                                datos[i]["magp_desc_impresion"] +
                                " " +
                                data +
                                "</button>";
                        } else {
                            html +=
                                "<button puntos = '" +
                                datos[i]["puntos"] +
                                "'   id='btn_p" +
                                datos[i]["magp_id"] +
                                "'  " +
                                funcion +
                                " style='position:absolute;background-color:" +
                                datos[i]["magp_color"] +
                                "; color:" +
                                datos[i]["magp_colortexto"] +
                                "; left:" +
                                left +
                                "px; top:" +
                                arriba +
                                "px;' class='producto_activo' pls_grms='" +
                                datos[i]["plu_gramo"] +
                                "'>" +
                                datos[i]["magp_desc_impresion"] +
                                " " +
                                data +
                                "</button>";
                        }
                    }
                }
                $("#barraProducto").html(html);
            }
        }
    });
    if (JSON_plus_puntos !== undefined) {
        fn_marcarCuadrosPlus();
    }
    fn_focusLector();
}
//VERSION 1.9.9 en la 1.9.10.6 esta comentado
function fn_okBuscar() {
    $("#keyboard").hide();
    var cantidad = $("#cantidadOK").val();
    var texto = $("#txt_busca").val();
    var plu_id = $("#hide_pluId").val();
    if (plu_id != "") {
        if (cantidad != "") {
            if (texto != "") {
                var plu_id = $("#hide_pluId").val();
                var magp_id = $("#hide_magp_id").val();
                var plu_gram = $("#hide_magp_id").val();
                lc_cantidad = cantidad;
                fn_verificarPreguntaSugerida(magp_id, plu_id, /*plu_gram,*/ 0);
                $("#cuadro_buscador").dialog("close");
                document.getElementById("hide_pluId").value = "";
                $("#txt_busca").val("");
                $("#cantidadOK").val(0);
                $("#etiqueta_cantidad").val("x1");
            } else {
                alertify.alert("Ingrese La Busqueda para Agregar Plu");
            }
        } else {
            if (texto != "") {
                var plu_id = $("#hide_pluId").val();
                var magp_id = $("#hide_magp_id").val();
                var plu_gram = $("#hide_magp_id").val();
                lc_cantidad = 1;
                fn_verificarPreguntaSugerida(magp_id, plu_id /*, plu_gram*/ , 0);
                $("#cuadro_buscador").dialog("close");
                document.getElementById("hide_pluId").value = "";
                $("#txt_busca").val("");
                $("#cantidadOK").val(0);
                $("#etiqueta_cantidad").val("x1");
            } else {
                alertify.alert("Ingrese La Busqueda para Agregar Plu");
            }
        }
    } else {
        alertify.alert("Ingrese una Busqueda correcta");
    }
    fn_focusLector();
}

function fn_verificarPreguntaSugerida(magp_id, plu_id, codigoValidador, idProductoBase) {
    console.log("fn_verificarPreguntaSugerida " + magp_id + " plu_id:" + plu_id);
    var send;
    preguntas_sug = new Array();
    var cantidad = $("#cantidadOK").val();
    var html_mod = "";
    var total_preguntas = 0;

<<<<<<< HEAD
    send = { verificarPreguntasSugerida: 1 };
=======
    send = {"verificarPreguntasSugerida": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.cat_id = rst_categoria;
    send.plu_id = plu_id;
    send.menu_id = $("#hide_menu_id").val();
    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {
            if (datos.str > 0) {

                for (var i = 0; i < datos.str; i++) {
                    var tipo_opcion = 0;
                    var psug_resp_minima = datos[i]["psug_resp_minima"];
                    var psug_resp_maxima = datos[i]["psug_resp_maxima"];
                    var psug_id = datos[i]["psug_id"];
                    var contenedor_id = i;
                    var new_contenedor_id = contenedor_id + 1;

                    if (psug_resp_minima == 0) {
                        tipo_opcion = 1;
                    }

                    preguntas_sug[i] = new Array(i, psug_resp_minima, psug_resp_maxima, tipo_opcion);
                    if (datos[i]["psug_resp_minima"] == 0) {
                        html_mod +=
                            "<div id='preguntasContenedor_" +
                            i +
                            "'  style='clear:both;'><div class='preguntasTituloOpcional'><label>" +
                            datos[i]["pre_sug_descripcion"] +
                            "</label><button class='btn_lmpr_slccn_prgnts_sugrds' onclick='fn_limpiarSeleccionPreguntaSugerida(" +
                            i +
                            ")'></button></div>";
                    } else {
                        html_mod +=
                            "<div id='preguntasContenedor_" +
                            i +
                            "'  style='clear:both;'><div class='preguntasTitulo'><label>[Obligatorio] " +
                            datos[i]["pre_sug_descripcion"] +
                            " (Min: " +
                            datos[i]["psug_resp_minima"] +
                            " - Max: " +
                            datos[i]["psug_resp_maxima"] +
                            ")</label><button class='btn_lmpr_slccn_prgnts_sugrds' onclick='fn_limpiarSeleccionPreguntaSugerida(" +
                            i +
                            ")'></button></div>";
                    }

                    var cantidadPuntos = "";
<<<<<<< HEAD
                    send = { verificarRespuestaPreguntasSugeridas: 1 };
=======
                    send = {"verificarRespuestaPreguntasSugeridas": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
                    send.psug_id = psug_id;
                    send.cat_id = rst_categoria;
                    $.ajax({
                        async: false,
                        url: "config_ordenPedido.php",
                        data: send,
                        dataType: "json",
                        success: function (datos) {
                            for (j = 0; j < datos.str; j++) {
                                var res_descripcion = datos[j]["res_descripcion"];
                                res_descripcion = res_descripcion.replace(
                                    new RegExp(" ", "g"),
                                    "_"
                                );

                                var data = "",
                                        funcion = "",
                                        puntos = "";

                                var aplicaFidelizacion =
                                    $("#fdzn_cedula").val() === 0 ||
                                    $("#fdzn_cedula").val() === "" ?
                                    false :
                                    true;
                                //
                                if (
                                    datos[j]["puntos"] > 0 &&
                                    $("#hide_fidelizacionActiva").val() === "1" &&
                                    aplicaFidelizacion
                                ) {
                                    puntos = 'puntos ="' + datos[j]["puntos"] + '"   ';

                                    if (
                                        $("#num_puntos").val() -
                                        $("#puntosPorPluNoAgrupado").val() >=
                                        datos[j]["puntos"]
                                    ) {
                                        data =
                                            "<p puntos='" +
                                            datos[j]["puntos"] +
                                            "'  class=\"class_punto_ok\" style = 'top: 40px;'>&nbsp; ✓ &nbsp;</p>";
                                    } else {
                                        data =
                                            "<p  puntos='" +
                                            datos[j]["puntos"] +
                                            "'   class=\"class_punto_falta\"style = 'top: 40px;'> " +
                                            RedondearDecimales(
                                                Math.abs(
                                                    $("#num_puntos").val() -
                                                    $("#puntosPorPluNoAgrupado").val() -
                                                    datos[j]["puntos"]
                                                )
                                            ) +
                                            " </p>";
                                    }
                                } else {
                                    data = "";
                                }

                                var funcion =
                                    data === "" ?
                                    "onclick='fn_sumarCantidadRespuestaPreguntaSugerida(" +
                                    datos[j]["plu_respuesta"] +
                                    ", " +
                                    i +
                                    ")'" :
                                    "onclick='fn_sumarCantidadRespuestaPreguntaSugeridaAlterna(" +
                                    datos[j]["plu_respuesta"] +
                                    ", " +
                                    i +
                                    "  )'";

                                html_mod +=
                                    "<div    class='divContenedorRespuestasAPreguntasSugeridas' style ='position: relative;'><button  " +
                                    puntos +
                                    "  class='btn_descripcionPreguntas_sugeridas' type='button' id='pl_prgt_sug_pcn" +
                                    datos[j]["plu_respuesta"] +
                                    "_" +
                                    i +
                                    "' name='grp_prgnts" +
                                    i +
                                    "' value='" +
                                    datos[j]["plu_respuesta"] +
                                    "'  " +
                                    funcion +
                                    " >" +
                                    datos[j]["res_descripcion"] +
                                    "</button><button value='" +
                                    datos[j]["plu_respuesta"] +
                                    "' class='slccn_cntdad_prgnts_sgrds' style='border-radius: 0px 0px 0px 0px; border: 0px solid #000000; font-size=25px; width=30px;' id='pl_prgt_sug_cnt" +
                                    datos[j]["plu_respuesta"] +
                                    "_" +
                                    i +
                                    "'>0</button>  " +
                                    data +
                                    "</div>";
                            }
                        }
                    });
                    html_mod += "</div>";
                    total_preguntas++;
                }
                console.log($("#btn_p" + magp_id).html());
                var plu_descripcion = $("#btn_p" + magp_id).html();

                if (plu_descripcion.indexOf("<") !== -1) {
                    plu_descripcion = $("#btn_p" + magp_id)
                        .html()
                        .substring(
                            0,
                            $("#btn_p" + magp_id)
                            .html()
                            .indexOf("<")
                        );
                }

                if (plu_descripcion !== undefined) {
                    if (plu_descripcion.indexOf("<") !== -1) {
                        plu_descripcion = $("#btn_p" + magp_id).html().substring(0, $("#btn_p" + magp_id).html().indexOf("<"));
                    }
                } else {
                    plu_descripcion = $("#cbcr_prgnts_sgrds").html();
                }

                plu_descripcion = plu_descripcion.toUpperCase();
                $("#cbcr_prgnts_sgrds_cntdor").html("<h4>1/" + cantidad + "</h4>");
                $("#cbcr_prgnts_sgrds").html("<h4>" + plu_descripcion + "</h4>");
                $("#cntndr_body_prgnts_sgrds").html(html_mod);
                $("#cntndr_mdl_prgnts_sgrds_btns").html(
                    '<div class="cnt_swtch_prgnts"><h5>&iquest;Agrupar Orden?</h5></div><div class="cnt_swtch_prgnts"><div class="switch"><input id="cmn-toggle-1" onclick="activarAgrupacion()" class="cmn-toggle cmn-toggle-round" type="checkbox"><label for="cmn-toggle-1"></label></div></div><input type="button" id="btn_prgnts_sgrds_cnfrmar" onclick="fn_guardarRespuestasPreguntasSugeridas(' +
                    total_preguntas +
                    ", " +
                    plu_id +
                    ", " +
                    idProductoBase +
                    ')" class="boton_Opcion_PS_Bloqueado" value="Confirmar"/>&nbsp;&nbsp;<input type="button" onclick="fn_limpiarPreguntasSugeridasTodo(' +
                    total_preguntas +
                    ')" class="boton_Opcion_PS" value="Limpiar Todo"/>&nbsp;&nbsp;<input type="button" onclick="fn_cancelarPreguntasSugeridas()" class="boton_Opcion_PS" value="Cancelar"/>'
                );
                $("#mdl_prgnts_sgrds").css("display", "block");
                $("#mdl_pcns_prgnts_sgrds").css("display", "block");
                $("#btn_prgnts_sgrds_cnfrmar").attr("disabled", true);
                if (datos.str >= 1) {
                    if (datos[0]["psug_resp_minima"] == 0) {
                        $("#btn_prgnts_sgrds_cnfrmar").attr("disabled", false);
                        $("#btn_prgnts_sgrds_cnfrmar").removeClass(
                            "boton_Opcion_PS_Bloqueado"
                        );
                        $("#btn_prgnts_sgrds_cnfrmar").addClass("boton_Opcion_PS");
                    } else {
                        $("#btn_prgnts_sgrds_cnfrmar").attr("disabled", true);
                        $("#btn_prgnts_sgrds_cnfrmar").removeClass("boton_Opcion_PS");
                        $("#btn_prgnts_sgrds_cnfrmar").addClass(
                            "boton_Opcion_PS_Bloqueado"
                        );
                    }
                }
            } else {
                if (
                    $("#hide_PerteneceGrupoAmigos").val() === "1" &&
                    $("#btn_p" + magp_id).attr("puntos") === "1"
                ) {
                    fn_descontarPuntos($("#num_puntos_plusActual").val(), $("#num_puntos").val());
                }
                fn_verificarElemnto(magp_id, plu_id, codigoValidador, idProductoBase);

            }
        }
    });
}

function activarAgrupacion() {


    var cantidadActual = 0;
    if ($("#cmn-toggle-1").attr("disabled") === undefined) {
        var cantidadAgrupacion = 1;
        var agrupacion = false;
        if ($("#cmn-toggle-1").is(":checked")) {
            agrupacion = true;
            var cantidad = $("#cantidadOK").val();
            var estado_cantidad = parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html());
            var cantidadActual = estado_cantidad;
            cantidadAgrupacion = cantidad - estado_cantidad + 1;
        }

        var cantidadPuntosActual = 0;
        $("#cntndr_body_prgnts_sgrds > div").each(function () {
            var id = $(this).attr("id");

            $("#" + id + "   > div.divContenedorRespuestasAPreguntasSugeridas >  button.slccn_cntdad_prgnts_sgrds").each(function () {
                var idinformacionPuntos = $(this).attr("id"); //
                var idinformacionCantidades = idinformacionPuntos.replace("pl_prgt_sug_cnt", "pl_prgt_sug_pcn");
                if ($("#" + idinformacionPuntos).attr("sicanjeado") !== undefined) {
                    var cantidadSeleccionada = parseInt(
                        $("#" + idinformacionPuntos).attr("sicanjeado")
                    );
                    var cantidadPuntosPorPlus = parseInt(
                        $("#" + idinformacionCantidades).attr("puntos")
                    );

                    cantidadPuntosActual +=
                        cantidadPuntosPorPlus * (cantidadSeleccionada * cantidadAgrupacion);
                }
            }); // fin foreach
            //  }// Fin validacion solo contenedor que dio  click.
        });


        if (agrupacion) {

            if (estado_cantidad === 1) {
                $("#num_puntos_plusActual").val(parseInt($("#num_puntos_plusActualiniciales").val()) + cantidadPuntosActual);
            } else {

                if (cantidadPuntosActual === 0) {
                    $("#num_puntos_plusActual").val(cantidadAgrupacion);
                } else {
                    $("#num_puntos_plusActual").val(cantidadActual + cantidadPuntosActual);

                }
            }


        } else {
            $("#num_puntos_plusActual").val(parseInt($("#num_puntos_plusActual").val()) - cantidadPuntosActual);
        }


        fn_ActualizarQueAlcanza("PreguntaSugerida", 0);

    } else {
        alertify.error("No se puede  agrupar, no le alcanzar&aacute;n los puntos.");
    }


}

function fn_sumarCantidadRespuestaPreguntaSugeridaAlterna(id, i) {

    alertify.confirm("¿Deseas canjear el producto con puntos?");
<<<<<<< HEAD
    $("#alertify-cancel").html("No");
    $("#alertify-ok").html("Si");
    $("#alertify-cancel").click(function() {
=======
    $("#alertify-cancel").html('No');
    $("#alertify-ok").html('Si');
    $("#alertify-cancel").click(function () {
>>>>>>> origin/MXP_Version_1.9.10.6

        var cdn = "pl_prgt_sug_cnt";
        if ($("#" + cdn + id + "_" + i).attr("Nocanjeado") !== undefined) {
            var numNoCajeados = parseInt($("#" + cdn + id + "_" + i).attr("Nocanjeado"));
            $("#" + cdn + id + "_" + i).attr("Nocanjeado", numNoCajeados + 1);
        } else {
            $("#" + cdn + id + "_" + i).attr("Nocanjeado", "1");
        }

        fn_sumarCantidadRespuestaPreguntaSugerida(id, i);

    });
<<<<<<< HEAD
    $("#alertify-ok").click(function() {
        var div = document.getElementById("pl_prgt_sug_pcn" + id + "_" + i);
=======
    $("#alertify-ok").click(function () {

        var div = (document.getElementById("pl_prgt_sug_pcn" + id + "_" + i));
>>>>>>> origin/MXP_Version_1.9.10.6
        if (div.getAttribute("puntos") !== null) {

            var cdn = "pl_prgt_sug_cnt";
            if ($("#" + cdn + id + "_" + i).attr("Sicanjeado") !== undefined) {
                var numNoCajeados = parseInt($("#" + cdn + id + "_" + i).attr("Sicanjeado"));
                $("#" + cdn + id + "_" + i).attr("Sicanjeado", numNoCajeados + 1);
            } else {
                $("#" + cdn + id + "_" + i).attr("Sicanjeado", "1");
            }

            var agrupacion = false;
            if ($("#cmn-toggle-1").is(":checked")) {
                agrupacion = true;
            }

            var puntosOrdenPedido = $("#num_puntos_plusActual").val();


            var puntosPluSugerido = parseInt(div.getAttribute("puntos"));
            var puntosCliente = $("#num_puntos").val();
            var puntosPreguntaSugerida = parseInt(div.getAttribute("puntos"));


            var puntosPreguntaSugerida = 0;
            if (agrupacion) {
                puntosPreguntaSugerida =
                    parseInt(div.getAttribute("puntos")) *
                    ($("#cantidadOK").val() -
                        parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html()) +
                        1);
            } else {
                puntosPreguntaSugerida = parseInt(div.getAttribute("puntos"));
                puntosOrdenPedido = $("#puntosPorPluNoAgrupado").val();
            }

            if (puntosCliente - puntosOrdenPedido >= puntosPreguntaSugerida) {
                fn_sumarPuntosAltotal(puntosPreguntaSugerida, puntosPluSugerido);
                fn_ActualizarQueAlcanza("PreguntaSugerida", 0);
                fn_sumarCantidadRespuestaPreguntaSugerida(id, i);

            } else {
                alertify.error("No tienes los puntos suficientes, te faltan un total de " + Math.abs(puntosPreguntaSugerida - (puntosCliente - puntosOrdenPedido)) + " puntos.");
            }


            //Estimar el valor que se obtendria de los producto si el cajero quisiera agrupar la orden.
            prediccionValor = -1;
            prediccion();


            var ValorEstimadoSiAgrupa = 0;

            if (cancelo) {
                ValorEstimadoSiAgrupa =
                    parseInt($("#num_puntos_plusActual").val()) +
                    parseInt(prediccionValor);
            } else {
                ValorEstimadoSiAgrupa =
                    parseInt($("#num_puntos_plusActualiniciales").val()) +
                    parseInt(prediccionValor);
            }

<<<<<<< HEAD
            if (
                parseInt($("#num_puntos").val()) < ValorEstimadoSiAgrupa &&
                !$("#cmn-toggle-1").is(":checked")
            ) {
                alertify.set({ labels: { ok: "Ok", cancel: "NO" } });
=======

            if ((parseInt($("#num_puntos").val()) < ValorEstimadoSiAgrupa) && !$("#cmn-toggle-1").is(':checked')) {
                alertify.set({labels: {ok: "Ok", cancel: "NO"}});
>>>>>>> origin/MXP_Version_1.9.10.6
                alertify.alert("Atención, no se podrá agupar los demas productos, la cantidad de puntos no alcanzará");

                $("#cmn-toggle-1").attr("disabled", "true");
            } else {
                $("#cmn-toggle-1").removeAttr("disabled");
            }


        }

    });
}

function fn_sumarCantidadRespuestaPreguntaSugerida(id, i) {

    // alert("#pl_prgt_sug_pcn" + id + "_" + i );
    var div = document.getElementById("pl_prgt_sug_pcn" + id + "_" + i);

    var contador = 0;
    $("#pl_prgt_sug_cnt" + id + "_" + i).addClass("seleccionado" + i);
    $(".seleccionado" + i).each(function () {
        cnt = $(this).text();
        contador += parseInt(cnt);
    });

    if (preguntas_sug[i][1] == 0 || contador < preguntas_sug[i][2]) {
        var qyt = $("#pl_prgt_sug_cnt" + id + "_" + i).html();
        qyt = parseInt(qyt);
        qyt++;
        $("#pl_prgt_sug_cnt" + id + "_" + i).html(qyt);
        var marcado = $("#pl_prgt_sug_pcn" + id + "_" + i).hasClass("seleccionado");
        if (!marcado) {
            $("#pl_prgt_sug_pcn" + id + "_" + i).addClass("seleccionado");
        }
    } else {
<<<<<<< HEAD
        $("#preguntasContenedor_" + preguntas_sug[i][0])
            .find(".preguntasTitulo")
            .css({ background: "#BD6120" });
=======
        $("#preguntasContenedor_" + preguntas_sug[i][0]).find(".preguntasTitulo").css({"background": "#BD6120"});
>>>>>>> origin/MXP_Version_1.9.10.6
    }
    fn_verificarRespuestasPreguntassugeridas();
}


function fn_eliminarPuntosPreguntaSegerida(i, limpiarTodo) {
    var cantidadPuntosActual = 0;
    $("#cntndr_body_prgnts_sgrds > div").each(function () {
        var id = $(this).attr("id");


        // Valido que solo se busque en el contenedor que dio eliminar.
        //    if (id === ("preguntasContenedor_" + i) || true) {


        $("#" + id + "   > div.divContenedorRespuestasAPreguntasSugeridas >  button.slccn_cntdad_prgnts_sgrds").each(function () {
            var idinformacionPuntos = $(this).attr("id"); //
            var idinformacionCantidades = idinformacionPuntos.replace("pl_prgt_sug_cnt", "pl_prgt_sug_pcn");
            if ($("#" + idinformacionPuntos).attr("sicanjeado") !== undefined) {
                var cantidadSeleccionada = parseInt(
                    $("#" + idinformacionPuntos).attr("sicanjeado")
                );
                var cantidadPuntosPorPlus = parseInt(
                    $("#" + idinformacionCantidades).attr("puntos")
                );

                cantidadPuntosActual += cantidadPuntosPorPlus * cantidadSeleccionada;

                $("#" + idinformacionPuntos).removeAttr("sicanjeado");
                $("#" + idinformacionPuntos).removeAttr("nocanjeado");

            }
        }); // fin foreach
        //  }// Fin validacion solo contenedor que dio  click.

    });

    if ($("#cmn-toggle-1").is(":checked")) {
        var cantidad = $("#cantidadOK").val();
        var estado_cantidad = parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html());
        cantidad = cantidad - estado_cantidad + 1;
    }

    $("#num_puntos_plusActual").val(
        parseInt($("#num_puntos_plusActual").val()) - cantidadPuntosActual
    );

    $("#puntosPorPluNoAgrupado").val(
        parseInt($("#puntosPorPluNoAgrupado").val()) - cantidadPuntosActual
    );

    $(".seleccionado" + i).removeAttr("sicanjeado");
    $(".seleccionado" + i).removeAttr("nocanjeado");
    fn_ActualizarQueAlcanza("PreguntaSugerida", 0);
}

function fn_limpiarSeleccionPreguntaSugerida(i) {
<<<<<<< HEAD
    $("#preguntasContenedor_" + preguntas_sug[i][0])
        .find(".preguntasTitulo")
        .css({ background: "#0E98B6" });
=======
    $("#preguntasContenedor_" + preguntas_sug[i][0]).find(".preguntasTitulo").css({"background": "#0E98B6"});

>>>>>>> origin/MXP_Version_1.9.10.6

    // Eliminar att caje y no canje
    if (fidelizacionActiva()) {
        fn_eliminarPuntosPreguntaSegerida(i, false);

        $("#cmn-toggle-1").removeAttr("disabled");
    }


    $(".seleccionado" + i).html(0);
<<<<<<< HEAD
    $("#preguntasContenedor_"+i+" .seleccionado").removeClass("seleccionado");
=======
    $("#preguntasContenedor_" + i + " .seleccionado").removeClass("seleccionado");
>>>>>>> origin/MXP_Version_1.9.10.6
    $(".seleccionado" + i).removeClass("seleccionado" + i);


    fn_verificarRespuestasPreguntassugeridas();
}

function fn_cancelarPreguntasSugeridas() {
    $("#cantidad").val(1);
    $("#cantidadOK").val(1);
    $("#etiqueta_cantidad").val("x1");
    $("#mdl_prgnts_sgrds").css("display", "none");
    $("#mdl_pcns_prgnts_sgrds").css("display", "none");

    if (fidelizacionActiva()) {
        fn_ActualizarQueAlcanza("ListadoProductos", 0);
    }

}

function fn_limpiarPreguntasSugeridasTodo(total_preguntas) {


    if (fidelizacionActiva()) {
        fn_eliminarPuntosPreguntaSegerida(i, true);
        $("#cmn-toggle-1").removeAttr("disabled");
    }

    $(".slccn_cntdad_prgnts_sgrds").html(0);
    for (var i = 0; i < total_preguntas; i++) {
        $(".seleccionado" + i).removeClass("seleccionado" + i);
<<<<<<< HEAD
        $("#preguntasContenedor_" + preguntas_sug[i][0])
            .find(".preguntasTitulo")
            .css({ background: "#0E98B6" });
=======
        $("#preguntasContenedor_" + preguntas_sug[i][0]).find(".preguntasTitulo").css({"background": "#0E98B6"});
>>>>>>> origin/MXP_Version_1.9.10.6
    }

    $(".seleccionado").removeClass("seleccionado");

    fn_verificarRespuestasPreguntassugeridas();
}

function fn_verificarRespuestasPreguntassugeridas() {
    var continuar = true;
    var total_preguntas = preguntas_sug.length;

    for (var i = 0; i < total_preguntas; i++) {
        preguntas_sug[i][4] = 0;
        $(".seleccionado" + i).each(function () {
            cnt = $(this).text();
            preguntas_sug[i][4] = preguntas_sug[i][4] + parseInt(cnt);
        });

    }
    for (var i = 0; i < total_preguntas; i++) {
        if (preguntas_sug[i][1] != 0) {
            if (
                preguntas_sug[i][4] < preguntas_sug[i][1] ||
                preguntas_sug[i][4] > preguntas_sug[i][2]
            ) {
                continuar = false;
            }
        }
    }
    if (continuar) {
        $("#btn_prgnts_sgrds_cnfrmar").attr("disabled", false);
        $("#btn_prgnts_sgrds_cnfrmar").removeClass("boton_Opcion_PS_Bloqueado");
        $("#btn_prgnts_sgrds_cnfrmar").addClass("boton_Opcion_PS");
    } else {
        $("#btn_prgnts_sgrds_cnfrmar").attr("disabled", true);
        $("#btn_prgnts_sgrds_cnfrmar").removeClass("boton_Opcion_PS");
        $("#btn_prgnts_sgrds_cnfrmar").addClass("boton_Opcion_PS_Bloqueado");
    }
}

function esElUltimo() {
    var final = false;
    var cantidad = $("#cantidadOK").val();
    var estado_cantidad = 0;
    estado_cantidad = parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html());
    if (cantidad - estado_cantidad + 1 === 1) {
        final = true;
    } else {
        final = false;
    }
    return final;
}

function fn_guardarRespuestasPreguntasSugeridas(total_preguntas, plu_id, idProductoBase) {
    if (descontarPuntos) {
        if ($("#cmn-toggle-1").is(":checked")) {
            if (esElUltimo()) {
                fn_descontarPuntos($("#puntosPorPluNoAgrupado").val(), $("#num_puntos").val());
            } else {
                fn_descontarPuntos($("#num_puntos_plusActual").val(), $("#num_puntos").val());
            }

        } else {
            fn_descontarPuntos($("#puntosPorPluNoAgrupado").val(), $("#num_puntos").val());
        }
    }


    var agrupacion = false;
    var prg_opcional = "";
    var estado_cantidad = 0;
    var cantidad = $("#cantidadOK").val();
    var continuar = true;
    var odp_id = document.getElementById("hide_odp_id").value;
    var cdn_plus = "";
    var cnt = 0;
    estado_cantidad = parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html());

    if ($("#cmn-toggle-1").is(":checked")) {
        agrupacion = true;
    }
    if (agrupacion) {
        cdn_plus = plu_id + "_" + (cantidad - estado_cantidad + 1) + "_1_0_"; // add _0_ por agrupacion.
    } else {
        cdn_plus = plu_id + "_1_1_0_";
    }

    for (i = 0; i < total_preguntas; i++) {
        preguntas_sug[i][4] = 0;
        /*
         $(".seleccionado"+i).each(function () {
         cnt = $(this).text();
         */
        $(".seleccionado" + i).each(function () {

            cnt = $(this).text();


            var hayCanjeado = false,
                    hayNoCanjeado = false; //  alert("SIcanjeado" + $(this).attr("sicanjeado") + " Nocanejado" + $(this).attr("nocanjeado"));

            if ($(this).attr("sicanjeado") !== undefined) {
                hayCanjeado = true;
            }
            if ($(this).attr("nocanjeado") !== undefined) {
                hayNoCanjeado = true;
            }

            if (preguntas_sug[i][3] == 0) {
                if (agrupacion) {
                    if (hayCanjeado) {
                        cdn_plus += $(this).val() + "_" + cnt * (cantidad - estado_cantidad + 1) + "_" + preguntas_sug[i][3] + "_1_";
                    } else {
                        cdn_plus += $(this).val() + "_" + cnt * (cantidad - estado_cantidad + 1) + "_" + preguntas_sug[i][3] + "_0_";
                    }


                } else {

                    if (hayCanjeado) {
                        cdn_plus += $(this).val() + "_" + $(this).attr("sicanjeado") + "_" + preguntas_sug[i][3] + "_1_";
                    }
                    if (hayNoCanjeado) {
                        cdn_plus += $(this).val() + "_" + $(this).attr("nocanjeado") + "_" + preguntas_sug[i][3] + "_0_";
                    }
                    if (!hayCanjeado && !hayNoCanjeado) {
                        cdn_plus += $(this).val() + "_" + cnt + "_" + preguntas_sug[i][3] + "_0_";
                    }


                }
            } else {
                if (agrupacion) {

                    if (hayCanjeado) {
                        prg_opcional +=
                            $(this).val() +
                            "_" +
                            cantidad * $(this).attr("sicanjeado") +
                            "_" +
                            preguntas_sug[i][3] +
                            "_1_";
                    }
                    if (hayNoCanjeado) {
                        prg_opcional +=
                            $(this).val() +
                            "_" +
                            cantidad * $(this).attr("nocanjeado") +
                            "_" +
                            preguntas_sug[i][3] +
                            "_0_";
                    }
                    if (!hayCanjeado && !hayNoCanjeado) {
                        prg_opcional += $(this).val() + "_" + cnt * (cantidad - estado_cantidad + 1) + "_" + preguntas_sug[i][3] + "_0_";
                    }


                } else {

                    if (hayCanjeado) {
                        prg_opcional += $(this).val() + "_" + $(this).attr("sicanjeado") + "_" + preguntas_sug[i][3] + "_1_";
                    }
                    if (hayNoCanjeado) {
                        prg_opcional += $(this).val() + "_" + $(this).attr("nocanjeado") + "_" + preguntas_sug[i][3] + "_0_";
                    }
                    if (!hayCanjeado && !hayNoCanjeado) {
                        prg_opcional += $(this).val() + "_" + cnt + "_" + preguntas_sug[i][3] + "_0_";
                    }


                }
            }
            preguntas_sug[i][4] = preguntas_sug[i][4] + parseInt(cnt);
        });
    }
    cdn_plus += prg_opcional;
    for (i = 0; i < total_preguntas; i++) {
        if (preguntas_sug[i][1] != 0) {
<<<<<<< HEAD
            if (
                preguntas_sug[i][4] < preguntas_sug[i][1] ||
                preguntas_sug[i][4] > preguntas_sug[i][2]
            ) {
                $("#preguntasContenedor_" + preguntas_sug[i][0])
                    .find(".preguntasTitulo")
                    .css({ background: "#BD6120" });
                continuar = false;
            } else {
                $("#preguntasContenedor_" + preguntas_sug[i][0])
                    .find(".preguntasTitulo")
                    .css({ background: "#0E98B6" });
=======
            if ((preguntas_sug[i][4]) < preguntas_sug[i][1] || (preguntas_sug[i][4]) > preguntas_sug[i][2]) {
                $("#preguntasContenedor_" + preguntas_sug[i][0]).find(".preguntasTitulo").css({"background": "#BD6120"});
                continuar = false;
            } else {
                $("#preguntasContenedor_" + preguntas_sug[i][0]).find(".preguntasTitulo").css({"background": "#0E98B6"});
>>>>>>> origin/MXP_Version_1.9.10.6
            }
        }
    }

    if (continuar) {
        var send;

<<<<<<< HEAD
        send = { agregarPreguntaSugerida: 1 };
=======
        send = {"agregarPreguntaSugerida": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
        send.cat_id = rst_categoria;
        send.odp_id = odp_id;
        send.plus = cdn_plus;
        send.cantidad = 1;
        send.dop_cuenta = $("#hide_numSplit").val() ? $("#hide_numSplit").val() : 1;
        send.plus_puntos = plus_puntos === plu_id ? 1 : 0;
        send.idProductoBase = idProductoBase;
        $.ajax({
            async: false,
            url: "config_ordenPedido.php",
            data: send,
            dataType: "json",
            success: function (datos) {

                if (datos.str > 0) {
                    $("#listado ul").empty();
                    for (i = 0; i < datos.str; i++) {
                        var tipoBeneficioCupon = 0;
                        var colorBeneficioCupon = 0;
                        tipoBeneficioCupon = datos[i]["tipoBeneficioCupon"];
                        colorBeneficioCupon = datos[i]["colorBeneficioCupon"];
                        if (datos[i]["tipo"] > 0) {
                            if (parseFloat(datos[i]["dop_precio_unitario"]) > 0) {
                                if (tipoBeneficioCupon == 1) {
                                    html =
                                        "<li style='background: " +
                                        colorBeneficioCupon +
                                        "'; " +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            ' class= "puntos" ' :
                                            "") +
                                        "  id='" +
                                        datos[i]["dop_id"] +
                                        "' onclick='fn_modificarLista(\"" +
                                        datos[i]["dop_id"] +
                                        '", "' +
                                        datos[i]["dop_cantidad"] +
                                        '", "' +
                                        datos[i]["plu_gramo"] +
                                        "\")' gramos=" +
                                        datos[i]["plu_gramo"] +
                                        " anular=" +
                                        datos[i]["plu_anulacion"] +
                                        " ancestro='" +
                                        datos[i]["ancestro"] +
                                        "' tipo='" +
                                        datos[i]["tipo"] +
                                        "' cntKg='" +
                                        datos[i]["dop_cantidad"] +
                                        "' tipoBeneficioCupon='" +
                                        tipoBeneficioCupon +
                                        "'><div class='listaproductosDescTomaPedido'>" +
                                        datos[i]["magp_desc_impresion"] +
                                        "</div><div class='listaproductosValTomaPedido'>" +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                            "$" +
                                            (
                                                datos[i]["dop_precio_unitario"] *
                                                datos[i]["dop_cantidad"]
                                            ).toFixed(2)) +
                                        "</div><div class='listaproductosCantTomaPedido'>" +
                                        datos[i]["dop_cantidad"] +
                                        "</div></li>";
                                } else if (tipoBeneficioCupon == 2) {
                                    html =
                                        "<li style='background: " +
                                        colorBeneficioCupon +
                                        "'; " +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            ' class= "puntos" ' :
                                            "") +
                                        "  id='" +
                                        datos[i]["dop_id"] +
                                        "' onclick='fn_modificarLista(\"" +
                                        datos[i]["dop_id"] +
                                        '", "' +
                                        datos[i]["dop_cantidad"] +
                                        '", "' +
                                        datos[i]["plu_gramo"] +
                                        "\")' gramos=" +
                                        datos[i]["plu_gramo"] +
                                        " anular=" +
                                        datos[i]["plu_anulacion"] +
                                        " ancestro='" +
                                        datos[i]["ancestro"] +
                                        "' tipo='" +
                                        datos[i]["tipo"] +
                                        "' cntKg='" +
                                        datos[i]["dop_cantidad"] +
                                        "' tipoBeneficioCupon='" +
                                        tipoBeneficioCupon +
                                        "'><div class='listaproductosDescTomaPedido'>" +
                                        datos[i]["magp_desc_impresion"] +
                                        "</div><div class='listaproductosValTomaPedido'>" +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                            "$" +
                                            (
                                                datos[i]["dop_precio_unitario"] *
                                                datos[i]["dop_cantidad"]
                                            ).toFixed(2)) +
                                        "</div><div class='listaproductosCantTomaPedido'>" +
                                        datos[i]["dop_cantidad"] +
                                        "</div></li>";
                                } else if (tipoBeneficioCupon == 3) {
                                    html =
                                        "<li style='background: " +
                                        colorBeneficioCupon +
                                        "'; " +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            ' class= "puntos" ' :
                                            "") +
                                        "  id='" +
                                        datos[i]["dop_id"] +
                                        "' onclick='fn_modificarLista(\"" +
                                        datos[i]["dop_id"] +
                                        '", "' +
                                        datos[i]["dop_cantidad"] +
                                        '", "' +
                                        datos[i]["plu_gramo"] +
                                        "\")' gramos=" +
                                        datos[i]["plu_gramo"] +
                                        " anular=" +
                                        datos[i]["plu_anulacion"] +
                                        " ancestro='" +
                                        datos[i]["ancestro"] +
                                        "' tipo='" +
                                        datos[i]["tipo"] +
                                        "' cntKg='" +
                                        datos[i]["dop_cantidad"] +
                                        "' tipoBeneficioCupon='" +
                                        tipoBeneficioCupon +
                                        "'><div class='listaproductosDescTomaPedido'>" +
                                        datos[i]["magp_desc_impresion"] +
                                        "</div><div class='listaproductosValTomaPedido'>" +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                            "$" +
                                            (
                                                datos[i]["dop_precio_unitario"] *
                                                datos[i]["dop_cantidad"]
                                            ).toFixed(2)) +
                                        "</div><div class='listaproductosCantTomaPedido'>" +
                                        datos[i]["dop_cantidad"] +
                                        "</div></li>";
                                } else {
                                    html =
                                        "<li " +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            ' class= "puntos" ' :
                                            "") +
                                        "  id='" +
                                        datos[i]["dop_id"] +
                                        "' onclick='fn_modificarLista(\"" +
                                        datos[i]["dop_id"] +
                                        '", "' +
                                        datos[i]["dop_cantidad"] +
                                        '", "' +
                                        datos[i]["plu_gramo"] +
                                        "\")' gramos=" +
                                        datos[i]["plu_gramo"] +
                                        " anular=" +
                                        datos[i]["plu_anulacion"] +
                                        " ancestro='" +
                                        datos[i]["ancestro"] +
                                        "' tipo='" +
                                        datos[i]["tipo"] +
                                        "' cntKg='" +
                                        datos[i]["dop_cantidad"] +
                                        "' tipoBeneficioCupon='" +
                                        tipoBeneficioCupon +
                                        "'><div class='listaproductosDescTomaPedido'>" +
                                        datos[i]["magp_desc_impresion"] +
                                        "</div><div class='listaproductosValTomaPedido'>" +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                            "$" +
                                            (
                                                datos[i]["dop_precio_unitario"] *
                                                datos[i]["dop_cantidad"]
                                            ).toFixed(2)) +
                                        "</div><div class='listaproductosCantTomaPedido'>" +
                                        datos[i]["dop_cantidad"] +
                                        "</div></li>";
                                }
                                TOTALCUENTA +=
                                    datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"]; //).toFixed(2);

                                if (parseFloat(datos[i]["validador"]) > 0) {
                                    VALIDADOR += parseFloat(datos[i]["validador"]); //).toFixed(2);
                                }

                                $("#listadoPedido").append(html);
                            } else {
                                if (VISUALIZACANTIDAD === "SI") {
                                    html =
                                        "<li " +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            ' class= "puntos" ' :
                                            "") +
                                        "  id='" +
                                        datos[i]["dop_id"] +
                                        "' onclick='fn_modificarLista(\"" +
                                        datos[i]["dop_id"] +
                                        '", "' +
                                        datos[i]["dop_cantidad"] +
                                        '", "' +
                                        datos[i]["plu_gramo"] +
                                        "\")' gramos=" +
                                        datos[i]["plu_gramo"] +
                                        " anular=" +
                                        datos[i]["plu_anulacion"] +
                                        " ancestro='" +
                                        datos[i]["ancestro"] +
                                        "' tipo='" +
                                        datos[i]["tipo"] +
                                        "'><div class='listaproductosDescTomaPedido'>" +
                                        datos[i]["magp_desc_impresion"] +
                                        "</div><div class='listaproductosValTomaPedido'></div><div class='listaproductosCantTomaPedido'>" +
                                        datos[i]["dop_cantidad"] +
                                        "</div></li>";
                                } else {
                                    html =
                                        "<li " +
                                        (datos[i]["plus_puntos"] === "1" ?
                                            ' class= "puntos" ' :
                                            "") +
                                        "  id='" +
                                        datos[i]["dop_id"] +
                                        "' onclick='fn_modificarLista(\"" +
                                        datos[i]["dop_id"] +
                                        '", "' +
                                        datos[i]["dop_cantidad"] +
                                        '", "' +
                                        datos[i]["plu_gramo"] +
                                        "\")' gramos=" +
                                        datos[i]["plu_gramo"] +
                                        " anular=" +
                                        datos[i]["plu_anulacion"] +
                                        " ancestro='" +
                                        datos[i]["ancestro"] +
                                        "' tipo='" +
                                        datos[i]["tipo"] +
                                        "'><div class='listaproductosDescTomaPedido'>" +
                                        datos[i]["magp_desc_impresion"] +
                                        "</div></li>";
                                }
                                $("#listadoPedido").append(html);

                            }
                        } else {
                            html =
                                "<li " +
                                (datos[i]["plus_puntos"] === "1" ? ' class= "puntos" ' : "") +
                                "  id='" +
                                datos[i]["plu_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["plu_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' ancestro='" +
                                datos[i]["plu_id"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div></li>";
                            $("#listadoPedido").append(html);
                        }

                        if (i == datos.str - 1) {
                            var ancestro = 0;
                            ancestro = datos[i]["ancestro"];
                            $("#listadoPedido li").removeClass("focus");
                            $("#" + datos[i]["dop_id"]).addClass("focus");
                            if (ancestro.length > 0) {
                                $('[ancestro="' + ancestro + '"]').addClass("focus");
                            }

                        }
                    }
                    $("#cantidad").val("");
                    $("#etiqueta_cantidad").val("x1");
                    lc_cantidad = 1;
                } else {
                    $("#listadoPedido").html("");
                }
            }
        });
        if (estado_cantidad == cantidad || agrupacion) {
            $("#cantidadOK").val(1);
            $("#etiqueta_cantidad").val("x1");
            $("#mdl_prgnts_sgrds").css("display", "none");
            $("#mdl_pcns_prgnts_sgrds").css("display", "none");
            $("#cntndr_body_prgnts_sgrds").html("");
            fn_focusLector();
        } else {
            estado_cantidad++;
            $("#cbcr_prgnts_sgrds_cntdor h4").html(estado_cantidad + "/" + cantidad);
            for (i = 0; i < total_preguntas; i++) {
                $("input[name=grp_prgnts" + i + "]").attr("checked", false);
            }
            $(".slccn_cntdad_prgnts_sgrds").html(0);
<<<<<<< HEAD
            $("#mdl_prcns_prgnts_sgrds")
                .find(".preguntasTitulo")
                .css({ background: "#0E98B6" });
            $("#btn_prgnts_sgrds_cnfrmar").attr("disabled", true);
            $("#btn_prgnts_sgrds_cnfrmar").removeClass("boton_Opcion_PS");
            $("#btn_prgnts_sgrds_cnfrmar").addClass("boton_Opcion_PS_Bloqueado");
=======
            $("#mdl_prcns_prgnts_sgrds").find(".preguntasTitulo").css({"background": "#0E98B6"});
            $('#btn_prgnts_sgrds_cnfrmar').attr("disabled", true);
            $('#btn_prgnts_sgrds_cnfrmar').removeClass('boton_Opcion_PS');
            $('#btn_prgnts_sgrds_cnfrmar').addClass("boton_Opcion_PS_Bloqueado");
>>>>>>> origin/MXP_Version_1.9.10.6
        }
    }

    if (descontarPuntos) {
        fn_eliminarPuntosPreguntaSegerida(0, true);
        $("#puntosPorPluNoAgrupado").val(puntosDelPlu);
    }
}

function fn_cerrarDialogo(new_contenedor_id) {
    if ($("#preguntasContenedor_" + new_contenedor_id + "").length > 0) {
        var less_new_contenedor_id = new_contenedor_id - 1;
        $("#preguntasContenedor_" + less_new_contenedor_id + "").hide();
        $("#preguntasContenedor_" + new_contenedor_id + "").removeClass("preguntasOculto");
        $("#preguntasContenedor_" + new_contenedor_id + "").show(500);
        $("#pluAgregar").val("");
        $("#magpAgregar").val("");
    } else {
        $("#preguntasContenedor").dialog("close");
        $("#preguntasContenedor").empty();
        $("#pluAgregar").val("");
        $("#magpAgregar").val("");
    }
    fn_focusLector();
}

function fn_modificarLista(dop_id) {
    $("#cantidadKG").val(cantidad);
    $("#alPeso").val(alPeso);
    var ancestro = "";
    var tipo_plu = 0;
    ancestro = $("#" + dop_id).attr("ancestro");
    tipo_plu = $("#" + dop_id).attr("tipo");
    $("#listadoPedido li").removeClass("focus");
    $("#" + dop_id).addClass("focus");
    if (ancestro.length > 0) {
        $('[ancestro="' + ancestro + '"]').addClass("focus");
    }
    fn_focusLector();

    if (tipo_plu > 0) {
        if ($("#" + ancestro).val() == 0 && $("#hid_bandera_gramo").val() == 1) {
            alertify.alert(
                "No puede aplicar cantidad en gramos para eliminar este producto."
            );
            $("#hid_bandera_gramo").val(0);
            fn_focusLector();
            return false;
        }
    }
}

function fn_verificarGramosPluBusqueda(magp_id, plu_id, validaMinimo, pvp, producto, productoUpSelling, jsonProductosMejora) {
    fn_cerrarModalBuscador();

    if (productoUpSelling == "SI") {
        validaProductoUpSelling(plu_id, magp_id, pvp, producto, jsonProductosMejora);
    } else {
        fn_verificarGramosPlu(magp_id, plu_id, validaMinimo, pvp, producto, productoUpSelling, jsonProductosMejora);
    }
}

function fn_verificarGramosPluBusqueda(magp_id, plu_id, validaMinimo) {
    fn_cerrarModalBuscador();
    fn_verificarGramosPlu(magp_id, plu_id, validaMinimo);
}

function solicitudHorneado(plu_id) {
<<<<<<< HEAD
    var send = { solicitudHorneado: 1 };
=======
    var send = {"solicitudHorneado": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.plu_id = plu_id;
    send.idControlEstacion = $("#idControlEstacion").val();
    send.idEstacion = $("#hide_est_id").val();
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        Accept: "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                APLICA_SOLICITUD_HORNEADO = datos[0]["aplica"];
                RUTA_SOLICITUD_HORNEADO = datos[0]["ruta"];
                CAJERO = datos[0]["cajero"];
                SERVIDOR = datos[0]["servidor"];
                IPESTACION = datos[0]["ipEstacion"];
                TIENDA = datos[0]["tienda"];
                IDCAJERO = datos[0]["IDUsersPos"];
                IMPRESORA = datos[0]["impresora"];

            }
        }
    });
}

function moduloSolicitudHorneado(url) {
    var win = open(url, "_blank");
    win.focus();
}

function fn_verificarGramosPlu(magp_id, plu_id, validaMinimo, pvp, producto, productoUpSelling, jsonProductosMejora) {
    console.log("fn_verificarGramosPlu " + magp_id);
    solicitudHorneado(plu_id);
    if ($("#listadoPedido li").length > 0) {
        if ($("#hidVitality").val() == "1") {
            alertify.alert("Este cupón aplica solo  para  un producto").delay(5);
        } else {
            if (APLICA_SOLICITUD_HORNEADO == 1) {
                var idRestaurante = $("#hide_rst_id").val();
                var parametros = "&id_Resta=" + idRestaurante + "&nombreVendedor=" + CAJERO + "&nombreLocal=" + TIENDA + "&imp_ip_estacion=" + IPESTACION + "&IDUsersPos=" + IDCAJERO + "&serverDB=" + SERVIDOR + "&imp_impresora=" + IMPRESORA;

                moduloSolicitudHorneado(
                    "http://" + SERVIDOR + RUTA_SOLICITUD_HORNEADO + parametros
                );

                APLICA_SOLICITUD_HORNEADO = 0;
                RUTA_SOLICITUD_HORNEADO = "";

                /* VALIDACION PARA DIGITAR PRODUCTO EN FUERA DE HORARIO */
                validarPeriodo(magp_id, plu_id, validaMinimo, pvp, producto, productoUpSelling, jsonProductosMejora);

            } else {
                APLICA_SOLICITUD_HORNEADO = 0;
                RUTA_SOLICITUD_HORNEADO = "";

                /* VALIDACION PARA DIGITAR PRODUCTO EN FUERA DE HORARIO */
                validarPeriodo(
                    magp_id,
                    plu_id,
                    validaMinimo,
                    pvp,
                    producto,
                    productoUpSelling,
                    jsonProductosMejora
                );
            }


        }
    } else {
        if (APLICA_SOLICITUD_HORNEADO == 1) {
            var idRestaurante = $("#hide_rst_id").val();
            var parametros = "&id_Resta=" + idRestaurante + "&nombreVendedor=" + CAJERO + "&nombreLocal=" + TIENDA + "&imp_ip_estacion=" + IPESTACION + "&IDUsersPos=" + IDCAJERO + "&serverDB=" + SERVIDOR + "&imp_impresora=" + IMPRESORA;

            moduloSolicitudHorneado(
                "http://" + SERVIDOR + RUTA_SOLICITUD_HORNEADO + parametros
            );

            APLICA_SOLICITUD_HORNEADO = 0;
            RUTA_SOLICITUD_HORNEADO = "";

            /* VALIDACION PARA DIGITAR PRODUCTO EN FUERA DE HORARIO */
            validarPeriodo(magp_id, plu_id, validaMinimo, pvp, producto, productoUpSelling, jsonProductosMejora);

        } else {
            APLICA_SOLICITUD_HORNEADO = 0;
            RUTA_SOLICITUD_HORNEADO = "";

            /* VALIDACION PARA DIGITAR PRODUCTO EN FUERA DE HORARIO */
            validarPeriodo(
                magp_id,
                plu_id,
                validaMinimo,
                pvp,
                producto,
                productoUpSelling,
                jsonProductosMejora
            );
        }


    }




}

//FUNCION VERSION 1.9.10.6
function validarPeriodo(magp_id, plu_id, validaMinimo, pvp, producto, productoUpSelling, jsonProductosMejora) {
    console.log("validarPeriodo " + magp_id);
    solicitudHorneado(plu_id);
    var send;
    var cantidadKG = $("#cantidadKG").val();
    var aplicaLectorBarras = $("#aplicaLectorBarras").val();
    var alPeso = $("#alPeso").val();
    var cantidad;
    var ventaAlPeso = $("#ventaAlPeso").val();
    var mensajeCierrePeriodo = "";

    if (aplicaLectorBarras == 0) {
        alPeso = $("#btn_p" + magp_id).attr("pls_grms");
    } else {
        alPeso = $("#alPeso").val();
    }

    if (alPeso == 1) {
        if (ventaAlPeso == 1) {
            cantidad = cantidadKG;
        } else {
            cantidad = $("#cantidadOK").val();
        }
    } else {
        cantidad = $("#cantidadOK").val();
    }

<<<<<<< HEAD
    send = { validaFechaOtroPeriodo: 1 };
=======
    send = {"validaFechaOtroPeriodo": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.fechaPeriodoAbierto = $("#nfrmcn_srs_sstm_periodo").html().trim();
    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {
            if (datos.str > 0) {
                if (datos[0].respuesta === 1) {
                    if (alPeso == 0 && cantidad.indexOf(".") > 0) {
                        alertify.alert("No se puede aplicar cantidad en gramos para este productosss.");
                        $("#cantidadOK").val(1);
                        $("#aplicaLectorBarras").val(0);
                        return false;
                    } else {
                        if (validaMinimo > 0) {
                            fn_ejecutaValidaciones(magp_id, plu_id, 0);
                        } else {
                            if (productoUpSelling == "SI") {
                                validaProductoUpSelling(plu_id, magp_id, pvp, producto, jsonProductosMejora);
                            } else {
                                console.log("validarPeriodo " + magp_id);
                                fn_verificarPreguntaSugerida(magp_id, plu_id, 0, 0);

                            }
                        }
                    }
                } else {
                    alertify.set({labels: {ok: "SI", cancel: "NO"}});

                    //Si la fecha de apertura del periodo se encuentra en la misma fecha del servidor
                    if (datos[0].cierrePeriodo === 1) {
                        mensajeCierrePeriodo = "Usted supero su horario de atenci&oacute;n. Est&aacute; seguro que desea seguir facturando en el periodo: <h3>" + datos[0].fechaAperturaPeriodo + " </h3> ";
                    }
                    //Si la fecha del servidor no es la misma que la fecha de apertura del periodo
                    else {
                        mensajeCierrePeriodo = "Usted se encuentra en otro periodo. Est&aacute; seguro que desea seguir facturando en el periodo: <h3>" + datos[0].fechaAperturaPeriodo + " </h3> ";
                    }

                    alertify.confirm(mensajeCierrePeriodo, function (e) {
                        //puede seguir facturando
                        if (e) {
                            if (alPeso == 0 && cantidad.indexOf(".") > 0) {
                                alertify.alert("No se puede aplicar cantidad en gramos para este producto.");
                                $("#aplicaLectorBarras").val(0);
                                return false;
                            } else {
                                if (validaMinimo > 0) {
                                    fn_ejecutaValidaciones(magp_id, plu_id, 0);
                                } else {
                                    if (productoUpSelling == "SI") {
                                        validaProductoUpSelling(plu_id, magp_id, pvp, producto, jsonProductosMejora);
                                    } else {
                                        console.log("aplicaLectorBarras " + magp_id);
                                        fn_verificarPreguntaSugerida(magp_id, plu_id, 0, 0);
                                    }
                                }
                            }
                        }
                    });
                }
            } else {
                alertify.error("ERROR AL LEER LA INFORMACION.");
                $("#aplicaLectorBarras").val(0);
                return false;
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            alertify.alert("ERROR AL LEER LA INFORMACION.");
            $("#aplicaLectorBarras").val(0);
            return false;
        }
    });
}

//FUNCION VERSION 1.9.9


function fn_ejecutaValidaciones(magp_id, plu_id, idProductoBase) {

    var send;

    send = {};
    send.buscarValidacionesPLU = 1;
    send.plu_id = plu_id;
    $.ajax({
        url: "../ordenpedido/config_ordenPedido.php",
        type: "POST",
        dataType: "json",
        accept: "application/json",
        data: send,
        async: false,
        success: function (datos) {
            //console.log(datos);
            var validaciones = datos.validaciones;
            var posicionHeladeria = $.inArray("HELADERIA", validaciones);
            var validaMinimo = datos.valorMinimo;
            var existeCajeroActivo = true;
            var nombre_canje = "";

            //No hay validaciones por relizar, continuar
            if (datos.str == 0) {
                fn_verificarPreguntaSugerida(magp_id, plu_id, 0, idProductoBase);
                return true;
            }
            //Si tiene Validacion de Heladeria, priorizar
            if (posicionHeladeria >= 0) {
                existeCajeroActivo = fn_validaCajeroHeladeria(magp_id, plu_id);
                if (false == existeCajeroActivo) {
                    return false;
                } else if (true == existeCajeroActivo && validaciones.length === 1) {
                    fn_verificarPreguntaSugerida(magp_id, plu_id, 0, idProductoBase);
                }
                validaciones.splice(posicionHeladeria, 1);
            }

            //ValidaciÃ³n de Go Trade
            if ($.inArray("GO TRADE", validaciones) >= 0) {

                nombre_canje = "GO TRADE";

                if (!existeCajeroActivo)
                    return false;

                if (parseFloat(TOTALCUENTA) < parseFloat(validaMinimo)) {
                    alertify.alert("Para aplicar este producto el TOTAL de la cuenta debe ser superior a: $ " + parseFloat(validaMinimo).toFixed(2));
                    return false;

                } else {
                    fn_abreTeclado(magp_id, plu_id, validaMinimo, idProductoBase, nombre_canje);
                }
            }

            if ($.inArray("FIFTEAM", validaciones) >= 0) {

                nombre_canje = "FIFTEAM";

                if (!existeCajeroActivo) {
                    return false;   
                }

                fn_abreTeclado(magp_id, plu_id, validaMinimo, idProductoBase, nombre_canje);
            }
        }
    });
}

function fn_validaCajeroHeladeria(maggp_id, plu_id) {
    fn_cargando(1);
    var resp = false;
    var send;
    send = {};
    send.metodo = "validaCajeroHeladeria";
<<<<<<< HEAD
    send.fecha_prd  = $("#nfrmcn_srs_sstm_periodo").html();
    
=======
    send.fecha_prd = $("#nfrmcn_srs_sstm_periodo").html();

>>>>>>> origin/MXP_Version_1.9.10.6
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        Accept: "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "../ordenpedido/configWS.php",
        data: send,
        success: function (datos) {
            fn_cargando(0);
            if (datos.estado == 1) {
                resp = true;
                return true;

            } else if (datos.estado == 0) {
                alertify.alert("No existe un cajero activo en la estación de transferencia. No puede digitar este producto.");
                resp = false;
                return false;
<<<<<<< HEAD
             
=======

>>>>>>> origin/MXP_Version_1.9.10.6
            } else if (datos.estado == 3) {
                alertify.alert(datos.mensaje);
                resp = false;
                return false;
<<<<<<< HEAD
            } 
            else {
=======
            } else {
>>>>>>> origin/MXP_Version_1.9.10.6
                alertify.alert("Existen problemas al realizar está operación.");
                console.log("Existen problemas tratando de consultar Web Service.");
                resp = false;
                return false;
            }
        },
        error: function () { // Cuando el WS no esta en linea
            fn_cargando(0);
            alertify.alert("Existen problemas al realizar está operación.");
            console.log("Existen problemas tratando de consultar Web Service.");

            return false;
        }
    });
    return resp;
}

function fn_abreTeclado(magpid, pluid, validaMinimo, idProductoBase, nombre_canje) {
    $("#tecladoCodigos").show();
    $("#tecladoCodigos").dialog({
        modal: true,
        width: 500,
        heigth: 500,
        resize: false,
        opacity: 0,
        show: "none",
        hide: "none",
        duration: 500,
        open: function (event, ui) {
            $(".ui-dialog-titlebar").hide();
            fn_numerico("#txt_codigos");
            $("#txt_codigos").val("");
            $("#txt_codigos").attr(
                "onchange",
                'fn_validaCodigo(event,"' +
                magpid +
                '","' +
                pluid +
                '","' +
                validaMinimo +
                '", "' +
                idProductoBase +
                '","' +
                nombre_canje +
                '")'
            );
        }
    });
}

function fn_validaCodigo(event, mg, pl, validaMinimo, idProductoBase, nombre_canje) {

    if ($("#txt_codigos").val() == "") {
        alertify.alert("Debe ingrerar un código.");
        fn_numerico("#txt_codigos");
        
        return false;   
    }

    fn_cargando(1);
    event.stopPropagation();    
    send = {};
<<<<<<< HEAD
    send.metodo = "validaCodigo";    
    send.codigo = $("#txt_codigos").val();
    
    if (nombre_canje == "GO TRADE") {        
        send.bandera = "compra";
        $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            Accept: "application/json, text/javascript2",
            contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
            url: "../ordenpedido/configWS.php",
            data: send,
            success: function(datos) {
                fn_cargando(0);
                $("#tecladoCodigos").dialog("close");
                $("#numPad").hide();

                if (datos.status == 0) {
                    VALIDADOR = validaMinimo;
                    codigoAgrabar = $("#txt_codigos").val();
                    fn_verificarPreguntaSugerida(mg, pl, codigoAgrabar, idProductoBase);
                    $("#txt_codigos").val("");
                } else {
                    alertify.alert(datos.mensaje);
                    $("#txt_codigos").val("");
                    return false;
                }
=======
    send.metodo = "validaCodigo";
    send.codigo = $('#txt_codigos').val();
    send.bandera = "compra";
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        "Accept": "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "../ordenpedido/configWS.php",
        data: send,
        success: function (datos) {
            fn_cargando(0);
            $("#tecladoCodigos").dialog("close");
            $("#numPad").hide();

            if (datos.status == 0) {
                VALIDADOR = validaMinimo;
                codigoAgrabar = $("#txt_codigos").val();
                fn_verificarPreguntaSugerida(mg, pl, codigoAgrabar, idProductoBase);
                $("#txt_codigos").val("");
            } else {
                alertify.alert(datos.mensaje);
                $("#txt_codigos").val("");
                return false;
>>>>>>> origin/MXP_Version_1.9.10.6
            }
        });    
    } else {        
        $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            Accept: "application/json, text/javascript2",
            contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
            url: "../ordenpedido/config_ws_fifteam.php",
            data: send,
            success: function(datos) {
                fn_cargando(0);
                $("#tecladoCodigos").dialog("close");
                $("#numPad").hide();                

                if (datos.mensaje == "OK") {
                    codigoAgrabar = $("#txt_codigos").val();

                    fn_verificarPreguntaSugerida(mg, pl, codigoAgrabar, idProductoBase);

                    $("#txt_codigos").val("");   
                } else {
                    var msj = '<h4><b>FIFTEAM</b></h4> <h4><b>Atenci&oacute;n:</b> '+datos.mensaje+'!!!</h4>';

                    alertify.error(msj, function(e) {});


                    $("#txt_codigos").val("");

                    return false;
                } 
            }
        });
    }    
}

function fn_verificarElemnto(magp_id, plu_id, codigoValidado, idProductoBase) {
    var send;
    var cantidad;
    var catidadKG = $("#cantidadKG").val();
    var alPeso = $("#alPeso").val();
    var ventaAlPeso = $("#ventaAlPeso").val();

    if (alPeso == 1) {
        if (ventaAlPeso == 1) {
            cantidad = catidadKG;
        } else {
            cantidad = $("#cantidadOK").val();
        }
    } else {
        cantidad = $("#cantidadOK").val();
    }

    if ($("#btn_salonLlevar").val() == "Salon") {
        lc_control = 1;
    } else {
        lc_control = 2;
    }

    $("#btn_p" + magp_id + "").prop("disabled", true);
    $("#magpAgregar").val("");
    $("#magpAgregar").val(magp_id);
    $("#listado ul").empty();
    var odp_id = $("#hide_odp_id").val();
    var dop_id = $("#hide_dop_id").val();
    var totalito = 0;
    TOTALCUENTA = 0;
    VALIDADOR = 0;
    var numSplit = 1;
    numSplit = $("#hide_numSplit").val() ? $("#hide_numSplit").val() : 1;
    //send = {"agregarPlusOrdenPedido": 1};
    var split = 1;
    split = $("#hide_numSplit").val() ? $("#hide_numSplit").val() : 1;
    send = {
        agregarPlusOrdenPedido: 1,
        numSplit: $("#hide_numSplit").val()
    };

    send = {
        agregarPlusOrdenPedido: 1,
        numSplit: numSplit
    };
    send.cat_id = rst_categoria;
    send.odp_id = odp_id;
    send.plu_id = plu_id;
    send.cantidad = cantidad;
    send.menuId = $("#hide_menu_id").val();
    send.codigoValidadoo = codigoValidado;
    send.plus_puntos = plus_puntos === plu_id ? 1 : 0;
    send.idProductoBase = idProductoBase;

    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            var html;
            $("#listado ul").empty();
            for (i = 0; i < datos.str; i++) {
                var tipoBeneficioCupon = 0;
                var colorBeneficioCupon = 0;
                tipoBeneficioCupon = datos[i]["tipoBeneficioCupon"];
                colorBeneficioCupon = datos[i]["colorBeneficioCupon"];
                if (datos[i]["tipo"] > 0) {
                    if (parseFloat(datos[i]["dop_precio_unitario"]) > 0) {
                        if (tipoBeneficioCupon > 0) {
                            html =
                                "<li style='background: " +
                                colorBeneficioCupon +
                                "';  " +
                                (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' codigoValidador=" +
                                datos[i]["codigoAnularValidacion"] +
                                " gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "' cntKg='" +
                                datos[i]["dop_cantidad"] +
                                "' tipoBeneficioCupon='" +
                                tipoBeneficioCupon +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div><div class='listaproductosValTomaPedido'>" +
                                (datos[i]["plus_puntos"] === "1" ?
                                    datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                    "$" +
                                    (
                                        datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"]
                                    ).toFixed(2)) +
                                "</div><div class='listaproductosCantTomaPedido'>" +
                                datos[i]["dop_cantidad"] +
                                "</div></li>";
                        } else {
                            html =
                                "<li  " +
                                (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' codigoValidador=" +
                                datos[i]["codigoAnularValidacion"] +
                                " gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "' cntKg='" +
                                datos[i]["dop_cantidad"] +
                                "' tipoBeneficioCupon='" +
                                tipoBeneficioCupon +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div><div class='listaproductosValTomaPedido'>" +
                                (datos[i]["plus_puntos"] === "1" ?
                                    datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                    "$" +
                                    (
                                        datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"]
                                    ).toFixed(2)) +
                                "</div><div class='listaproductosCantTomaPedido'>" +
                                datos[i]["dop_cantidad"] +
                                "</div></li>";
                        }

                        TOTALCUENTA +=
                            datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"]; //).toFixed(2);

                        if (parseFloat(datos[i]["validador"]) > 0) {
                            VALIDADOR += parseFloat(datos[i]["validador"]); //).toFixed(2);
                        }

                        $("#listadoPedido").append(html);
                    } else {
                        if (VISUALIZACANTIDAD === "SI") {
                            html =
                                "<li   " +
                                (datos[i]["plus_puntos"] === 1 ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div><div class='listaproductosValTomaPedido'></div><div class='listaproductosCantTomaPedido'>" +
                                datos[i]["dop_cantidad"] +
                                "</div></li>";
                        } else {
                            html =
                                "<li   " +
                                (datos[i]["plus_puntos"] === 1 ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div></li>";
                        }
                        $("#listadoPedido").append(html);
                    }
                } else {
                    html =
                        "<li  " +
                        (datos[i]["plus_puntos"] === 1 ? 'class="puntos" ' : "") +
                        "   id='" +
                        datos[i]["plu_id"] +
                        "' onclick='fn_modificarLista(\"" +
                        datos[i]["plu_id"] +
                        '", "' +
                        datos[i]["dop_cantidad"] +
                        '", "' +
                        datos[i]["plu_gramo"] +
                        "\")' ancestro='" +
                        datos[i]["plu_id"] +
                        "' tipo='" +
                        datos[i]["tipo"] +
                        "'><div class='listaproductosDescTomaPedido'>" +
                        datos[i]["magp_desc_impresion"] +
                        "</div></li>";

                    $("#listadoPedido").append(html);
                }
                if (i == datos.str - 1) {
                    var ancestro = 0;
                    ancestro = datos[i]["ancestro"];
                    $("#listadoPedido li").removeClass("focus");
                    $("#" + datos[i]["dop_id"]).addClass("focus");
                    if (ancestro.length > 0) {
                        $('[ancestro="' + ancestro + '"]').addClass("focus");
                    }
                }
            }

            $("#cantidad").val(0);
            $("#cantidadOK").val(1);
            $("#cantidadKG").val(0);
            $("#alPeso").val(0);
            $("#etiqueta_cantidad").val("x1");
            lc_cantidad = 1;
            fn_kds();
            $("#aplicaLectorBarras").val(0);
        }
    });
    $("#btn_p" + magp_id + "").prop("disabled", false);
    fn_focusLector();
    Accion = 0;
    lc_cantidad = 1;
}

function fn_kds() {
<<<<<<< HEAD
    send = { kds: 1 };
    $.getJSON("config_ordenPedido.php", send, function(datos) {});
=======
    send = {"kds": 1};
    $.getJSON("config_ordenPedido.php", send, function (datos) {});
>>>>>>> origin/MXP_Version_1.9.10.6
}

function fn_validarAnulacion() {
    var tipo_plu = 0;
    var dop_id = 0;
    var ancestro = 0;
    var tipoBeneficioCupon = $("#listadoPedido").find("li.focus").attr("tipobeneficiocupon");
    tipoBeneficioCupon = tipoBeneficioCupon ? tipoBeneficioCupon : 0;
    if (!$("li.focus").length) {
        alertify.alert("No ha seleccionado un producto para eliminar");
    } else {
        ancestro = $("#listadoPedido").find("li.focus").attr("ancestro");
        if ($("li.focus").length < 2) {
            dop_id = $("#listadoPedido").find("li.focus").attr("id");
        } else {
            dop_id = $("#listadoPedido").find("li.focus").attr("ancestro");
        }

        tipo_plu = $("#listadoPedido").find("li.focus").attr("tipo");
        odp_id_agregar = dop_id;
        $("#btn_eliminarElemnto").prop("disabled", true);

        if (tipo_plu > 0) {
            if ($("#listadoPedido").find("li.focus").attr("anular") > 0) {
                $("#anulacionesContenedor").show();
                $("#anulacionesContenedor").dialog({
                    modal: true,
                    width: 500,
                    heigth: 500,
                    resize: false,
                    opacity: 0,
                    show: "none",
                    hide: "none",
                    duration: 500,
                    open: function (event, ui) {
                        $(".ui-dialog-titlebar").hide();
                        fn_numerico("#usr_clave");
                        $("#usr_clave").val("");
                        $("#usr_clave").attr("onchange", "fn_validarUsuario()");
                    }
                });
            } else {
                if (tipoBeneficioCupon == 0) {
                    fn_validarTiempo(dop_id);
                } else {
                    confirmarEliminarCanjeCupon(dop_id, 1);
                }
            }
        } else {
            tipoBeneficioCupon != 0 ? confirmarEliminarCanjeCupon(dop_id, 2) : fn_eliminarTextoPlu(dop_id);
            var send = { eliminarTextoPlu: 1 };
            send.dop_id = dop_id;
            $.getJSON("config_ordenPedido.php", send, function(datos) {
                if (datos.Confirmar > 0) {
                    ancestro = $("li#" + dop_id).prev().attr("ancestro");
                    if (ancestro.length > 0) {
                        $('[ancestro="' + ancestro + '"]').addClass("focus");
                    } else {
                        $("li#" + dop_id).prev().addClass("focus");
                    }
                    $("li#" + dop_id).remove();
                    $("#btn_eliminarElemnto").prop("disabled", false);
                }
            });
        }
    }
    fn_focusLector();
}

function fn_eliminarTextoPlu(dop_id) {
    var dop_cuenta = $("#hide_numeroCuenta").val() ? $("#hide_numeroCuenta").val() : 1;
    var odp_id = $("#hide_odp_id").val();
<<<<<<< HEAD
    send = { eliminarTextoPlu: 1 };
=======
    send = {"eliminarTextoPlu": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.dop_id = dop_id;
    send.odp_id = odp_id;
    send.dop_cuenta = dop_cuenta;
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.Confirmar > 0) {
            fn_inactivarCanjeTextoCupon(odp_id, dop_id);
            ancestro = $("li#" + dop_id)
                .prev()
                .attr("ancestro");
            if (ancestro.length > 0) {
                $('[ancestro="' + ancestro + '"]').addClass("focus");
            } else {
                $("li#" + dop_id)
                    .prev()
                    .addClass("focus");
            }
            $("li#" + dop_id).remove();
            $("#btn_eliminarElemnto").prop("disabled", false);
        }
    });

    fn_listaPendiente();
}

function confirmarEliminarCanjeCupon(dop_id, accion) {
    alertify.set({
        labels: {
            ok: "SI",
            cancel: "NO"
        }
    });

    alertify.confirm("<h4>¿Desea eliminar los productos de un cup&oacute;n canjeado?</h4><br>", function (e) {
        if (e) {
            // SI
            if (accion == 1)
                fn_validarTiempo(dop_id);
            if (accion == 2)
                fn_eliminarTextoPlu(dop_id);


        } else {
                $("#btn_eliminarElemnto").prop("disabled", false);
        }
    });
}

function fn_validarUsuario() {
    $("#numPad").hide();
    var usr_clave = $("#usr_clave").val();
    if (usr_clave.indexOf("%") >= 0) {
        var old_usr_clave = usr_clave.split("?;")[0];
        var new_usr_clave = old_usr_clave.replace(new RegExp("%", "g"), "");
        var usr_tarjeta = new_usr_clave;
        usr_clave = "noclave";
    } else {
        var usr_tarjeta = 0;
    }
    if (usr_clave != "") {
<<<<<<< HEAD
        send = { validarUsuario: 1 };
=======
        send = {"validarUsuario": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
        send.usr_clave = usr_clave;
        send.usr_tarjeta = usr_tarjeta;
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
                $("#anulacionesContenedor").dialog("close");
                $("#usr_clave").val("");
                fn_eliminarElemento();
            } else {
                fn_numerico("#usr_clave");
                alertify.confirm("La clave ingresada no tiene permisos para anulaciones", function (e) {
                    if (e) {
                        alertify.set({buttonFocus: "none"});
                        $("#usr_clave").focus();
                    }
                });
                $("#usr_clave").val("");
            }
        });
    } else {
        alertify.confirm("Ingrese la clave para anular el producto", function (e) {
            if (e) {
                alertify.set({buttonFocus: "none"});
                $("#usr_clave").focus();
                fn_numerico("#usr_clave");
            }
        });
        $("#usr_clave").val("");
    }
    fn_focusLector();
}

function fn_validarTiempo(dop_id) {
    var odp_id = document.getElementById("hide_odp_id").value;
    var rst_id = document.getElementById("hide_rst_id").value;
<<<<<<< HEAD
    send = { validarTiempoPlu: 1 };
=======
    send = {"validarTiempoPlu": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.dop_id = dop_id;
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            var plu_creacionfecha = datos[0]["plu_creacionfecha"];

            if (plu_creacionfecha < rst_tiempopedido) {
                fn_eliminarElemento();
            } else {
                $("#anulacionesContenedor").show();
                $("#anulacionesContenedor").dialog({
                    modal: true,
                    width: 500,
                    heigth: 500,
                    resize: false,
                    opacity: 0,
                    show: "none",
                    hide: "none",
                    duration: 500,
                    open: function (event, ui) {
                        $(".ui-dialog-titlebar").hide();
                        fn_numerico("#usr_clave");
                        $("#usr_clave").val("");
                        $("#usr_clave").attr("onchange", "fn_validarUsuario()");
                    }
                });
            }
        } else {
            alertify.alert("No se pudo validar el tiempo de pedido");
        }
    });
    fn_focusLector();
}

function fn_cerrarDialogoAnulacion(id) {
    if ($(id).prop("id") === "txt_codigos") {
        $("#tecladoCodigos").dialog("close");
        $("#txt_codigos").val("");
        $("#keyboard").hide();
        $("#numPad").hide();
    } else {
        $("#anulacionesContenedor").dialog("close");
        $("#usr_clave").val("");
        $("#numPad").hide();
        $("#keyboard").hide();
        $("#btn_eliminarElemnto").prop("disabled", false);
        fn_focusLector();
    }
}

function fn_eliminarElemento() {
    //Variable cantidad anular
    var send;
    var cantidadAnular; // = $("#cantidadOK").val();
    var dop_id = 0;
    var tipo_plu = 0;
    var odp_id = $("#hide_odp_id").val();
    var cantidadKG = $("#listadoPedido").find("li.focus").attr("cntKg");
    var alPeso = $("#listadoPedido").find("li.focus").attr("gramos");
    var tipoBeneficioCupon = $("#listadoPedido").find("li.focus").attr("tipobeneficiocupon");

    if (alPeso == 1) {
        cantidadAnular = cantidadKG;
    } else {
        cantidadAnular = $("#cantidadOK").val();
    }

    if (!$("li.focus").length) {
        alertify.alert("No ha seleccionado un producto para eliminar");
    } else {
        if ($("li.focus").length < 2) {
            dop_id = $("#listadoPedido").find("li.focus").attr("id");
        } else {
            dop_id = $("#listadoPedido").find("li.focus").attr("ancestro");
        }

<<<<<<< HEAD
        var sends = { estaImpreso: 1 };
=======
        var sends = {"estaImpreso": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
        sends.dop_id = dop_id;

        $.ajax({
            async: false,
            url: "config_ordenPedido.php",
            data: sends,
            dataType: "json",
<<<<<<< HEAD
            success: function(datos) {
                if (datos[0]["respuesta"] === "No") {
                    $("#btn_eliminarElemnto").prop("disabled", true);

                    send = { verificarUltimoElemento: 1 };
=======
            success: function (datos) {
                if (datos[0]['respuesta'] === "No") {
                    $('#btn_eliminarElemnto').prop("disabled", true);

                    send = {"verificarUltimoElemento": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
                    send.dop_id = dop_id;
                    send.odp_id = odp_id;
                    send.cantidadAnular = cantidadAnular; //lc_cantidad;
                    $.ajax({
                        async: false,
                        url: "config_ordenPedido.php",
                        data: send,
                        dataType: "json",
                        success: function (datos) {
                            //Elimina el último producto de la orden
                            if (datos.str == 1) {
<<<<<<< HEAD
                                send = { eliminarUltimoElemento: 1 };
=======
                                send = {"eliminarUltimoElemento": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
                                send.dop_id = dop_id;
                                send.odp_id = odp_id;
                                send.cantidadAnular = cantidadAnular; //lc_cantidad;
                                send.gramos = alPeso;
                                send.tipoBeneficioCupon = tipoBeneficioCupon ? tipoBeneficioCupon : 0;
                                $.ajax({
                                    async: false,
                                    url: "config_ordenPedido.php",
                                    data: send,
                                    dataType: "json",
                                    success: function (datos) {
                                        fn_listaPendiente();
                                        document.getElementById("cantidad").value = "";
                                        lc_cantidad = 1;
                                        $("#cantidadOK").val(1);
                                        $("#etiqueta_cantidad").val("x1");
                                    }
                                });
                                $("#btn_eliminarElemnto").prop("disabled", false);
                            } else {
<<<<<<< HEAD
                                send = { eliminarunElemento: 1 };
=======
                                send = {"eliminarunElemento": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
                                send.dop_id = dop_id;
                                send.odp_id = odp_id;
                                send.cantidadAnular = cantidadAnular; //lc_cantidad;
                                send.gramos = alPeso;
                                send.tipoBeneficioCupon = tipoBeneficioCupon;
                                $.ajax({
                                    async: false,
                                    url: "config_ordenPedido.php",
                                    data: send,
                                    dataType: "json",
                                    success: function (datos) {
                                        if (datos.str > 0) {
                                            if (datos[0]["Resultado"] > 0) {
                                                var pluCantidadAnt = $("li#" + datos[0]["dop_id"] + " .listaproductosCantTomaPedido").text();
                                                var pluCantidadNew = datos[0]["dop_cantidad"];
                                                var pluPrecio = datos[0]["dop_precio_unitario"] * datos[0]["dop_cantidad"];
                                                var pluPrecioNew = "$" + pluPrecio.toFixed(2);

                                                if (datos[0]["plus_puntos"] === "1") {
                                                    pluCantidadNew = datos[0]["dop_cantidad"];
                                                    pluPrecio = datos[0]["puntos"] * datos[0]["dop_cantidad"];
                                                    pluPrecioNew = pluPrecio + " Pts.";
                                                }

                                                $("li.focus").text("");

                                                html =
                                                    "<div class='listaproductosDescTomaPedido'>" +
                                                    datos[0]["magp_desc_impresion"] +
                                                    "<input type='hidden' id='hid_" +
                                                    dop_id +
                                                    "' value='" +
                                                    tipo_plu +
                                                    "'></div><div class='listaproductosValTomaPedido'></div><div class='listaproductosCantTomaPedido'>" +
                                                    pluCantidadNew +
                                                    "</div></li>";
                                            } else {
                                                html =
                                                    "<div class='listaproductosDescTomaPedido'>" +
                                                    datos[0]["magp_desc_impresion"] +
                                                    "<input type='hidden' id='hid_" +
                                                    dop_id +
                                                    "' value='" +
                                                    tipo_plu +
                                                    "'></div><div class='listaproductosValTomaPedido'>$" +
                                                    pluPrecioNew +
                                                    "</div><div class='listaproductosCantTomaPedido'>" +
                                                    pluCantidadNew +
                                                    "</div></li>";
                                            }

                                            $("li.focus").append(html);
                                            $("cantidad").val("");
                                            lc_cantidad = 1;
                                            $("#cantidadOK").val(1);
                                            $("#etiqueta_cantidad").val("x1");
                                            $("#cantidadKG").val(0);
                                            $("#alPeso").val(0);
                                        } else {
                                            lc_cantidad = 1;
                                            alertify.alert("La cantidad anular es menor a la ingresada.");
                                        }
                                        fn_listaPendiente();
                                    }
                                });
                                $("#btn_eliminarElemnto").prop("disabled", false);
                            }
                            //Inactivar registro de canje de cupon
                            fn_inactivarCanjeProductoCupon(odp_id, dop_id);
                        }
                    });
                } else {
                    $("#btn_eliminarElemnto").prop("disabled", false);
                    alertify.error("El producto ya esta impreso.");
                }
            }
        });
    }
    fn_focusLector();
}

function fn_volver(mesa_id) {
    var aux = "";
    //window.location.href = "../ordenpedido/userMesas.php";
<<<<<<< HEAD
    send = { guardarCuenta: 1 };
=======
    send = {"guardarCuenta": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.mesa_id = mesa_id;
    send.idEstacion = $("#hide_est_id").val();
    send.IDUsersPos = $("#hide_usr_id").val();
    send.rst_id = $("#hide_rst_id").val();

    $.ajax({
        async: false,
        type: "GET",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                aux = "?IDPisos=" + datos[0]["IDPisos"] + "&IDAreaPiso=" + datos[0]["IDAreaPiso"];
                window.location.href = "../ordenpedido/userMesas.php" + aux;
            }
        },
        complete: function (data) {
            fn_imprimirOrdenPedido();
        }
    });
}

function fn_cobrar(dop_cuenta) {
    if (!$("#listadoPedido li").length) {
        alertify.alert("No ha seleccionado un producto para cobrar");
    } else {
        if (fn_validarCupones(dop_cuenta)) {
<<<<<<< HEAD
            var orden_pedido = $("#hide_odp_id").val();
            var hidVitality = $("#hidVitality").val();
            if (validarVitalityCupo(orden_pedido,hidVitality)) {
            // Revisar estas 2 funciones que se comentan
            //fn_insertaQsr();
            //fn_canalesImpresion();
=======
>>>>>>> origin/MXP_Version_1.9.10.6
            var odp_id = document.getElementById("hide_odp_id").value;
            var mesa_id = document.getElementById("hide_mesa_id").value;
            $("#formCobrar").html('<form action="../facturacion/factura.php" name="cobro" method="post" style="display:none;"><input type="text" name="odp_id" value="' + odp_id + '" /><input type="text" name="dop_cuenta" value="' + dop_cuenta + '" /><input type="text" name="mesa_id" value="' + mesa_id + '" /></form>');
            document.forms["cobro"].submit();
        } else {
            alertify.error("El Valor Total de Productos Excede El CupÃ³n");
            }
        } else {
            alertify.error("No se puede realizar el cobro.");

        }
    }
    return false;
}

function fn_validarCupones(dop_cuenta) {


    var validacion_promociones = 0;

   fn_statusPromociones();
    if (statusPromocion) {          
        validacion_promociones = 1//fn_existe_promocion(dop_cuenta);
    } else {
        validacion_promociones = 1;
    }
    return validacion_promociones;
}

function fn_statusPromociones() {
<<<<<<< HEAD
    send = { statusPromociones: 1 };
=======
    send = {"statusPromociones": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.cdn_id = $("#hide_cdn_id").val();
    send.rst_id = $("#hide_rst_id").val();
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        statusPromocion = datos;
        return statusPromocion;
    });
}

function fn_existe_promocion(dop_cuenta) {
    var permiteCobrar = 0;
<<<<<<< HEAD
    var odp_id = $("#hide_odp_id").val();
    var send = { ValidarPromocion: 1 };
=======
    var odp_id = $('#hide_odp_id').val();
    var send = {"ValidarPromocion": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.opcion = "ValidarPromocion";
    send.odp_id = odp_id;
    send.dop_cuenta = dop_cuenta;

    $.ajax({
        async: false,
        type: "GET",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                permiteCobrar = Boolean(Number(datos[0]["estado"]));
                if (!permiteCobrar) {
                    alertify.alert("<div>No se puede realizar el canje de la promoción <strong>" + datos[0]["nombre"] + "</strong> debido a: </div><div><strong>" + datos[0]["mensaje"] + "</strong></div>");
                }
            } else {
                permiteCobrar = 1;
            }
        }

    });
    return permiteCobrar;
}


//borrar
function fn_cobrarCupon(index) {
<<<<<<< HEAD
    if (!$("#listadoPedido li").length) {
        alertify.alert("No ha seleccionado un producto para cobrar");
=======
    if (!($('#listadoPedido li').length)) {
        alertify.alert('No ha seleccionado un producto para cobrar');
>>>>>>> origin/MXP_Version_1.9.10.6
    } else {
        var montoMax = $("#" + index).text();
        if ($.isNumeric(montoMax)) {
            var odp_id = document.getElementById("hide_odp_id").value;
            var mesa_id = document.getElementById("hide_mesa_id").value;
            var dop_cuenta = document.getElementById("hide_numeroCuenta").value;


            //        alert($("#hide_tipov_id").val());
            var datoTxt = encodeURI($("#input_cuponSistemaGerenteAutEXT").val());

            var parametros = '<input type="text" name="hide_cli_direccion" value="' + $("#hide_cli_direccion").val() + '" />  ';
            parametros += '<input type="text" name="hide_cli_documento" value="' + $("#hide_cli_documento").val() + '" />  ';
            parametros += '<input type="text" name="hide_cli_email" value="' + $("#hide_cli_email").val() + '" />  ';
            parametros += '<input type="text" name="hide_cli_nombres" value="' + $("#hide_cli_nombres").val() + '" />  ';
            parametros += '<input type="text" name="hide_cli_telefono" value="' + $("#hide_cli_telefono").val() + '" />  ';
            parametros += '<input type="text" name="hide_montoCupon" value="' + montoMax + '" />  ';

            $("#formCobrar").html(
                '<form action="../facturacion/factura.php" name="cobro" method="post" style="display:none;"><input type="text" name="odp_id" value="' +
                odp_id +
                '" /><input type="text" name="dop_cuenta" value="' +
                dop_cuenta +
                '" /><input type="text" name="mesa_id" value="' +
                mesa_id +
                '" />    <input type="text" name="tipov_id" value="' +
                $("#hide_tipov_id").val() +
                '" />    <input type="password" name="vae_cod" id="vae_cod" value="' +
                datoTxt +
                '" /> <input type="text" name="vae_IDCliente" value="' +
                $("#hide_vae_IDCliente").val() +
                '" />     <input type="text" name="vae_cdn_id" value="' +
                $("#hide_cdn_id").val() +
                '" />  <input type="text" name="vae_rst_id" value="' +
                $("#hide_rst_id").val() +
                '" />    <input type="text" name="esVoucher" value="1" />     ' +
                parametros +
                "  </form>"
            );
            document.forms["cobro"].submit();
        } else {
            alertify.error("El valor ingresado es incorrecto,por favor intente de nuevo");
        }
    }
    return false;
}

<<<<<<< HEAD
function fn_insertaQsr() {
    ordenPedido = $("#hide_odp_id").val();
    send = { insertaQsr: 1 };
    send.odpQsr = ordenPedido;
    $.getJSON("config_ordenPedido.php", send, function(datos) {

    });
}

function retornaPantallaSplit(mesa, odp_id) {
    send = { obtenerurlsplit: 1 };
=======
function retornaPantallaSplit(mesa, odp_id) {
    send = {"obtenerurlsplit": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.mesa_id = mesa;
    send.odp_id = odp_id;
    $.ajax({
        async: false,
        type: "GET",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "../facturacion/config_facturacion.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                window.location.replace(".." + datos[0]["url_cuenta"]);
            }
        }
    });
    fn_cargando(0);

}

function fn_separar() {
    if (!$("#listadoPedido li").length) {
        alertify.alert("No ha seleccionado un producto para separar cuentas");
    } else {
        var odp_id = document.getElementById("hide_odp_id").value;
        var mesa_id = document.getElementById("hide_mesa_id").value;
        var cdn_tipoimpuesto = document.getElementById("hide_cdn_tipoimpuesto").value;
        var est_ip = document.getElementById("hide_est_ip").value;
        var categoria_id = document.getElementById("hide_cat_id").value;
        var rst_id = document.getElementById("hide_rst_id").value;

        retornaPantallaSplit(mesa_id, odp_id);
        document.forms["separar"].submit();
    }

    return false;
}

var minimo = 2,
        maximo = 5;

function SetMinimo(min) {
    minimo = min;
}

function GetMinimo() {
    return minimo;
}

function SetMaximo(max) {
    maximo = max;
}

function GetMaximo() {
    return maximo;
}

function fn_Limite_min_max() {
<<<<<<< HEAD
    send = { limite_min_max: 1 };
    send.rst_id = $("#hide_rst_id").val();
=======
    send = {"limite_min_max": 1};
    send.rst_id = $('#hide_rst_id').val();
>>>>>>> origin/MXP_Version_1.9.10.6
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                SetMinimo(datos[0]["minimo"]);
                SetMaximo(datos[0]["maximo"]);
            } else {
                SetMinimo(2);
                SetMaximo(5);
                alertify.alert(
                    "No tiene configurada la politica de limite minimo y  máximo, su valor por defecto serÃ¡n [2 y 5] respectivamente."
                );
            }
        }
    });
}

//Pregunta los items de la cuenta para todas las personas
function fn_dividirCuenta(IDMesa) {
    //alert($('#hide_odp_id').val());
    if (!$("#listadoPedido li").length) {
        alertify.alert("No ha seleccionado un producto para separar cuentas");
    } else {
        var odp_id = $("#hide_odp_id").val();

        if (odp_id) {
<<<<<<< HEAD
            envia = { NumeroPersonas: 1 };
=======
            envia = {'NumeroPersonas': 1};
>>>>>>> origin/MXP_Version_1.9.10.6
            envia.opcion = 2;
            envia.odp_id = odp_id;
            $.getJSON("config_ordenPedido.php", envia, function (datos) {
                if (datos.str > 0) {
                    $("#cantidad").val(datos[0]["odp_num_personas"]);
                }
                $("#aumentarContador").dialog("open");
            });
        } else {
            $("#cantidad").val("");
            $("#aumentarContador").dialog("open");
        }

<<<<<<< HEAD
        $("#ok_cantidad").removeAttr("onclick");
        $("#ok_cantidad").click(function() {
=======

        $('#ok_cantidad').removeAttr("onclick");
        $('#ok_cantidad').click(function () {
>>>>>>> origin/MXP_Version_1.9.10.6
            fn_cargando(1);
            fn_Limite_min_max();
            var cantidad = $("#cantidad").val();
            if (parseFloat(cantidad) <= GetMaximo() && parseFloat(cantidad) >= GetMinimo()) {
<<<<<<< HEAD
                send = { dividirProductos: 1 };
=======
                send = {"dividirProductos": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
                send.accion = 1;
                send.IDMesa = IDMesa;
                send.odp_id = odp_id;
                send.cantidad = cantidad;
                $.ajax({
                    async: false,
                    url: "config_ordenPedido.php",
                    data: send,
                    dataType: "json",
<<<<<<< HEAD
                    success: function(datos) {
                        $("#ok_cantidad").attr("onClick", "fn_okCantidad()");
=======
                    success: function (datos) {

                        $('#ok_cantidad').attr('onClick', 'fn_okCantidad()');
>>>>>>> origin/MXP_Version_1.9.10.6
                        $("#aumentarContador").dialog("close");
                    },
                    complete: function (jqXHR, textStatus) {
                        fn_separar();
                    }
                });
            } else {
                alertify.alert(
                    "Ingrese un cantidad v&aacute;lida. entre [" +
                    GetMinimo() +
                    " y " +
                    GetMaximo() +
                    "]"
                );
                $("#cantidad").val("");
                fn_cargando(0);
            }
        });
    }
}

function fn_funcionesGerente() {
    window.location.replace("../funciones/funciones_gerente.php");
}

function fn_agregarNumero(valor) {
    var cantidad = $("#cantidad").val();
<<<<<<< HEAD
    if (cantidad.length == 0 && valor == 0) {} else if (cantidad.length == 0 && valor == ".") {
=======
    if (cantidad.length == 0 && valor == 0) {
    } else if ((cantidad.length == 0 && valor == ".")) {
>>>>>>> origin/MXP_Version_1.9.10.6
        $("#cantidad").val("0.");
        coma = 1;
    } else {
        if (valor == "." && coma == 0) {
            cantidad = cantidad + "" + valor;
            $("#cantidad").val(cantidad);
            coma = 1;
        } else if (valor == "." && coma == 1) {
        } else {
            var variable = cantidad;
            var indice = 0;
            indice = variable.indexOf(".") + 1;
            if (indice > 0) {
                variable = variable.substring(indice, variable.length);
                if (variable.length <= 2) {
                    cantidad = cantidad + "" + valor;
                    $("#cantidad").val(cantidad);
                    fn_focusLector();
                }
            } else {
                cantidad = cantidad + "" + valor;
                $("#cantidad").val(cantidad);
                fn_focusLector();
            }
        }
    }
    fn_focusLector();
}

function fn_eliminarCantidad() {
    var lc_cantidad = $("#cantidad").val();
    if (lc_cantidad != "0.") {
        lc_cantidad = lc_cantidad.substring(0, document.getElementById("cantidad").value.length - 1);
        if (lc_cantidad == "") {
            lc_cantidad = "";
            coma = 0;
        }
        if (lc_cantidad == ".") {
            coma = 0;
        }
        $("#cantidad").val(lc_cantidad);
    } else {
        $("#cantidad").val("");
    }
}

<<<<<<< HEAD
function fn_canalesImpresion() {
    send = { canalesImpresion: 1 };
    send.odp_id = $("#hide_odp_id").val();
    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function(datos) {
            if (datos.str > 0) {
                for (i = 0; i < datos.str; i++) {
                    var impresora = datos[i]["cprn_id"];
                    var orden = $("#hide_odp_id").val();
                    var imp_url = "http://localhost/pos/ordenpedido/canalesImpresion.php?orden=" + orden + "&impresora=" + impresora + "";
                    var desc_impresora = datos[i]["cprn_descripcion"];
                    var imp_impresora = '"' + desc_impresora + '"';
                    var imp_ip_estacion = $("#hide_est_ip").val();
                    var usr_id = $("#hide_usr_id").val();
                    send = { enviarImpresion: 1 };
                    send.imp_ip_estacion = imp_ip_estacion;
                    send.imp_url = imp_url;
                    send.imp_impresora = imp_impresora;
                    send.usr_id = usr_id;
                    $.ajax({
                        async: false,
                        url: "config_ordenPedido.php",
                        data: send,
                        dataType: "json"
                    });
                }
            }
        }
    });
}

=======
>>>>>>> origin/MXP_Version_1.9.10.6
function teclado(elEvento) {
    evento = elEvento || window.event;
    k = evento.keyCode; //nï¿½mero de cï¿½digo de la tecla.
    //teclas nï¿½mericas del teclado alfamunï¿½rico
    if (k > 47 && k < 58) {
        p = k - 48; //buscar nï¿½mero a mostrar.
        p = String(p); //convertir a cadena para poder aï¿½ï¿½dir en pantalla.
        fn_agregarNumero(p); //enviar para mostrar en pantalla
    }
    //Teclas del teclado nï¿½merico. Seguimos el mismo procedimiento que en el anterior.
    if (k > 95 && k < 106) {
        p = k - 96;
        p = String(p);
        fn_agregarNumero(p);
    }
    if (k == 110 || k == 190) {
        fn_agregarNumero(".");
    } //teclas de coma decimal
    if (k == 8) {
        fn_eliminarNumero();
    } //Retroceso en escritura : tecla retroceso.
    if (k > 57 && k < 210) {
        document.getElementById("cantidad").value = "";
    }
    fn_focusLector();
}

function fn_cancelarAgregarCantidad() {
    Accion = 0;
    lc_cantidad = 1;
    $("#cantidad").val("");
    $("#etiqueta_cantidad").val("x1");
    $("#aumentarContador").dialog("close");
    $("#keyboard").hide();
    fn_cargando(0);
}

function fn_popupCantidad() {
    $("#cantidad").val("");
    $("#aumentarContador").dialog({
        modal: true,
        autoOpen: false,
        show: {
            effect: "none",
            duration: 500
        },
        hide: {
            effect: "none",
            duration: 500
        },
        width: "auto",
        open: function (event, ui) {
            $(".ui-dialog-titlebar").hide();
        }
    });

    $("#agregarCantidad").click(function () {
        Accion = 0;
        $("#aumentarContador").dialog("open");
        $("#cantidad").val("");
    });

    fn_focusLector();
}

function fn_okCantidad() {
    coma = 0;
    var cantidad = $("#cantidad").val();
    if (parseFloat(cantidad) < 1000 && parseFloat(cantidad) > 0) {
        lc_cantidad = cantidad;
        $("#aumentarContador").dialog("close");
        $("#cantidadOK").val(cantidad);
        if (Accion == 0) {
            Accion = 2;
            fn_focusLector();
        } else {
            fn_verificarGramosPlu(plu_mag_id, plu_lector);
            fn_focusLector();
            Accion = 0;
        }
        $("#etiqueta_cantidad").val("x" + cantidad);
        $("#btn_cambio").val("gramos");
        fn_focusLector();


        if (fidelizacionActiva()) {
            fn_ActualizarQueAlcanza("ListadoProductos", 0);
        }

    } else {
        alertify.alert("Ingrese un cantidad v&aacute;lida.");
        $("#cantidad").val("");
    }


}

function fn_cambiar() {
    var estado = $("#btn_cambio").val();
    if (estado == "gramos") {
        $("#btn_punto").show();
        $("#hid_bandera_gramo").val(1);
        $("#btn_cambio").val("numero");
    } else {
        $("#cantidad").val("");
        $("#etiqueta_cantidad").val("x1");
        $("#btn_punto").hide();
        $("#btn_cambio").val("gramos");
        $("#hid_bandera_gramo").val(0);
    }
    fn_focusLector();
}

function fn_salirMesas() {
    window.location.href = "../ordenpedido/userMesas.php";
}

function fn_confirmarComentarioPlu() {
    var comentario = $("#comentario").val();
    comentario = trim(comentario);
    if (comentario.length > 100) {
        alertify.alert(
            "Comentario excede el n&uacute;mero de caracteres permitidos."
        );
        return false;
    }
    if (comentario.length > 0) {
        var ancestro = $("#listadoPedido").find("li.focus").attr("ancestro");
        var dop_id = 0;
        if (ancestro == 0) {
            dop_id = $("#listadoPedido").find("li.focus").attr("id");
        } else {
            dop_id = ancestro;
        }
        fn_agregarComentario(comentario, dop_id);
        $("#keyboard").hide();
        $("#keyboard").empty();
        $("#contenedorComentario").dialog("close");
    } else {
        alertify.alert("Agregue un comentario.");
    }
}

function fn_cerrarModalComentar() {
    $("#keyboard").hide();
    $("#keyboard").empty();
    $("#contenedorComentario").dialog("close");
    fn_focusLector();
}

function trim(cadena) {
    var retorno = cadena.replace(/^\s+/g, "");
    retorno = retorno.replace(/\s+$/g, "");
    return retorno;
}

function fn_agregarComentarioOrden() {
    var comentario = $("#comentario").val();
    comentario = trim(comentario);
    /*if (comentario.length > 100) {
<<<<<<< HEAD
        alertify.alert(
            "Comentario excede el n&uacute;mero de caracteres permitidos."
        );
        return false;
    }*/
    if (comentario.length > 0) {

        var odp_id = $("#hide_odp_id").val();
        send = { agregarComentarioOrdenPedido: 1 };
=======
     alertify.alert('Comentario excede el n&uacute;mero de caracteres permitidos.');
     return false;
     }*/
    if (comentario.length > 0) {

        var odp_id = $("#hide_odp_id").val();
        send = {"agregarComentarioOrdenPedido": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
        send.odp_id = odp_id;
        send.comentario = comentario;
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.Confirmar > 0) {
                $("#nfrmcn_srs_sstm_hora").text(comentario);
                fn_focusLector();
                //alertify.alert("Comentario agregado a la Orden.");
            }
        });

        $("#keyboard").hide();
        $("#keyboard").empty();
        $("#contenedorComentario").dialog("close");
        fn_focusLector();
    } else {
        alertify.alert("Agregue un comentario.");
    }
    fn_focusLector();
}

function fn_comentar() {
    if ($("#hide_fidelizacionActiva").val() == 1) {
        $("#comentario").val($("#fdzn_nombre_cliente").val());
    }
    if ($("li.focus").length < 1) {
        $("#plu_comentar").html("Comentar Orden");
        $("#plu_comentar").html(plu_descripcion);
        $("#contenedorComentario").dialog({
            modal: true,
            autoOpen: false,
            position: {
                my: "top",
                at: "top+120"
            },
            show: {
                effect: "none",
                duration: 500
            },
            hide: {
                effect: "none",
                duration: 500
            },
            width: 500,
            height: 340,
            open: function (event, ui) {
                $(".ui-dialog-titlebar").hide();
                $("#comentario").val(palabraDefault);
                fn_alfaNumerico("#comentario");
                $("#btn_cancelar_teclado").attr("onclick", "fn_cerrarModalComentar()");
                $("#btn_ok_teclado").attr("onclick", "fn_agregarComentarioOrden()");
            }
        });
        $("#contenedorComentario").dialog("open");
    } else {

        var ancestro = $("#listadoPedido").find("li.focus").attr("ancestro");
        var dop_id = 0;
        var tipo_plu = $("#listadoPedido").find("li.focus").attr("tipo");
        if (ancestro == 0) {
            dop_id = $("#listadoPedido").find("li.focus").attr("id");
        } else {
            dop_id = ancestro;
        }
        if (tipo_plu > 0) {
            var plu_descripcion = $(
                "#" + dop_id + " .listaproductosDescTomaPedido"
            ).html();
            $("#plu_comentar").html(plu_descripcion);
            $("#contenedorComentario").dialog({
                modal: true,
                autoOpen: false,
                position: {
                    my: "top",
                    at: "top+120"
                },
                show: {
                    effect: "none",
                    duration: 500
                },
                hide: {
                    effect: "none",
                    duration: 500
                },
                width: 500,
                height: 340,
                open: function (event, ui) {
                    $(".ui-dialog-titlebar").hide();
                    $("#comentario").val("");
                    fn_alfaNumerico("#comentario");
                    $("#btn_cancelar_teclado").attr(
                        "onclick",
                        "fn_cerrarModalComentar()"
                    );
                    $("#btn_ok_teclado").attr("onclick", "fn_confirmarComentarioPlu()");
                }
            });
            $("#contenedorComentario").dialog("open");
        } else {
            alertify.alert(
                "Para agregar un comentario debe seleccionar un producto."
            );
        }
    }
}

function fn_agregarComentario(comentario, dop_id) {
    var ancestro = $("#listadoPedido").find("li.focus").attr("ancestro");
    var odp_id = document.getElementById("hide_odp_id").value;
<<<<<<< HEAD
    send = { insertarComentario: 1 };
=======
    send = {"insertarComentario": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.odp_id = odp_id;
    send.dop_id = dop_id;
    send.dop_cuenta = $("#hide_numeroCuenta").val() ?
        $("#hide_numeroCuenta").val() :
        1;
    send.comentario = comentario;
<<<<<<< HEAD
    send.dop_cuenta = $("#hide_numeroCuenta").val() ?
        $("#hide_numeroCuenta").val() :
        1;
    send.idcategoria = rst_categoria;
    $.getJSON("config_ordenPedido.php", send, function(datos) {
=======
    $.getJSON("config_ordenPedido.php", send, function (datos) {
>>>>>>> origin/MXP_Version_1.9.10.6
        if (datos.str > 0) {
            var html;
            $("#listado ul").empty();
            for (i = 0; i < datos.str; i++) {
                var tipoBeneficioCupon = 0;
                var colorBeneficioCupon = 0;
                tipoBeneficioCupon = datos[i]["tipoBeneficioCupon"];
                colorBeneficioCupon = datos[i]["colorBeneficioCupon"];
                if (datos[i]["tipo"] > 0) {
                    if (parseFloat(datos[i]["dop_precio_unitario"]) > 0) {
                        if (tipoBeneficioCupon > 0) {
                            html =
                                "<li style='background: " +
                                colorBeneficioCupon +
                                "';  " +
                                (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' codigoValidador=" +
                                datos[i]["codigoAnularValidacion"] +
                                " gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "' cntKg='" +
                                datos[i]["dop_cantidad"] +
                                "' tipoBeneficioCupon='" +
                                tipoBeneficioCupon +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div><div class='listaproductosValTomaPedido'>" +
                                (datos[i]["plus_puntos"] === "1" ?
                                    datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                    "$" +
                                    (
                                        datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"]
                                    ).toFixed(2)) +
                                "</div><div class='listaproductosCantTomaPedido'>" +
                                datos[i]["dop_cantidad"] +
                                "</div></li>";
                        } else {
                            html =
                                "<li  " +
                                (datos[i]["plus_puntos"] === "1" ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' codigoValidador=" +
                                datos[i]["codigoAnularValidacion"] +
                                " gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "' cntKg='" +
                                datos[i]["dop_cantidad"] +
                                "' tipoBeneficioCupon='" +
                                tipoBeneficioCupon +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div><div class='listaproductosValTomaPedido'>" +
                                (datos[i]["plus_puntos"] === "1" ?
                                    datos[i]["puntos"] * datos[i]["dop_cantidad"] + " Pts." :
                                    "$" +
                                    (
                                        datos[i]["dop_precio_unitario"] * datos[i]["dop_cantidad"]
                                    ).toFixed(2)) +
                                "</div><div class='listaproductosCantTomaPedido'>" +
                                datos[i]["dop_cantidad"] +
                                "</div></li>";
                        }

                        $("#listadoPedido").append(html);
                    } else {
                        if (VISUALIZACANTIDAD === "SI") {
                            html =
                                "<li   " +
                                (datos[i]["plus_puntos"] === 1 ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "' cntKg='" +
                                datos[i]["dop_cantidad"] +
                                "' tipoBeneficioCupon='" +
                                tipoBeneficioCupon +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div><div class='listaproductosValTomaPedido'></div><div class='listaproductosCantTomaPedido'>" +
                                datos[i]["dop_cantidad"] +
                                "</div></li>";
                        } else {
                            html =
                                "<li   " +
                                (datos[i]["plus_puntos"] === 1 ? 'class="puntos" ' : "") +
                                "  id='" +
                                datos[i]["dop_id"] +
                                "' onclick='fn_modificarLista(\"" +
                                datos[i]["dop_id"] +
                                '", "' +
                                datos[i]["dop_cantidad"] +
                                '", "' +
                                datos[i]["plu_gramo"] +
                                "\")' gramos=" +
                                datos[i]["plu_gramo"] +
                                " anular=" +
                                datos[i]["plu_anulacion"] +
                                " ancestro='" +
                                datos[i]["ancestro"] +
                                "' tipo='" +
                                datos[i]["tipo"] +
                                "' cntKg='" +
                                datos[i]["dop_cantidad"] +
                                "' tipoBeneficioCupon='" +
                                tipoBeneficioCupon +
                                "'><div class='listaproductosDescTomaPedido'>" +
                                datos[i]["magp_desc_impresion"] +
                                "</div></li>";
                        }
                        $("#listadoPedido").append(html);
                    }
                } else {
                    html =
                        "<li  " +
                        (datos[i]["plus_puntos"] === 1 ? 'class="puntos" ' : "") +
                        "   id='" +
                        datos[i]["plu_id"] +
                        "' onclick='fn_modificarLista(\"" +
                        datos[i]["plu_id"] +
                        '", "' +
                        datos[i]["dop_cantidad"] +
                        '", "' +
                        datos[i]["plu_gramo"] +
                        "\")' ancestro='" +
                        datos[i]["plu_id"] +
                        "' tipo='" +
                        datos[i]["tipo"] +
                        "' cntKg='" +
                        datos[i]["dop_cantidad"] +
                        "' tipoBeneficioCupon='" +
                        tipoBeneficioCupon +
                        "' ><div class='listaproductosDescTomaPedido'>" +
                        datos[i]["magp_desc_impresion"] +
                        "</div></li>";
                    $("#listadoPedido").append(html);
                }
            }
            if (ancestro.length > 0) {
                $('[ancestro="' + dop_id + '"]').addClass("focus");
            } else {
                $("#" + dop_id).addClass("focus");
            }
            document.getElementById("cantidad").value = "";
            lc_cantidad = 1;
        }
    });
}

function fn_imprimirOrdenPedido() {
    var odp_id = $("#hide_odp_id").val();
    var est_ipd = $("#hide_est_ip").val();
    var usr_id = $("#hide_usr_id").val();
    var rst_id = $("#hide_rst_id").val();
<<<<<<< HEAD
    var send = { impresionOrdenPedido: 1 };
=======
    send = {"impresionOrdenPedido": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.odp_id = odp_id;
    send.est_ipd = est_ipd;
    send.usr_id = usr_id;
    send.rst_id = rst_id;
    send.dop_cuenta = $("#hide_numSplit").val();

    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            if (datos[0]["Confirmar"] < 1) {
                alertify.alert("No existen impresiones pendientes");
            }
        }
    });
}

//imprime todas las precuentas que existen en el split
function fn_ImprimirTodasPrecuenta() {

    var idc = 0;
    var array_cuentas = [];
    var send;
<<<<<<< HEAD
    var guardarCop = { guardarCop: 1 };
=======
    var guardarCop = {"guardarCop": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    var odp_id = $("#hide_odp_id").val();
    send = guardarCop;


    send.mesa_id = $("#hide_mesa_id").val();
    send.odp_id = odp_id;
    $.getJSON("config_separarCuentas.php", send, function (datos) {
        if (datos.str > 0) {
            array_cuentas = datos;
            for (i in array_cuentas) {
                idc = array_cuentas[i].dop_cuenta;
                if (Number.isInteger(idc)) {
                    fn_imprimirPreCuenta(idc, 1);
                }
            }
        } else {
            alertify.error("No existen cuentas pendientes por imprimir");
        }
    });
}

function fn_CrearEImprimirPreCuenta(dop_cuenta) {
    if (!$("#listadoPedido li").length) {
        alertify.alert("No existe productos para la Precuenta");
    } else {
        fn_imprimirPreCuenta(dop_cuenta, 1);
    }
}

function fn_ImprimirPrecuentasSeparadas(dop_cuenta) {
    if (!$(".listado ul#id" + dop_cuenta + " li").length) {
        alertify.alert("No existe productos para la Precuenta");
    } else {
        fn_imprimirPreCuenta(dop_cuenta, 1);
    }
}

function fn_CrearPreCuenta(dop_cuenta) {
    var rst_id = $("#hide_rst_id").val();
    var odp_id = $("#hide_odp_id").val();
    var usr_id = $("#hide_usr_id").val();

<<<<<<< HEAD
    send = { insertarFactura: 1 };
=======
    send = {"insertarFactura": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    send.rst_id = rst_id;
    send.odp_id = odp_id;
    send.usr_id = usr_id;
    send.numCuenta = dop_cuenta;
    $.ajax({
        async: false,
        url: "../facturacion/config_facturacion.php",
        data: send,
        dataType: "json",
<<<<<<< HEAD
        success: function(data) {
            send2 = { ActualizaEstadosDop: 1 };
=======
        success: function (data) {

            send2 = {"ActualizaEstadosDop": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
            send2.opcion = 1;
            send2.odp_id = odp_id;
            send2.dop_cuenta = dop_cuenta;

            $.getJSON("../ordenpedido/config_ordenPedido.php", send2, function (data2) {
                if (data2) {
                    //alertify.success("Dirigiendo a pantalla precuenta");
                }
            });
        }
    });

}

<<<<<<< HEAD
=======
/*
 * @param {type} opcionImpresion
 * opcionImpresion = 0 : es cuando se aplica pre cuenta desde la pantalla de facturación.
 * opcionImpresion = 1 : es cuando se aplica pre cuenta desde la pantalla orden de pedido, separar o dividir cuentas.
 */
function fn_imprimirPreCuenta(dop_cuenta, opcionImpresion) {

    fn_CrearPreCuenta(dop_cuenta);
    var send;
    var odp_id = $("#hide_odp_id").val();
    var est_ipd = $("#hide_est_ip").val();
    var usr_id = $("#hide_usr_id").val();
    var rst_id = $("#hide_rst_id").val();

    send = {"impresionPrecuenta": 1};
    send.odp_id = odp_id;
    send.est_ipd = est_ipd;
    send.usr_id = usr_id;
    send.rst_id = rst_id;
    send.dop_cuenta = dop_cuenta;
    send.opcionImpresion = opcionImpresion;

    $.getJSON("../ordenpedido/config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            if (datos[0]['Confirmar'] < 1) {
                alertify.alert('No existen detalle del pedido');
            }
        }
>>>>>>> origin/MXP_Version_1.9.10.6

    /*
     * @param {type} opcionImpresion
     * opcionImpresion = 0 : es cuando se aplica pre cuenta desde la pantalla de facturación.
     * opcionImpresion = 1 : es cuando se aplica pre cuenta desde la pantalla orden de pedido, separar o dividir cuentas.
     */
    function fn_imprimirPreCuenta(dop_cuenta, opcionImpresion) {

        fn_CrearPreCuenta(dop_cuenta);
        var send;
        var odp_id = $("#hide_odp_id").val();
        var est_ipd = $("#hide_est_ip").val();
        var usr_id = $("#hide_usr_id").val();
        var rst_id = $("#hide_rst_id").val();

<<<<<<< HEAD
    send = { impresionPrecuenta: 1 };
        send.odp_id = odp_id;
        send.est_ipd = est_ipd;
        send.usr_id = usr_id;
        send.rst_id = rst_id;
        send.dop_cuenta = dop_cuenta;
    console.log(opcionImpresion + "-->valor faltante ");
        send.opcionImpresion = opcionImpresion;

        $.getJSON("../ordenpedido/config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
            if (datos[0]["Confirmar"] < 1) {
                alertify.alert("No existen detalle del pedido");
=======
    var usr_id = $("#hide_usr_id").val();
    send = {"cargarAccesosPerfil": 1};
    send.pnt_id = 'tomapedido.php';
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            for (i = 0; i < datos.str; i++) {
                switch (datos[i]['acc_descripcion']) {
                    case 'Llevar':
                        $('#btn_salonLlevar').attr("disabled", false);
                        break;
                    case 'Cobrar':
                        $('#cobrar').attr("disabled", false);
                        $("#cobrar").removeClass("boton_Accion_Bloqueado");
                        $("#cobrar").addClass('boton_Accion');
                        $("#cobrar").removeClass("ok_bloqueado");
                        $("#cobrar").addClass('ok_activo');
                        break;
                    case 'Comentar':
                        $('#comentar').attr("disabled", false);
                        $("#comentar").removeClass("boton_Accion_Bloqueado");
                        $("#comentar").addClass('boton_Accion');
                        $("#comentar").removeClass("comentar_bloqueado");
                        $("#comentar").addClass('comentar_activo');
                        break;
                    case 'Eliminar':
                        $('#btn_eliminarElemnto').attr("disabled", false);
                        $("#btn_eliminarElemnto").removeClass("boton_Accion_Bloqueado");
                        $("#btn_eliminarElemnto").addClass('boton_Accion');
                        $("#btn_eliminarElemnto").removeClass("eliminar_bloqueado");
                        $("#btn_eliminarElemnto").addClass('eliminar_activo');
                        break;
                    case 'Cantidad':
                        $('#agregarCantidad').attr("disabled", false);
                        $("#agregarCantidad").removeClass("boton_Accion_Bloqueado");
                        $("#agregarCantidad").addClass('boton_Accion');
                        $("#agregarCantidad").removeClass("cantidad_bloqueado");
                        $("#agregarCantidad").addClass('cantidad_activo');
                        break;
                    case 'Funciones Gerente':
                        $('#funcionesGerente').attr("disabled", false);
                        $("#funcionesGerente").removeClass("boton_Opcion_Bloqueado");
                        $("#funcionesGerente").addClass('boton_Opcion');
                        $('#btn_transacciones').attr("disabled", false);
                        $("#btn_transacciones").removeClass("boton_Opcion_Bloqueado");
                        $("#btn_transacciones").addClass('boton_Opcion');
                        break;
                    case 'Separar':
                        $('#separarCuentas').attr("disabled", false);
                        $("#separarCuentas").removeClass("boton_Opcion_Bloqueado");
                        $("#separarCuentas").addClass('boton_Opcion');
                        break;
                    case 'Imprimir Pre-Cuenta':
                        $('#precuenta').attr("disabled", false);
                        $("#precuenta").removeClass("boton_Opcion_Bloqueado");
                        $("#precuenta").addClass('boton_Opcion');
                        break;
                    case 'Imprimir Orden Pedido':
                        $('#imprimir_orden').attr("disabled", false);
                        $("#imprimir_orden").removeClass("boton_Opcion_Bloqueado");
                        $("#imprimir_orden").addClass('boton_Opcion');
                        break;
                    case 'Guardar Cuenta':
                        $('#btn_sistema').attr("disabled", false);
                        $("#btn_sistema").removeClass("boton_Accion_Bloqueado");
                        $("#btn_sistema").addClass('boton_Accion');
                        $("#btn_sistema").removeClass("guardar_bloqueado");
                        $("#btn_sistema").addClass('guardar_activo');
                        break;
                    case 'Buscar':
                        $('#buscar').attr("disabled", false);
                        $("#buscar").removeClass("boton_Opcion_Bloqueado");
                        $("#buscar").addClass('boton_Opcion');
                        break;
                    case 'Salir':
                        $('#regresar').attr("disabled", false);
                        $("#regresar").removeClass("boton_Opcion_Bloqueado");
                        $("#regresar").addClass('boton_Opcion');
                        break;
                    case 'Resumen Ventas':
                        $('#resumenVentas').attr("disabled", false);
                        $("#resumenVentas").removeClass("boton_Opcion_Bloqueado");
                        $("#resumenVentas").addClass('boton_Opcion');
                        break;
                    case 'Cancelar Orden':
                        if ($("#hide_fidelizacionActiva").val() === 1) {
                            $('#btnCancelarOrdenFidelizacion').attr("disabled", false);
                            $("#btnCancelarOrdenFidelizacion").removeClass("boton_Opcion_Bloqueado");
                            $("#btnCancelarOrdenFidelizacion").addClass('boton_Opcion');
                        }
                        break;
>>>>>>> origin/MXP_Version_1.9.10.6
                }
            }
<<<<<<< HEAD

        alertify.success("Imprimiendo precuenta #" + dop_cuenta);
        });
    }
=======
            validaAdminBuscador();
        }
    });
}

function validaAdminBuscador() {
    send = {"validaAdministradorBuscar": 1};
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                if (datos.valida == "admin") {
                    $('#buscar').attr("disabled", true);
                    $("#buscar").removeClass('boton_Opcion');
                    $("#buscar").addClass("boton_Opcion_Bloqueado");
                } else {
                }
            } else {
            }
        }
    });
}

function fn_cerrarModalBuscador() {
    $("#keyboard").hide();
    $("#keyboard").empty();
    $("#cuadro_buscador").dialog("close");
}

function fn_modalBuscador() {
    $("#txt_busca").val('');
    $("#cuadro_buscador").dialog({
        modal: true,
        autoOpen: false,
        position: {my: 'top', at: 'top'},
        show: {
            effect: "none",
            duration: 500
        },
        hide: {
            effect: "none",
            duration: 500
        },
        width: 800,
        height: 500,
        open: function (event, ui) {
            $(".ui-dialog-titlebar").hide();
            fn_alfaNumerico('#txt_busca');
            $('#btn_cancelar_teclado').attr('onclick', 'fn_cerrarModalBuscador()');
            $('#btn_ok_teclado').attr('onclick', 'fn_buscarPlusDescripcion()');
        }
    });
    $("#cuadro_buscador").dialog("open");
>>>>>>> origin/MXP_Version_1.9.10.6

    function fn_cargarAccesosSistema() {

<<<<<<< HEAD
        var usr_id = $("#hide_usr_id").val();
    send = { cargarAccesosPerfil: 1 };
    send.pnt_id = "tomapedido.php";
=======
function fn_buscarPlusDescripcion() {
    var html = "";
    var descripcion = $("#txt_busca").val();
    if (descripcion.length > 0) {
        $("#codigoCategoria").val(0);
        $("#txt_busca").val();
        if ($("#btn_salonLlevar").val() == 'Salon') {
            lc_control = 1;
        } else {
            lc_control = 2;
        }
        $("#agregarCantidad").show();
        send = {"cargarProductoBuscador": 1};
        send.menu_id = $('#hide_menu_id').val();
        send.cat_id = rst_categoria;
        send.mag_id = $("#codigoCategoria").val();
        send.cla_id = $('#hid_cla_id').val();
        send.descripcion = descripcion;
>>>>>>> origin/MXP_Version_1.9.10.6
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
                for (i = 0; i < datos.str; i++) {
                switch (datos[i]["acc_descripcion"]) {
                    case "Llevar":
                        $("#btn_salonLlevar").attr("disabled", false);
                            break;
                    case "Cobrar":
                        $("#cobrar").attr("disabled", false);
                            $("#cobrar").removeClass("boton_Accion_Bloqueado");
                        $("#cobrar").addClass("boton_Accion");
                            $("#cobrar").removeClass("ok_bloqueado");
                        $("#cobrar").addClass("ok_activo");
                            break;
                    case "Comentar":
                        $("#comentar").attr("disabled", false);
                            $("#comentar").removeClass("boton_Accion_Bloqueado");
                        $("#comentar").addClass("boton_Accion");
                            $("#comentar").removeClass("comentar_bloqueado");
                        $("#comentar").addClass("comentar_activo");
                            break;
                    case "Eliminar":
                        $("#btn_eliminarElemnto").attr("disabled", false);
                            $("#btn_eliminarElemnto").removeClass("boton_Accion_Bloqueado");
                        $("#btn_eliminarElemnto").addClass("boton_Accion");
                            $("#btn_eliminarElemnto").removeClass("eliminar_bloqueado");
                        $("#btn_eliminarElemnto").addClass("eliminar_activo");
                            break;
                    case "Cantidad":
                        $("#agregarCantidad").attr("disabled", false);
                            $("#agregarCantidad").removeClass("boton_Accion_Bloqueado");
                        $("#agregarCantidad").addClass("boton_Accion");
                            $("#agregarCantidad").removeClass("cantidad_bloqueado");
                        $("#agregarCantidad").addClass("cantidad_activo");
                            break;
                    case "Funciones Gerente":
                        $("#funcionesGerente").attr("disabled", false);
                            $("#funcionesGerente").removeClass("boton_Opcion_Bloqueado");
                        $("#funcionesGerente").addClass("boton_Opcion");
                        $("#btn_transacciones").attr("disabled", false);
                            $("#btn_transacciones").removeClass("boton_Opcion_Bloqueado");
                        $("#btn_transacciones").addClass("boton_Opcion");
                            break;
                    case "Separar":
                        $("#separarCuentas").attr("disabled", false);
                            $("#separarCuentas").removeClass("boton_Opcion_Bloqueado");
                        $("#separarCuentas").addClass("boton_Opcion");
                            break;
                    case "Imprimir Pre-Cuenta":
                        $("#precuenta").attr("disabled", false);
                            $("#precuenta").removeClass("boton_Opcion_Bloqueado");
                        $("#precuenta").addClass("boton_Opcion");
                            break;
                    case "Imprimir Orden Pedido":
                        $("#imprimir_orden").attr("disabled", false);
                            $("#imprimir_orden").removeClass("boton_Opcion_Bloqueado");
                        $("#imprimir_orden").addClass("boton_Opcion");
                            break;
                    case "Guardar Cuenta":
                        $("#btn_sistema").attr("disabled", false);
                            $("#btn_sistema").removeClass("boton_Accion_Bloqueado");
                        $("#btn_sistema").addClass("boton_Accion");
                            $("#btn_sistema").removeClass("guardar_bloqueado");
                        $("#btn_sistema").addClass("guardar_activo");
                            break;
                    case "Buscar":
                        $("#buscar").attr("disabled", false);
                            $("#buscar").removeClass("boton_Opcion_Bloqueado");
                        $("#buscar").addClass("boton_Opcion");
                            break;
                    case "Salir":
                        $("#regresar").attr("disabled", false);
                            $("#regresar").removeClass("boton_Opcion_Bloqueado");
                        $("#regresar").addClass("boton_Opcion");
                            break;
                    case "Resumen Ventas":
                        $("#resumenVentas").attr("disabled", false);
                            $("#resumenVentas").removeClass("boton_Opcion_Bloqueado");
                        $("#resumenVentas").addClass("boton_Opcion");
                            break;
                    case "Cancelar Orden":
                            if ($("#hide_fidelizacionActiva").val() === 1) {
                            $("#btnCancelarOrdenFidelizacion").attr("disabled", false);
                            $("#btnCancelarOrdenFidelizacion").removeClass(
                                "boton_Opcion_Bloqueado"
                            );
                            $("#btnCancelarOrdenFidelizacion").addClass("boton_Opcion");
                            }
                            break;
                    }

                }
                validaAdminBuscador();
            }
        });
    }

    function validaAdminBuscador() {
    var send = { validaAdministradorBuscar: 1 };
        $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            url: "config_ordenPedido.php",
            data: send,
            success: function (datos) {
                if (datos.str > 0) {
                    if (datos.valida == "admin") {
                    $("#buscar").attr("disabled", true);
                    $("#buscar").removeClass("boton_Opcion");
                        $("#buscar").addClass("boton_Opcion_Bloqueado");
                    } else {
                    }
                } else {
                }
            }
        });
    }

<<<<<<< HEAD
    function fn_cerrarModalBuscador() {
        $("#keyboard").hide();
        $("#keyboard").empty();
        $("#cuadro_buscador").dialog("close");
    }
=======
function fn_guardarCuenta() {
    var mesa = "";
    send = {"obtenerMesa": 1};
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            var mesa = datos[0]['mesa_asignada'];
            window.location.href = "../ordenpedido/tomaPedido.php?numMesa=" + mesa;
        }
    });
}

function fn_irTransacciones() {
    window.location.href = "../anulacion/anularOrden.php";
}
>>>>>>> origin/MXP_Version_1.9.10.6

    function fn_modalBuscador() {
    $("#txt_busca").val("");
        $("#cuadro_buscador").dialog({
            modal: true,
            autoOpen: false,
        position: { my: "top", at: "top" },
            show: {
                effect: "none",
                duration: 500
            },
            hide: {
                effect: "none",
                duration: 500
            },
            width: 800,
            height: 500,
            open: function (event, ui) {
                $(".ui-dialog-titlebar").hide();
            fn_alfaNumerico("#txt_busca");
            $("#btn_cancelar_teclado").attr("onclick", "fn_cerrarModalBuscador()");
            $("#btn_ok_teclado").attr("onclick", "fn_buscarPlusDescripcion()");
            }
        });
        $("#cuadro_buscador").dialog("open");

        $("#hide_pluId").val("");
        fn_focusLector();
    }

    function fn_buscarPlusDescripcion() {
        var html = "";
        var descripcion = $("#txt_busca").val();
        if (descripcion.length > 0) {
            $("#codigoCategoria").val(0);
            $("#txt_busca").val();
        if ($("#btn_salonLlevar").val() == "Salon") {
                lc_control = 1;
            } else {
                lc_control = 2;
            }
            $("#agregarCantidad").show();
        send = { cargarProductoBuscador: 1 };
        send.menu_id = $("#hide_menu_id").val();
            send.cat_id = rst_categoria;
            send.mag_id = $("#codigoCategoria").val();
        send.cla_id = $("#hid_cla_id").val();
            send.descripcion = descripcion;
            $.getJSON("config_ordenPedido.php", send, function (datos) {
                if (datos.str > 0) {
                    $("#buscaProducto").empty();
                    for (var i = 0; i < datos.str; i++) {
                    var productoUpSelling = datos[i]["productoUpSelling"];

                    var jsonMejoraProducto = datos[i]["jsonMejoraProducto"];
                    var pvp = datos[i]["pvp"];
                    var producto = datos[i]["magp_desc_impresion"];

                    var data =
                        datos[i]["puntos"] !== -1 ?
                        '<p class="class_punto_info" style="position: unset;width: 20%;"> ' +
                        datos[i]["puntos"] +
                        "</p>" :
                        "";
                    var funcion =
                        datos[i]["puntos"] !== -1 ?
                        "onclick='fn_canjearPlus(\"" +
                        datos[i]["magp_id"] +
                        '", ' +
                        datos[i]["plu_id"] +
                        "," +
                        datos[i]["validador"] +
                        " ,fn_verificarGramosPluBusqueda , " +
                        datos[i]["puntos"] +
                        "   )'" :
                        "onclick='fn_verificarGramosPluBusqueda(\"" +
                        datos[i]["magp_id"] +
                        '", ' +
                        datos[i]["plu_id"] +
                        ", " +
                        datos[i]["validador"] +
                        ', "' +
                        pvp +
                        '", "' +
                        producto +
                        '", "' +
                        productoUpSelling +
                        '", ' +
                        jsonMejoraProducto +
                        ")'";

                        if ($("#queAlcanza").css("background-color") === "rgb(8, 245, 8)") {
                        if (datos[i]["puntos"] <= $("#num_puntos").val()) {
                            data =
                                datos[i]["puntos"] !== -1 ?
                                '<p class="class_punto_ok" style="position: unset;width: 20%;"> ' +
                                datos[i]["puntos"] +
                                "</p>" :
                                "";
                            } else {
                            data =
                                datos[i]["puntos"] !== -1 ?
                                '<p class="class_punto_falta" style="position: unset;width: 20%;"> ' +
                                datos[i]["puntos"] +
                                "</p>" :
                                "";
                            }
                        }


                        if ($("#hide_PerteneceGrupoAmigos").val() === "0") {
                            data = "";
                        funcion =
                            "onclick='fn_verificarGramosPluBusqueda(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            ", " +
                            datos[i]["validador"] +
                            ', "' +
                            pvp +
                            '", "' +
                            producto +
                            '", "' +
                            productoUpSelling +
                            '", ' +
                            jsonMejoraProducto +
                            ")'";
                        }

                    if (datos[i]["std_fecha"] < 1) {
                        if (datos[i]["validador"] == 1)
                            html +=
                            "<button  puntos = '" +
                            datos[i]["puntos"] +
                            "' id='btn_p" +
                            datos[i]["magp_id"] +
                            "'  " +
                            funcion +
                            "  style='position; left;width: 130px; font-size: 12px; background-color:" +
                            datos[i]["magp_color"] +
                            "; color:" +
                            datos[i]["magp_colortexto"] +
                            "; left:" +
                            left +
                            "px; top:" +
                            arriba +
                            "px;' class='producto_inactivo' pls_grms='" +
                            datos[i]["plu_gramo"] +
                            "' disabled>" +
                            datos[i]["magp_desc_impresion"] +
                            " " +
                            data +
                            "</button>&nbsp;";
                            else
                            html +=
                            "<button  puntos = '" +
                            datos[i]["puntos"] +
                            "' id='btn_p" +
                            datos[i]["magp_id"] +
                            "' " +
                            funcion +
                            " style='position; left;width: 130px; font-size: 12px; background-color:" +
                            datos[i]["magp_color"] +
                            "; color:" +
                            datos[i]["magp_colortexto"] +
                            "; left:" +
                            left +
                            "px; top:" +
                            arriba +
                            "px;' class='producto_inactivo' pls_grms='" +
                            datos[i]["plu_gramo"] +
                            "' disabled>" +
                            datos[i]["magp_desc_impresion"] +
                            " " +
                            data +
                            "</button>&nbsp;";
                        } else {
                        if (datos[i]["validador"] == 1)
                            html +=
                            "<button  puntos = '" +
                            datos[i]["puntos"] +
                            "' id='btn_p" +
                            datos[i]["magp_id"] +
                            "'  " +
                            funcion +
                            "  style='position; left;width: 130px; font-size: 12px;background-color:" +
                            datos[i]["magp_color"] +
                            "; color:" +
                            datos[i]["magp_colortexto"] +
                            "; left:" +
                            left +
                            "px; top:" +
                            arriba +
                            "px;' class='producto_activo' pls_grms='" +
                            datos[i]["plu_gramo"] +
                            "'>" +
                            datos[i]["magp_desc_impresion"] +
                            " " +
                            data +
                            "</button>&nbsp;";
                            else
                            html +=
                            "<button  puntos = '" +
                            datos[i]["puntos"] +
                            "' id='btn_p" +
                            datos[i]["magp_id"] +
                            "'  " +
                            funcion +
                            "  style='position; left;width: 130px; font-size: 12px;background-color:" +
                            datos[i]["magp_color"] +
                            "; color:" +
                            datos[i]["magp_colortexto"] +
                            "; left:" +
                            left +
                            "px; top:" +
                            arriba +
                            "px;' class='producto_activo' pls_grms='" +
                            datos[i]["plu_gramo"] +
                            "'>" +
                            datos[i]["magp_desc_impresion"] +
                            " " +
                            data +
                            "</button>&nbsp;";
                        }
                    }
                    $("#buscaProducto").html(html);
                } else {
                    $("#buscaProducto").empty();
                alertify.alert(
                    "No se encontraron productos con esta descripci&oacute;n"
                );
                }
            });
            fn_focusLector();
        } else {
        alertify.alert("Descripci&oacute;n no v&aacute;lida.");
        }
    }

    function fn_guardarCuenta() {
        var mesa = "";
    send = { obtenerMesa: 1 };
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
            var mesa = datos[0]["mesa_asignada"];
                window.location.href = "../ordenpedido/tomaPedido.php?numMesa=" + mesa;
            }
        });
    }

    function fn_irTransacciones() {
        window.location.href = "../anulacion/anularOrden.php";
    }

    function fn_activarAsincronico(estado) {
        if (estado) {
            $.ajaxSetup({
                async: true
            });
        } else {
            $.ajaxSetup({
                async: false
            });
        }
    }

    function fn_cargando(std) {
        if (std > 0) {
            $("#mdl_rdn_pdd_crgnd").show();
        } else {
            $("#mdl_rdn_pdd_crgnd").hide();
        }
    }

    function corregirHora(i) {
        if (i < 10) {
        i = "0" + i;
        }
        return i;
    }

    function corregirMinutos(i) {
        if (i < 10) {
            i = "0" + i;
        } else if (i == 60) {
            i = "00";
            m = 0;
            aumentarHora();
        }
        return i;
    }

    function aumentarHora() {
        if (h < 23) {
            h++;
        } else {
            h = 0;
        }
    }

    function aumentarMinuto() {
        m++;
    }

<<<<<<< HEAD
    function fn_actualizar() {
=======
function fn_visualizarCantidadProducto() {
    VISUALIZACANTIDAD = "";
    var send;
    send = {"visualizarCantidadProducto": 1};
>>>>>>> origin/MXP_Version_1.9.10.6

        for (var x in jQuery.cache) {
            delete jQuery.cache[x];
        }
        location.reload();
    }

<<<<<<< HEAD
    function fn_visualizarCantidadProducto() {
        VISUALIZACANTIDAD = "";
        var send;
    send = { visualizarCantidadProducto: 1 };

        $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            url: "config_ordenPedido.php",
            data: send,
            success: function (datos) {
                if (datos.str > 0) {
                    if (datos.visualizarCantidad === "SI") {
                        VISUALIZACANTIDAD = datos.visualizarCantidad;
=======
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                if (datos.visualizarCantidad === "SI") {
                    VISUALIZACANTIDAD = datos.visualizarCantidad;
>>>>>>> origin/MXP_Version_1.9.10.6


                    } else {
                        VISUALIZACANTIDAD = datos.visualizarCantidad;
                    }
                } else {
                    VISUALIZACANTIDAD = "NO";

                }
            }
        });

    }

    function fn_QueAlcanza() {
    $("#queAlcanza").css(
        "background-color",
        $("#queAlcanza").css("background-color") === "rgb(8, 245, 8)" ?
        "rgb(223, 239, 252)" :
        "rgb(8, 245, 8)"
    );

<<<<<<< HEAD
        JSON_plus_puntos = undefined;
    send = { queAlcanza: 1 };
    send.rst_id = $("#hide_rst_id").val();
        $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            url: "config_ordenPedido.php",
            data: send,
            success: function (datos) {
                if (datos.str > 0) {
                    JSON_plus_puntos = datos;
                } else {
                    JSON_plus_puntos = undefined;

                }
=======
    JSON_plus_puntos = undefined;
    send = {"queAlcanza": 1};
    send.rst_id = $('#hide_rst_id').val();
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos.str > 0) {
                JSON_plus_puntos = datos;
            } else {
                JSON_plus_puntos = undefined;

            }
        }
    });

    if ($("#queAlcanza").css("background-color") !== "rgb(8, 245, 8)") {
        $("#barraProducto > button").each(function () {
            if ($(this).attr("puntos") !== "-1") {
                $(this).html($(this).html().substring(0, $(this).html().indexOf("<")) + " <p class=\"class_punto_info\">" + $(this).attr("puntos") + "</p>");
>>>>>>> origin/MXP_Version_1.9.10.6
            }
        });

        if ($("#queAlcanza").css("background-color") !== "rgb(8, 245, 8)") {
            $("#barraProducto > button").each(function () {
                if ($(this).attr("puntos") !== "-1") {
                $(this).html(
                    $(this)
                    .html()
                    .substring(
                        0,
                        $(this)
                        .html()
                        .indexOf("<")
                    ) +
                    ' <p class="class_punto_info">' +
                    $(this).attr("puntos") +
                    "</p>"
                );
                }
            });
        } else {
            fn_marcarCuadrosPlus();
        }
    }


    function plusConfiguradoPuntos(plu_id) {
        if (JSON_plus_puntos !== undefined) {
            for (var i = 0; i < JSON_plus_puntos.str; i++) {
                if (JSON_plus_puntos[i]["plu_id"] === plu_id)
                    return true;
            }
        }
        return false;
    }

<<<<<<< HEAD
    function fn_marcarCuadrosPlus() {
        if (JSON_plus_puntos !== undefined) {
=======
        $("#barraProducto > button").each(function () {
>>>>>>> origin/MXP_Version_1.9.10.6


            $("#barraProducto > button").each(function () {

                var funcionClic = $(this).attr("onclick");


                // veririficar solo plus configurados para esta opcion. (-1  no configurado)
                if ($(this).attr("puntos") !== "-1") {


                    var num_puntos_cliente = $("#num_puntos").val();

                    //                var nombreFuncion = funcionClic.substring(0, funcionClic.indexOf("("));
                    //                var parametrosFuncion = funcionClic.substring(funcionClic.indexOf("("), funcionClic.lastIndexOf(")"));
                    var plu_id = funcionClic.substring(funcionClic.indexOf(",") + 1).trim();
                    plu_id = plu_id.substring(0, plu_id.indexOf(",")).trim();

                    if (plusConfiguradoPuntos(plu_id)) {

                        // cambiar la funcion.
                        //   $(this).attr("onclick", "fn_canjearPlus" + parametrosFuncion + "," + nombreFuncion + ")");

                        // agregar info.
                        if (num_puntos_cliente >= $(this).attr("puntos")) {
                        $(this).html(
                            $(this)
                            .html()
                            .substring(
                                0,
                                $(this)
                                .html()
                                .indexOf("<")
                            ) +
                            ' <p class="class_punto_ok">' +
                            $(this).attr("puntos") +
                            "</p>"
                        );
                        } else {
                        $(this).html(
                            $(this)
                            .html()
                            .substring(
                                0,
                                $(this)
                                .html()
                                .indexOf("<")
                            ) +
                            ' <p class="class_punto_falta">' +
                            $(this).attr("puntos") +
                            "</p>"
                        );
                        }


                    }

                }

            });

        }
    }


    var plus_puntos = -1;
    var descontarPuntos = false;

    function fn_sumarPuntosAltotal(valor, valorUnitario) {
        var nuevo = parseInt($("#num_puntos_plusActual").val()) + parseInt(valor);
        $("#num_puntos_plusActual").val(nuevo);
        $("#puntosPorPluNoAgrupado").val(parseInt($("#puntosPorPluNoAgrupado").val()) + parseInt(valorUnitario));
    }

    function fn_restarPuntosAltotal(valor) {
        var nuevo = parseInt($("#num_puntos_plusActual").val()) - parseInt(valor);
        $("#num_puntos_plusActual").val(nuevo);
        $("#puntosPorPluNoAgrupado").val(parseInt($("#puntosPorPluNoAgrupado").val()) - parseInt(valor));

    }

    function fn_descontarPuntos(puntosPlu, puntosCliente) {
        var numeroPuntosRestantes = puntosCliente - puntosPlu;
        $("#num_puntos").val(numeroPuntosRestantes);
        $("#TotalPuntos").html("Total:  " + RedondearDecimales(numeroPuntosRestantes) + " pts. ");
        fn_ActualizarQueAlcanza("ListadoProductos", 1);

    }

    var puntosDelPlu = 0;

    function fn_canjearPlus(magp_id, plu_id, validaMinimo, funcionNormal, puntosPlu) {
        puntosDelPlu = 0;

<<<<<<< HEAD
        plus_puntos = -1;
        alertify.confirm("¿Deseas canjear el producto?");

    $("#alertify-cancel").html("No");
    $("#alertify-ok").html("Si");

        $("#alertify-cancel").click(function () {
            //alert('Cancelo'); //
            $("#num_puntos_plusActual").val(0);
            $("#num_puntos_plusActualiniciales").val(0);
            $("#puntosPorPluNoAgrupado").val(0);
            plus_puntos = -1;
            descontarPuntos = true; // Puede que el producto no lo quiera canjear pero si alguno de las preguntas sugeridas.
            cancelo = true;
            funcionNormal(magp_id, plu_id, validaMinimo);
        });
        $("#alertify-ok").click(function () {
            // al seleccionar ok, se tomara los valores y configuracion de puntos para luego ejecutar la funcion normal. (paso 3)
            // 1) validar que los puntos si le alcancen antes de abrir preguntas sugeridas.
            // verificar en pantalla de orden pedido si aun esta reregistrado para el canje de puntos.
            if ($("#hide_fb_status").val() === "PREREGISTERED") {
                fn_consultaFB();
            } else if ($("#hide_fb_status").val() === "REGISTERED") {
                puntosDelPlu = puntosPlu;
            if ($("#num_puntos").val() >= puntosPlu * $("#cantidadOK").val()) {
                    //2)  almacenar los puntos que tiene el producto principal.
                    $("#num_puntos_plusActual").val(puntosPlu * $("#cantidadOK").val());
                    $("#num_puntos_plusActualiniciales").val(puntosPlu * $("#cantidadOK").val());
                    $("#puntosPorPluNoAgrupado").val(puntosPlu);
                    descontarPuntos = true;
                    plus_puntos = plu_id;
                    cancelo = false;
                    // 3) ejecutar funcion normal.
                    funcionNormal(magp_id, plu_id, validaMinimo);
                } else {
                    puntosCliente = $("#num_puntos").val();
                    puntosOrdenPedido = $("#num_puntos_plusActual").val();
                puntosPlu = parseInt($("#cantidadOK").val()) * puntosPlu;
                alertify.error(
                    "No tienes los puntos suficientes, te faltan un total de " +
                    RedondearDecimales(
                        Math.abs(puntosPlu - (puntosCliente - puntosOrdenPedido))
                    ) +
                    " puntos."
                );
                }
            } else if ($("#hide_fb_status").val() === "BLOCKED") {
                console.error("Estado Cliente: " + $("#hide_fb_status").val());
                alertify.error("PUNTOS INSUFICIENTES.");
=======
    $("#alertify-cancel").click(function () {
        //alert('Cancelo'); //
        $("#num_puntos_plusActual").val(0);
        $("#num_puntos_plusActualiniciales").val(0);
        $("#puntosPorPluNoAgrupado").val(0);
        plus_puntos = -1;
        descontarPuntos = true; // Puede que el producto no lo quiera canjear pero si alguno de las preguntas sugeridas.
        cancelo = true;
        funcionNormal(magp_id, plu_id, validaMinimo);
    });
    $("#alertify-ok").click(function () {
        // al seleccionar ok, se tomara los valores y configuracion de puntos para luego ejecutar la funcion normal. (paso 3)
        // 1) validar que los puntos si le alcancen antes de abrir preguntas sugeridas.


        // verificar en pantalla de orden pedido si aun esta reregistrado para el canje de puntos.
        if ($("#hide_fb_status").val() === "PREREGISTERED") {
            fn_consultaFB();
        }

        if ($("#hide_fb_status").val() === "REGISTERED") {
            puntosDelPlu = puntosPlu;
            if ($("#num_puntos").val() >= (puntosPlu * $("#cantidadOK").val())) {
                //2)  almacenar los puntos que tiene el producto principal.
                $("#num_puntos_plusActual").val(puntosPlu * $("#cantidadOK").val());
                $("#num_puntos_plusActualiniciales").val(puntosPlu * $("#cantidadOK").val());
                $("#puntosPorPluNoAgrupado").val(puntosPlu);

                descontarPuntos = true;
                plus_puntos = plu_id;
                cancelo = false;
                // 3) ejecutar funcion normal.
                funcionNormal(magp_id, plu_id, validaMinimo);
>>>>>>> origin/MXP_Version_1.9.10.6
            } else {
                var puntosOrdenPedido = $("#num_puntos_plusActual").val();
                var puntosCliente = $("#num_puntos").val();
                alertify.alert("Necesitas finalizar el proceso de registro descargandote la app.");
                $("#alertify-cancel").hide();
            }
        });
    }


    var econtroDatos = -1;
    var fb_status = -1;

    function fn_consultaFB() {

        $("#mdl_rdn_pdd_crgnd").show();
        var documento = $("#fdzn_cedula").val();
        econtroDatos = -1;
        fb_status = -1;
        var send;
        send = {};
        send.metodo = "consultaEstadoFireBase";
        send.documento = documento;
        send.tipoDocumento = "CI";

        $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            url: "../facturacion/clienteWSClientes.php",
            data: send,
            success: function (datos) {
                if (datos["mensaje"] === undefined) { // el mensaje solo se obtiene cuando ocurre un error.
                    econtroDatos = 1;
                    fb_status = datos["data"]["status"];
                    $("#hide_fb_status").val(datos["data"]["status"]);

<<<<<<< HEAD
                } else {
                    econtroDatos = 404;
                }
=======
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "../facturacion/clienteWSClientes.php",
        data: send,
        success: function (datos) {
            if (datos["mensaje"] === undefined) { // el mensaje solo se obtiene cuando ocurre un error.
                econtroDatos = 1;
                fb_status = datos["data"]["status"];
                $("#hide_fb_status").val(datos["data"]["status"]);
>>>>>>> origin/MXP_Version_1.9.10.6

            },
            error: function (jqXHR, textStatus, errorThrown) {
                econtroDatos = 404;
            }
        });
        $("#mdl_rdn_pdd_crgnd").hide();
    }

<<<<<<< HEAD
    function RedondearDecimales(numero) {
        var retorno = 0;
        if (numero % 1 === 0) {
            retorno = numero;
        } else {
            retorno = numero.toFixed(2);
=======
        },
        error: function (jqXHR, textStatus, errorThrown) {
            econtroDatos = 404;
>>>>>>> origin/MXP_Version_1.9.10.6
        }
        return retorno;
    }

<<<<<<< HEAD
    function fn_abuscarProductosQuemeAlcanza() {
    var context_points = '<p class="class_punto_info">500</p>';
        var html = "";
        $("#barraProducto").show();
        $("#agregarCantidad").show();
        $("#barraProducto").empty();
=======
function fn_abuscarProductosQuemeAlcanza() {
    var context_points = "<p class=\"class_punto_info\">500</p>";
    var html = "";
    $("#barraProducto").show();
    $("#agregarCantidad").show();
    $("#barraProducto").empty();

    send = {"FiltroQueMeAlcanza": 1};
>>>>>>> origin/MXP_Version_1.9.10.6

    var send;
    send = { FiltroQueMeAlcanza: 1 };

<<<<<<< HEAD
    send.cla_id = $("#hid_cla_id").val();
    send.rst_id = $("#hide_rst_id").val();
    send.num_puntos = $("#num_puntos").val();
=======
    $.ajax({
        async: false,
        url: "config_ordenPedido.php",
        data: send,
        dataType: "json",
        success: function (datos) {
            if (datos.str > 0) {
>>>>>>> origin/MXP_Version_1.9.10.6

        $.ajax({
            async: false,
            url: "config_ordenPedido.php",
            data: send,
            dataType: "json",
            success: function (datos) {
                if (datos.str > 0) {

                    for (i = 0; i < datos.str; i++) {
                    var posicionTotal = "" + datos[i]["magp_orden"] + "";
                        var separar = posicionTotal.split(",");
                        left = separar[0];
                        arriba = separar[1];

                    if (datos[i]["puntos"] !== -1) {
                        if ($("#num_puntos").val() >= datos[i]["puntos"]) {
                            data = '<p class="class_punto_ok">&nbsp; ✓ &nbsp;</p>';
                            } else {
                            data =
                                '<p class="class_punto_falta"> ' +
                                RedondearDecimales(
                                    Math.abs($("#num_puntos").val() - datos[i]["puntos"])
                                ) +
                                " </p>";
                            }

                        funcion =
                            "onclick='fn_canjearPlus(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            " ,fn_verificarGramosPlu , " +
                            datos[i]["puntos"] +
                            "   )'";
                        } else {
                            data = "";
                        funcion =
                            "onclick='fn_verificarGramosPlu(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            ")'";
                        }

                        //                    var data = (datos[i]['puntos'] !== -1) ? "<p class=\"class_punto_info\"> " + datos[i]['puntos'] + "</p>" : "";
                        //                    var funcion = (datos[i]['puntos'] !== -1) ? "onclick='fn_canjearPlus(\"" + datos[i]['magp_id'] + "\", " + datos[i]['plu_id'] + "," + datos[i]['validador'] + " ,fn_verificarGramosPlu , " + datos[i]['puntos'] + "   )'" : "onclick='fn_verificarGramosPlu(\"" + datos[i]['magp_id'] + "\", " + datos[i]['plu_id'] + "," + datos[i]['validador'] + ")'";

                        if ($("#hide_PerteneceGrupoAmigos").val() === "0") {
                            data = "";
                        funcion =
                            "onclick='fn_verificarGramosPlu(\"" +
                            datos[i]["magp_id"] +
                            '", ' +
                            datos[i]["plu_id"] +
                            "," +
                            datos[i]["validador"] +
                            ")'";
                        }

                    if (datos[i]["std_fecha"] < 1) {
                        html +=
                            "<button puntos = '" +
                            datos[i]["puntos"] +
                            "'  id='btn_p" +
                            datos[i]["magp_id"] +
                            "'  " +
                            funcion +
                            " style=';position:absolute;background-color:" +
                            datos[i]["magp_color"] +
                            "; color:" +
                            datos[i]["magp_colortexto"] +
                            "; left:" +
                            left +
                            "px; top:" +
                            arriba +
                            "px;' class='producto_inactivo' pls_grms='" +
                            datos[i]["plu_gramo"] +
                            "' disabled>" +
                            datos[i]["magp_desc_impresion"] +
                            " " +
                            data +
                            "</button>";
                        } else {
                        html +=
                            "<button puntos = '" +
                            datos[i]["puntos"] +
                            "'   id='btn_p" +
                            datos[i]["magp_id"] +
                            "'  " +
                            funcion +
                            " style='position:absolute;background-color:" +
                            datos[i]["magp_color"] +
                            "; color:" +
                            datos[i]["magp_colortexto"] +
                            "; left:" +
                            left +
                            "px; top:" +
                            arriba +
                            "px;' class='producto_activo' pls_grms='" +
                            datos[i]["plu_gramo"] +
                            "'>" +
                            datos[i]["magp_desc_impresion"] +
                            " " +
                            data +
                            "</button>";
                        }
                    }
                    $("#barraProducto").html(html);
                } else {
                    alertify.error("Tus puntos no alcanzan para ning&uacute;n producto.");
                }
            }
        });
        if (JSON_plus_puntos !== undefined) {
            fn_marcarCuadrosPlus();
        }
    }

    var prediccionValor = 0;

<<<<<<< HEAD
    function prediccion() {

        cantidadAgrupacion = $("#cantidadOK").val();
=======
    cantidadAgrupacion = $("#cantidadOK").val();

    var cantidadPuntosActual = 0;
    $("#cntndr_body_prgnts_sgrds > div").each(function () {
        var id = $(this).attr("id");

        $("#" + id + "   > div.divContenedorRespuestasAPreguntasSugeridas >  button.slccn_cntdad_prgnts_sgrds").each(function () {
            var idinformacionPuntos = $(this).attr("id"); //
            var idinformacionCantidades = idinformacionPuntos.replace("pl_prgt_sug_cnt", "pl_prgt_sug_pcn");
            if ($("#" + idinformacionPuntos).attr("sicanjeado") !== undefined) {
>>>>>>> origin/MXP_Version_1.9.10.6

        var cantidadPuntosActual = 0;
        $("#cntndr_body_prgnts_sgrds > div").each(function () {
            var id = $(this).attr("id");

            $("#" + id + "   > div.divContenedorRespuestasAPreguntasSugeridas >  button.slccn_cntdad_prgnts_sgrds").each(function () {
                var idinformacionPuntos = $(this).attr("id"); //
                var idinformacionCantidades = idinformacionPuntos.replace("pl_prgt_sug_cnt", "pl_prgt_sug_pcn");
                if ($("#" + idinformacionPuntos).attr("sicanjeado") !== undefined) {
                var cantidadSeleccionada = parseInt(
                    $("#" + idinformacionPuntos).attr("sicanjeado")
                );
                var cantidadPuntosPorPlus = parseInt(
                    $("#" + idinformacionCantidades).attr("puntos")
                );

                cantidadPuntosActual +=
                    cantidadPuntosPorPlus * (cantidadSeleccionada * cantidadAgrupacion);
                }
            }); // fin foreach
            //  }// Fin validacion solo contenedor que dio  click.

        });

        prediccionValor = cantidadPuntosActual;

    }


    function fn_ActualizarQueAlcanza(opcion, esFinal) {
        var temporal = $("#cantidadOK").val();
        if (fidelizacionActiva()) {

            if (esFinal === 1) { // pregunta al sistema si es cuando el cajero presiona Confirmar de las preguntas sugeridas. indicara que ya se actualizara el panel de productos con la cantidad en 1.
                $("#cantidadOK").val(1);
            }

        var cantidadPlus =
            parseInt($("#cantidadOK").val()) < 1 ?
            1 :
            parseInt($("#cantidadOK").val());

        if ($("#cbcr_prgnts_sgrds_cntdor h4").html() !== undefined) {
            var estado_cantidad = parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html());
            cantidadPlus = cantidadPlus - estado_cantidad + 1;
            }

        cantidadPlus = parseInt(cantidadPlus) < 1 ? 1 : cantidadPlus;

            if (opcion === "ListadoProductos") {
                $("#barraProducto > button").each(function () {
                    if ($(this).attr("puntos") !== "-1") {
                        var textoPlus = trim($(this).html().substring(0, $(this).html().indexOf("<")));

                        var data = "";

<<<<<<< HEAD
                    if (
                        $("#num_puntos").val() >=
                        parseInt($(this).attr("puntos")) * parseInt(cantidadPlus)
                    ) {
                        data = '<p class="class_punto_ok">&nbsp; ✓ &nbsp;</p>';
                        } else {
                        data =
                            '<p class="class_punto_falta"> ' +
                            RedondearDecimales(
                                Math.abs(
                                    $("#num_puntos").val() -
                                    parseInt($(this).attr("puntos")) * parseInt(cantidadPlus)
                                )
                            ) +
                            " </p>";
                        }
                        $(this).html(textoPlus + data);
                    }
                });
=======
        if (opcion === "ListadoProductos") {
            $("#barraProducto > button").each(function () {
                if ($(this).attr("puntos") !== "-1") {
                    var textoPlus = trim($(this).html().substring(0, $(this).html().indexOf("<")));
>>>>>>> origin/MXP_Version_1.9.10.6

            } else if (opcion === "PreguntaSugerida") {

                var agrupacion = false;
            if ($("#cmn-toggle-1").is(":checked")) {
                    agrupacion = true;
                }


                $("#cntndr_body_prgnts_sgrds > div").each(function () {
                    var id = $(this).attr("id");
                    $("#" + id + "   > div.divContenedorRespuestasAPreguntasSugeridas > p").each(function () {

<<<<<<< HEAD
                    var puntosOrdenPedido =
                        agrupacion === true ?
                        $("#puntosPorPluNoAgrupado").val() *
                        ($("#cantidadOK").val() -
                            parseInt($("#cbcr_prgnts_sgrds_cntdor h4").html()) +
                            1) :
                        $("#puntosPorPluNoAgrupado").val();
=======
            $("#cntndr_body_prgnts_sgrds > div").each(function () {
                var id = $(this).attr("id");
                $("#" + id + "   > div.divContenedorRespuestasAPreguntasSugeridas > p").each(function () {
>>>>>>> origin/MXP_Version_1.9.10.6

                        //var puntosOrdenPedido = (agrupacion === true) ? $("#puntosPorPluNoAgrupado").val() * ($("#cantidadOK").val() - parseInt($('#cbcr_prgnts_sgrds_cntdor h4').html()) + 1) : $("#puntosPorPluNoAgrupado").val();
                        //   num_puntos_plusActual


                        var puntosCliente = $("#num_puntos").val();

                        var puntosPreguntaSugerida = 0;
                        if (agrupacion) {

                            var cantidad = $("#cantidadOK").val();
                        if ($("#cbcr_prgnts_sgrds_cntdor h4").html() !== undefined) {
                            var estado_cantidad = parseInt(
                                $("#cbcr_prgnts_sgrds_cntdor h4").html()
                            );
                            cantidad = cantidad - estado_cantidad + 1;
                            }

                        puntosPreguntaSugerida =
                            parseInt($(this).attr("puntos")) * parseInt(cantidad);
                        } else {
                            puntosPreguntaSugerida = parseInt($(this).attr("puntos"));
                        }

                    if (
                        puntosCliente - puntosOrdenPedido >=
                        puntosPreguntaSugerida /* *cantidadPlus*/
                    ) {
                            $(this).attr("class", "class_punto_ok");
                            $(this).html("&nbsp; ✓ &nbsp;");
                        } else {
                            $(this).attr("class", "class_punto_falta");
                        $(this).html(
                            RedondearDecimales(
                                Math.abs(
                                    Math.abs(puntosCliente - puntosOrdenPedido) -
                                    puntosPreguntaSugerida
                                )
                            )
                        );
                        }
                    });
                });
            }
        }
        $("#cantidadOK").val(temporal);

    }

    function fn_cancelarOrdenFidelizacion() {
    var send = { cancelarOrdenPedido: 1 };
        send.odp_id = $("#hide_odp_id").val();
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
                window.location.href = "fidelizacion_inicio.php?numMesa=" + $("#hide_mesa_id").val();
            } else {
                alertify.alert("Error");
            }
        });
}

function validarVitalityCupo(orden_pedido,hidVitality) {
        var valido = false;

<<<<<<< HEAD
    if (hidVitality == "0") {
            valido = true;
        } else {
        var send = { obtenerTotalOrdenPedido: 1 };
        send.idOrdenPedido = orden_pedido;
            $.ajax({
                async: false,
                type: "POST",
                url: "config_ordenPedido.php",
                dataType: "json",
                data: send,
                success: function (datos) {
                    if (datos !== null) {
                    valido = datos.total <= $("#spnBalanceVitality").html();
=======
                    if ((puntosCliente - puntosOrdenPedido) >= (puntosPreguntaSugerida /* *cantidadPlus*/)) {
                        $(this).attr("class", "class_punto_ok");
                        $(this).html("&nbsp; ✓ &nbsp;");
                    } else {
                        $(this).attr("class", "class_punto_falta");
                        $(this).html(RedondearDecimales(Math.abs((Math.abs((puntosCliente - puntosOrdenPedido))) - (puntosPreguntaSugerida))));
>>>>>>> origin/MXP_Version_1.9.10.6
                    }
                }
            });
        }

        return valido;
    }

    var fn_cancelarOrdenFidelizacion = function () {
    send = { cancelarOrdenPedido: 1 };
        send.odp_id = $("#hide_odp_id").val();
        $.getJSON("config_ordenPedido.php", send, function (datos) {
            if (datos.str > 0) {
                window.location.href = "fidelizacion_inicio.php?numMesa=" + $("#hide_mesa_id").val();
            } else {
            alertify.alert("Error");
            }
        });
    };

<<<<<<< HEAD
    var fn_inactivarCanjeProductoCupon = function (idOrden, idDetalleOrden) {
        console.log("InactivarCanjeProducto: ", idOrden, idDetalleOrden);
        var send = {
        desactivarCanjeCuponOrdenMasterData: 1,
        idOrden: idOrden,
        idDetalleOrden: idDetalleOrden
        };

        var peticionAnulacion = $.ajax({
            async: false,
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            url: "config_ordenPedido.php",
            data: send,
            success: function (datos) {
                console.log("desactivarCanjeCuponOrdenMasterData: ", datos);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alertify.alert(jqXHR);
                alertify.alert(textStatus);
                alertify.alert(errorThrown);
            }
        });
    };

    var fn_inactivarCanjeTextoCupon = function (idOrden, idCupon) {
        var send = {
        desactivarCanjeCuponOrdenTextoMasterData: 1,
        idOrden: idOrden,
        idCupon: idCupon
=======
var fn_cancelarOrdenFidelizacion = function () {
    send = {"cancelarOrdenPedido": 1};
    send.odp_id = $("#hide_odp_id").val();
    $.getJSON("config_ordenPedido.php", send, function (datos) {
        if (datos.str > 0) {
            window.location.href = "fidelizacion_inicio.php?numMesa=" + $("#hide_mesa_id").val();
        } else {
            alertify.alert('Error');
        }
    });
};

var fn_inactivarCanjeProductoCupon = function (idOrden, idDetalleOrden) {
    console.log("InactivarCanjeProducto: ", idOrden, idDetalleOrden);
    var send = {
        "desactivarCanjeCuponOrdenMasterData": 1,
        "idOrden": idOrden,
        "idDetalleOrden": idDetalleOrden
    };

    var peticionAnulacion = $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            console.log("desactivarCanjeCuponOrdenMasterData: ", datos);
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alertify.alert(jqXHR);
            alertify.alert(textStatus);
            alertify.alert(errorThrown);
        }
    });
};

var fn_inactivarCanjeTextoCupon = function (idOrden, idCupon) {
    var send = {
        "desactivarCanjeCuponOrdenTextoMasterData": 1,
        "idOrden": idOrden,
        "idCupon": idCupon
>>>>>>> origin/MXP_Version_1.9.10.6
    };

    var peticionAnulacion = $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            console.log("desactivarCanjeCuponOrdenTextoMasterData: ", datos);
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alertify.alert(jqXHR);
            alertify.alert(textStatus);
            alertify.alert(errorThrown);
        }
    });
};

    function fn_modalFidelizacion(mostrar) {
        $("#inpCodigoSeguridad").val("");
        if (mostrar) {
            $("#mdlFidelizacion").show();
            $("#inpCodigoSeguridad").focus();
            $("#inpCodigoSeguridad").blur(function() {
                setTimeout(function() {
                    $("#inpCodigoSeguridad").focus();
                }, 20);
            });
            darFocoFijo($("#inpCodigoSeguridad"), true);
            activarFocusLectorBarra(false);
            activarFocusLectorBarra(false);
        } else {
            $("#mdlFidelizacion").hide();
            $("#inpCodigoSeguridad").off("blur");
            darFocoFijo($("#inpCodigoSeguridad"), false);
            activarFocusLectorBarra(true);
        }
    }



    function leerCodigoSeguridad(codigo) {
        fn_cargando(1);
        var cc = separarCedulaCodigo(codigo);
        var cedula = cc[0];
        var token = cc[1];
        if (validarCodigoSeguridad(token)) {
            fn_modalFidelizacion(false);
            var send = {};
            send.metodo = "consultaEstadoFireBase";
            send.documento = cedula;
            send.tipoDocumento = "CI";
            send.codigoSeguridad = token;
            $.ajax({
                async: false,
                type: "POST",
                dataType: "json",
                contentType: "application/x-www-form-urlencoded",
                url: "../facturacion/clienteWSClientes.php",
                data: send,
                success: function(datos) {
                    if (datos["mensaje"] === undefined) { // el mensaje solo se obtiene cuando ocurre un error.
                        fn_actualizar();
                    } else {
                        fn_cargando(0);
                        alertify.error("Se ha producido un error. Por favor inténtelo nuevamente.");
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    fn_cargando(0);
                    alertify.error("Se ha producido un error. Por favor inténtelo nuevamente.");
                }
            });
        } else {
            fn_cargando(0);
            $("#inpCodigoSeguridad").val("");
        }
    }

function activarFocusLectorBarra(activar) {
    if (activar) {
        $(document).keydown(teclado);
    } else {
        $(document).off("keydown");
    }
}



function deseleccionarOrdenKiosko() {
    $(".liKiosko").removeClass("seleccionado");
    mostrarModalOpcionesKiosko(false);
}

function mostrarModalOpcionesKiosko(mostrar) {
    if (mostrar) {
        $("#mdlOpciones").fadeIn(100);
    } else {
        $("#mdlOpciones").fadeOut(100);
    }
}

function mostrarListadoKiosko() {
    if ($("#hide_configuracionKioskoActivo").val() == "1" && $("#hide_ordenesKioskoURL").val() != "0") {
        cargarPedidosKiosko();
        $("#Pedidoskiosko").show();
        $("#listaPedidoTomaPedido").css("height", "400px");
    } else {
        $("#Pedidoskiosko").hide();
    }
}

function cargarPedidosKiosko() {
<<<<<<< HEAD
    var send = { cargarPedidosKiosko: 1 };
=======
    var send = {"cargarPedidosKiosko": 1};
>>>>>>> origin/MXP_Version_1.9.10.6
    $.ajax({
        async: true,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            if (datos !== null && datos.str > 0) {
                var html = "";
                for (var i = 0; i < datos.str; i++) {
                    html += "<li class='liKiosko' data-orden='" + datos[i].orden + "' data-cliente='" + datos[i].cliente + "' data-factura='" + datos[i].transaccion + "'>" + datos[i].orden + "&nbsp; " + truncarPalabra(datos[i].cliente, 15) + "</li>";
                }
                $("#listaPedidosKiosko").html(html);
            }
        }
    });
}

function mostrarModalCodigoKiosko(mostrar) {
    mostrarModalOpcionesKiosko(false);
    $("#inpCodigoOrdenPedido").val("");
    if (mostrar) {
        $("#hRetomarOrden").html("Retomar Orden Nº: <b>" + objetoOrden.orden + "<b/>");
        $("#mdlKioskoCodigo").fadeIn(100);
        darFocoFijo($("#inpCodigoOrdenPedido"), true);
        activarFocusLectorBarra(false);
    } else {
        $("#mdlKioskoCodigo").fadeOut(100);
        darFocoFijo($("#inpCodigoOrdenPedido"), false);
        activarFocusLectorBarra(true);
        $(".liKiosko").removeClass("seleccionado");
    }
}

function leerCodigoOrdenPedido(codigo) {
    if (objetoOrden.factura === codigo) {
        $("#mdlKioskoCodigo").hide();
        reimpresionkiosko = 0;
        retomarOrdenKiosko(codigo);
    } else {
        alertify.error("<span style='font-size: 16px;'>Código no pertenece a la orden <b>" + objetoOrden.orden + "</b></span>");
        $("#inpCodigoOrdenPedido").val("");
    }
}

function darFocoFijo($input, activar) {
    if (activar) {
        $input.focus();
        $input.blur(function () {
            setTimeout(function () {
                $input.focus();
            }, 20);
        });
    } else {
        $input.off("blur");
    }
}

function seleccionarOrdenKiosko(elemento, data) {
    console.log(data);
    objetoOrden = data;
    $("#hTituloModalKiosko").html("Orden Nº: <b>" + data.orden + "<b/>");
    $("#hSubtituloModalKiosko").html(data.cliente.toString().toLowerCase());
    $(elemento).addClass("seleccionado");
    mostrarModalOpcionesKiosko(true);
}

function retomarOrdenKiosko(codigoFactura) {
    fn_cargando(1);
    var send = {
        retomarOrdenKiosko: 1,
        codigoFactura: codigoFactura,
        reimpresionkiosko: reimpresionkiosko
    };
    $.ajax({
        async: true,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
        success: function (datos) {
            fn_cargando(0);
            if (datos[0]["mensajes"] === "") {
                var odp_id = datos[0]["odp_id"];
                var mesa_id = datos[0]["mesa_id"];
                var dop_cuenta = datos[0]["dop_cuenta"];
                retirarOrdenKiosko("Retomar");
                redirigirFacturacion(odp_id, mesa_id, dop_cuenta);
            } else {
                alertify.error(datos[0]["mensajes"]);
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            fn_cargando(0);
            alertify.error("Error al retomar orden");
            // console.log(jqXHR);
            console.log(textStatus);
            console.log(errorThrown);
        }
    });
}

function procesoReimpresion() {
    deseleccionarOrdenKiosko();
    reimpresionkiosko = 1;
    retomarOrdenKiosko(objetoOrden.factura);
}

function redirigirFacturacion(odp_id, mesa_id, dop_cuenta) {
    fn_cargando(1);
    $("#formCobrar").html(
        '<form action="../facturacion/factura.php" name="cobro" method="post" style="display:none;"><input type="text" name="odp_id" value="' +
        odp_id +
        '" /><input type="text" name="dop_cuenta" value="' +
        dop_cuenta +
        '" /><input type="text" name="mesa_id" value="' +
        mesa_id +
        '" /></form>'
    );
    document.forms["cobro"].submit();
    fn_cargando(0);
}

function confirmarAnularOrdenKiosko() {
    if ($("#hide_socketActivo").val() == 1) {
        alertify.confirm("¿Está seguro que desea anular la orden de pedido de kiosko? Esta acción no se puede deshacer.", function (e) {
            if (e) {
                retirarOrdenKiosko("Anular");
            }
        });
    } else {
        alertify.error("Servicio no se encuentra disponible. Por favor intentar nuevamente.");
    }
}

// Orden se actualiza a estado Abandonado en BD, y se procede a retirarla de la lista
// Al retomar y finalizar la orden se actualizará el estado nuevamente a Cerrado
function retirarOrdenKiosko(accion) {
    var url = $("#hide_ordenesKioskoURL").val() + "/order";
    if ($("#hide_configuracionKioskoActivo").val() == "1" && url != "0") {
        var send = {};
        var idFactura = objetoOrden.factura;
        send.turneroAccion = "anularOrden";
        send.turneroURl = url;
        send.idFactura = idFactura;
        $.ajax({
            async: true,
            type: "POST",
            dataType: "text",
            contentType: "application/x-www-form-urlencoded",
            url: "../ordenpedido/wsOrdenesKiosko.php",
            data: send,
            success: function (datos) {
                console.log(accion + " Orden:");
                console.log(datos);
                $("#listaPedidosKiosko").find("li").each(function () {
                    if ($(this).data("factura") == idFactura) {
                        $(this).remove();
                    }
                });
                deseleccionarOrdenKiosko();
            }
        });
    } else {
        alertify.error("Error en las configuraciones del kiosko.");
    }
}

function truncarPalabra(palabra, longitud) {
    return palabra.length > longitud ?
        palabra.substring(0, longitud) + "..." :
        palabra;
}

// Si se retoma una orden de kiosko y luego se eliminan todos los productos, se considera cancelada dicha orden
function validarCancelarOrdenKiosko() {
<<<<<<< HEAD
	if ($("#hide_ordenKiosko").val() === "1") {
		cancelarOrdenKiosko();
	}
}

function cancelarOrdenKiosko() {
	var send = { "cancelarOrdenKiosko": 1 };
	send.ordenPedido = $("#hide_odp_id").val();
	$.ajax({
=======
    if ($("#hide_ordenKiosko").val() === "1") {
        cancelarOrdenKiosko();
    }
}

function cancelarOrdenKiosko() {
    var send = {"cancelarOrdenKiosko": 1};
    send.ordenPedido = $("#hide_odp_id").val();
    $.ajax({
>>>>>>> origin/MXP_Version_1.9.10.6
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_ordenPedido.php",
        data: send,
<<<<<<< HEAD
		success: function(datos) {
			$("#hide_ordenKiosko").val("0");
			$("#nfrmcn_srs_sstm_hora").html("");
			alertify.error("Orden de kiosko cancelada");
		},
	});
}

// ******VITALITY  **********
var opcionSetVitality = function(opcion) {
    //activarFocusLectorBarra(false);

    vitality = opcion;
    recarga = "";
    $("#cntRecargas").hide();
    $("#registroCliente").hide();
    $("#pre2").hide();
    $("#ingresoCedula").hide();
    //flujo_seguimiento("ingresoVitality", "pre1", true);
    $("#ingresoVitality").show(200);
    $("#tqtIngresoVT").html('Vitality<p style="font-size: 0.6em;" class="mensajePequeno">Lea código de seguridad.</p>');
    $("#txtCodigoVitality").focus();
    darFocoFijo($("#txtCodigoVitality"), true);
    activarFocusLectorBarra(false);
};


function cargarTokenSeguridadVitality(codigoQRVitality) {
    console.log('entro 1');
    //fn_cargando(1);
    var send = {};
    send.metodo = "cargarTokenSeguridadVitality";
    $.ajax({
        async: true,
        type: "POST",
        dataType: "json",
        "Accept": "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "config_VitalityWS.php",
        data: send,
        success: function(datos) {
            console.log('entro 2');
            if (datos.access_token != '') {
                var TokenSeguridadVitality = datos.token_type + ' ' + datos.access_token;
                validarCodigoQRVitality(codigoQRVitality, TokenSeguridadVitality);
                //ventaVitality(codigoQRVitality, TokenSeguridadVitality);

            } else {
                console.log('entro 3');
                //fn_cargando(0);
                $("#txtCodigoVitality").focus();
                alertify.error('Error:' + datos.mensajes).delay(10);
                $("#txtCodigoVitality").val('');

            }
        },
        error: function (err){
            console.log(err);
        }
    });
};

function validarCodigoQRVitality(codigoQRVitality, TokenSeguridadVitality) {
    var send = {};
    send.metodo = "ValidarVoucherVitality";
    send.codigoQRVitality = codigoQRVitality;
    send.TokenSeguridadVitality = TokenSeguridadVitality;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        "Accept": "application/json, text/javascript2",
        contentType: "application/x-www-form-urlencoded; charset=utf-8; application/json",
        url: "config_VitalityWS.php",
        data: send,
        success: function(datos) {
            var info = datos.data;
            if (datos.errores == "") {
                var telf = filtrarNumeros(info.phoneNumber);
                if (parseFloat(info.currentBalance) > 0.00) {
                    var cliente = obtenerIdClienteExterno(0, info.legalName, "", "RUC", info.documentNumber, telf, info.address, "", "");
                    if (cliente != null) {
                        $("#txtCodigoVitality").val("");
                        $("#txtCodigoVitality").focus();
                        fn_cargando(0);
                        ir_tomaPedido();
                    } else {
                        fn_cargando(0);
                        $("#txtCodigoVitality").val("");
                        alertify.error("Error con Datos de Cupón").delay(10);
                        $("#txtCodigoVitality").focus();
                    }
                } else {
                    fn_cargando(0);
                    $("#txtCodigoVitality").val('');
                    alertify.error('Error: Cupón Canjeado o Expirado').delay(10);
                    $("#txtCodigoVitality").focus();
                }
            } else {
                fn_cargando(0);
                $("#txtCodigoVitality").val("");
                alertify.error("Existe problemas con el Cupón. Por favor intente más tarde.").delay(10);
                $("#txtCodigoVitality").focus();
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR, textStatus, errorThrown);
            fn_cargando(0);
            $("#txtCodigoVitality").val("");
            alertify.error("Servicio no disponible, por favor intentalo más tarde.").delay(10);
            $("#txtCodigoVitality").focus();
        }
    });
}



//Devolver solo números
function filtrarNumeros(numero) {
    return numero.replace(/\D/g, "");
}

function obtenerIdClienteExterno(idCiudad, nombre, apellido, tipoDocumento, documento, telefono, direccion, email, tipoCliente) {
    var idCliente = null;
    var send = { "metodo": "obtenerIdClienteExterno" };
    send.idCiudad = idCiudad;
    send.nombre = nombre;
    send.apellido = apellido;
    send.tipoDocumento = tipoDocumento;
    send.documento = documento;
    send.telefono = telefono;
    send.direccion = direccion;
    send.email = email;
    send.tipoCliente = tipoCliente;
    $.ajax({
        async: false,
        type: "POST",
        dataType: "json",
        contentType: "application/x-www-form-urlencoded",
        url: "config_VitalityWS.php",
        data: send,
        success: function(datos) {
            if (datos !== null) {
                idCliente = datos.idCliente;
            }
        }
    });

    return idCliente;
}

function ir_tomaPedido() {
    var IDMesa = $("#hide_mesa_id").val();
    if (recarga == "Recargas") {
        if (obtenerLimitesRecarga()) {
            $("#cntRecargas").show();
            $("#ingresoCedula").hide();
            fn_numericoFDZN("#inValorRecarga");
        } else {
            alertify.error("Error al obtener parámetros de recargas.");
        }
    } else {
        window.location.replace("tomaPedido.php?numMesa=" + IDMesa);
    }
}

function fn_cargando(std) {
    if (std > 0) {
        $("#mdl_rdn_pdd_crgnd").show();
    } else {
        $("#mdl_rdn_pdd_crgnd").hide();
    }
}


function flujo_seguimiento(show, hide, limpiar) {
    if (recarga !== "") {
        $("#tqtIngresoCR").html('LEA CODIGO DE SEGURIDAD<p style="font-size: 0.6em;" class="mensajePequeno">Para acumular puntos es necesario lectura de código de seguridad.</p>');
    }
    if (limpiar) {
        $("#txtNumeroCedulaBusqueda").val("");
        $("#txtNumeroDocumento").val("");
        $("#txtNombresApellidos").val("");
        $("#txtTelefono").val("");
        $("#txtDireccion").val("");
        $("#txtCorreo").val("");
        $("#btnCRUD").val("Registrar");
    }
    if (show == "pre1") {
        recarga = "";
    } else if (show == "registroCliente") {
        deshabilitarCamposCliente(true);
    }
    $("#" + hide).hide(200);
    $("#" + show).show(200);
    ocultarTeclado();
    //Foco en Entrada de Codigo
    darFocoEntradaQR();
}

=======
        success: function (datos) {
            $("#hide_ordenKiosko").val("0");
            $("#nfrmcn_srs_sstm_hora").html("");
            alertify.error("Orden de kiosko cancelada");
        },
    });
}
>>>>>>> origin/MXP_Version_1.9.10.6
